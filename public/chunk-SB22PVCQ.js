import{a as go}from"./chunk-7IMVGUBN.js";import{$a as fo,Ab as xl,C as Pl,Cb as Ml,Gb as Fl,Ib as Ll,Na as X,Qa as ho,R as Nl,Ra as st,S as ii,Ta as wt,U as si,V as $n,W as qe,Y as me,_ as Yt,a as De,aa as ge,b as rt,c as it,ca as jn,d as h,ea as $e,fa as je,g as Bn,l as Dl,la as kl,lb as po,m as Rl,o as ri,oa as Vl,p as ao,q as co,qa as Et,r as uo,sa as lo,ta as Gn,w as qn,xa as Ol,xb as oi,zb as mo}from"./chunk-ONBYTTLV.js";var Wl=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(X(ho),X(lo))},e.\u0275dir=je({type:e});let t=e;return t})(),Km=(()=>{let e=class e extends Wl{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Vl(e)))(s||e)}})(),e.\u0275dir=je({type:e,features:[wt]});let t=e;return t})(),Hl=new me("");var Qm={provide:Hl,useExisting:si(()=>Kl),multi:!0};function Jm(){let t=go()?go().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}var Ym=new me(""),Kl=(()=>{let e=class e extends Wl{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!Jm())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(X(ho),X(lo),X(Ym,8))},e.\u0275dir=je({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&po("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[oi([Qm]),wt]});let t=e;return t})();var Ql=new me(""),Jl=new me("");function Yl(t){return t!=null}function Xl(t){return Ml(t)?uo(t):t}function Zl(t){let e={};return t.forEach(n=>{e=n!=null?De(De({},e),n):e}),Object.keys(e).length===0?null:e}function eh(t,e){return e.map(n=>n(t))}function Xm(t){return!t.validate}function th(t){return t.map(e=>Xm(e)?e:n=>e.validate(n))}function Zm(t){if(!t)return null;let e=t.filter(Yl);return e.length==0?null:function(n){return Zl(eh(n,e))}}function yo(t){return t!=null?Zm(th(t)):null}function eg(t){if(!t)return null;let e=t.filter(Yl);return e.length==0?null:function(n){let r=eh(n,e).map(Xl);return Pl(r).pipe(qn(Zl))}}function vo(t){return t!=null?eg(th(t)):null}function Ul(t,e){return t===null?[e]:Array.isArray(t)?[...t,e]:[t,e]}function tg(t){return t._rawValidators}function ng(t){return t._rawAsyncValidators}function _o(t){return t?Array.isArray(t)?t:[t]:[]}function ci(t,e){return Array.isArray(t)?t.includes(e):t===e}function Bl(t,e){let n=_o(e);return _o(t).forEach(i=>{ci(n,i)||n.push(i)}),n}function ql(t,e){return _o(e).filter(n=>!ci(t,n))}var ui=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=yo(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=vo(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,n){return this.control?this.control.hasError(e,n):!1}getError(e,n){return this.control?this.control.getError(e,n):null}},Zt=class extends ui{get formDirective(){return null}get path(){return null}},Kn=class extends ui{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},li=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},rg={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},GT=rt(De({},rg),{"[class.ng-submitted]":"isSubmitted"}),zT=(()=>{let e=class e extends li{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(X(Kn,2))},e.\u0275dir=je({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&fo("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[wt]});let t=e;return t})(),WT=(()=>{let e=class e extends li{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(X(Zt,10))},e.\u0275dir=je({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&fo("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[wt]});let t=e;return t})();var zn="VALID",ai="INVALID",Xt="PENDING",Wn="DISABLED";function nh(t){return(fi(t)?t.validators:t)||null}function ig(t){return Array.isArray(t)?yo(t):t||null}function rh(t,e){return(fi(e)?e.asyncValidators:t)||null}function sg(t){return Array.isArray(t)?vo(t):t||null}function fi(t){return t!=null&&!Array.isArray(t)&&typeof t=="object"}function og(t,e,n){let r=t.controls;if(!(e?Object.keys(r):r).length)throw new ii(1e3,"");if(!r[n])throw new ii(1001,"")}function ag(t,e,n){t._forEachChild((r,i)=>{if(n[i]===void 0)throw new ii(1002,"")})}var hi=class{constructor(e,n){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(n)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===zn}get invalid(){return this.status===ai}get pending(){return this.status==Xt}get disabled(){return this.status===Wn}get enabled(){return this.status!==Wn}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(Bl(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(Bl(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(ql(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(ql(e,this._rawAsyncValidators))}hasValidator(e){return ci(this._rawValidators,e)}hasAsyncValidator(e){return ci(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(n=>{n.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Xt,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let n=this._parentMarkedDirty(e.onlySelf);this.status=Wn,this.errors=null,this._forEachChild(r=>{r.disable(rt(De({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(rt(De({},e),{skipPristineCheck:n})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let n=this._parentMarkedDirty(e.onlySelf);this.status=zn,this._forEachChild(r=>{r.enable(rt(De({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(rt(De({},e),{skipPristineCheck:n})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===zn||this.status===Xt)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Wn:zn}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Xt,this._hasOwnPendingAsyncValidator=!0;let n=Xl(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,n={}){this.errors=e,this._updateControlsErrors(n.emitEvent!==!1)}get(e){let n=e;return n==null||(Array.isArray(n)||(n=n.split(".")),n.length===0)?null:n.reduce((r,i)=>r&&r._find(i),this)}getError(e,n){let r=n?this.get(n):this;return r&&r.errors?r.errors[e]:null}hasError(e,n){return!!this.getError(e,n)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Gn,this.statusChanges=new Gn}_calculateStatus(){return this._allControlsDisabled()?Wn:this.errors?ai:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Xt)?Xt:this._anyControlsHaveStatus(ai)?ai:zn}_anyControlsHaveStatus(e){return this._anyControls(n=>n.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){fi(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let n=this._parent&&this._parent.dirty;return!e&&!!n&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=ig(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=sg(this._rawAsyncValidators)}},di=class extends hi{constructor(e,n,r){super(nh(n),rh(r,n)),this.controls=e,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,n){return this.controls[e]?this.controls[e]:(this.controls[e]=n,n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange),n)}addControl(e,n,r={}){this.registerControl(e,n),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}setControl(e,n,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],n&&this.registerControl(e,n),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,n={}){ag(this,!0,e),Object.keys(e).forEach(r=>{og(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(e,n={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(e={},n={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this._reduceChildren({},(e,n,r)=>(e[r]=n.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(n,r)=>r._syncPendingControls()?!0:n);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(n=>{let r=this.controls[n];r&&e(r,n)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[n,r]of Object.entries(this.controls))if(this.contains(n)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(n,r,i)=>((r.enabled||this.disabled)&&(n[i]=r.value),n))}_reduceChildren(e,n){let r=e;return this._forEachChild((i,s)=>{r=n(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var Io=new me("CallSetDisabledState",{providedIn:"root",factory:()=>Eo}),Eo="always";function cg(t,e){return[...e.path,t]}function ih(t,e,n=Eo){sh(t,e),e.valueAccessor.writeValue(t.value),(t.disabled||n==="always")&&e.valueAccessor.setDisabledState?.(t.disabled),lg(t,e),dg(t,e),hg(t,e),ug(t,e)}function $l(t,e){t.forEach(n=>{n.registerOnValidatorChange&&n.registerOnValidatorChange(e)})}function ug(t,e){if(e.valueAccessor.setDisabledState){let n=r=>{e.valueAccessor.setDisabledState(r)};t.registerOnDisabledChange(n),e._registerOnDestroy(()=>{t._unregisterOnDisabledChange(n)})}}function sh(t,e){let n=tg(t);e.validator!==null?t.setValidators(Ul(n,e.validator)):typeof n=="function"&&t.setValidators([n]);let r=ng(t);e.asyncValidator!==null?t.setAsyncValidators(Ul(r,e.asyncValidator)):typeof r=="function"&&t.setAsyncValidators([r]);let i=()=>t.updateValueAndValidity();$l(e._rawValidators,i),$l(e._rawAsyncValidators,i)}function lg(t,e){e.valueAccessor.registerOnChange(n=>{t._pendingValue=n,t._pendingChange=!0,t._pendingDirty=!0,t.updateOn==="change"&&oh(t,e)})}function hg(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,t.updateOn==="blur"&&t._pendingChange&&oh(t,e),t.updateOn!=="submit"&&t.markAsTouched()})}function oh(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function dg(t,e){let n=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};t.registerOnChange(n),e._registerOnDestroy(()=>{t._unregisterOnChange(n)})}function fg(t,e){t==null,sh(t,e)}function pg(t,e){if(!t.hasOwnProperty("model"))return!1;let n=t.model;return n.isFirstChange()?!0:!Object.is(e,n.currentValue)}function mg(t){return Object.getPrototypeOf(t.constructor)===Km}function gg(t,e){t._syncPendingControls(),e.forEach(n=>{let r=n.control;r.updateOn==="submit"&&r._pendingChange&&(n.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function _g(t,e){if(!e)return null;Array.isArray(e);let n,r,i;return e.forEach(s=>{s.constructor===Kl?n=s:mg(s)?r=s:i=s}),i||r||n||null}var yg={provide:Zt,useExisting:si(()=>vg)},Hn=Promise.resolve(),vg=(()=>{let e=class e extends Zt{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._directives=new Set,this.ngSubmit=new Gn,this.form=new di({},yo(r),vo(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(r){Hn.then(()=>{let i=this._findContainer(r.path);r.control=i.registerControl(r.name,r.control),ih(r.control,r,this.callSetDisabledState),r.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(r)})}getControl(r){return this.form.get(r.path)}removeControl(r){Hn.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name),this._directives.delete(r)})}addFormGroup(r){Hn.then(()=>{let i=this._findContainer(r.path),s=new di({});fg(s,r),i.registerControl(r.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(r){Hn.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name)})}getFormGroup(r){return this.form.get(r.path)}updateModel(r,i){Hn.then(()=>{this.form.get(r.path).setValue(i)})}setValue(r){this.control.setValue(r)}onSubmit(r){return this.submitted=!0,gg(this.form,this._directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(r){return r.pop(),r.length?this.form.get(r):this.form}};e.\u0275fac=function(i){return new(i||e)(X(Ql,10),X(Jl,10),X(Io,8))},e.\u0275dir=je({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,s){i&1&&po("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{options:[jn.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[oi([yg]),wt]});let t=e;return t})();function jl(t,e){let n=t.indexOf(e);n>-1&&t.splice(n,1)}function Gl(t){return typeof t=="object"&&t!==null&&Object.keys(t).length===2&&"value"in t&&"disabled"in t}var Ig=class extends hi{constructor(e=null,n,r){super(nh(n),rh(r,n)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),fi(n)&&(n.nonNullable||n.initialValueIsDefault)&&(Gl(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,n={}){this.value=this._pendingValue=e,this._onChange.length&&n.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,n.emitViewToModelChange!==!1)),this.updateValueAndValidity(n)}patchValue(e,n={}){this.setValue(e,n)}reset(e=this.defaultValue,n={}){this._applyFormState(e),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){jl(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){jl(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){Gl(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var Eg={provide:Kn,useExisting:si(()=>wg)},zl=Promise.resolve(),wg=(()=>{let e=class e extends Kn{constructor(r,i,s,o,a,c){super(),this._changeDetectorRef=a,this.callSetDisabledState=c,this.control=new Ig,this._registered=!1,this.name="",this.update=new Gn,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=_g(this,o)}ngOnChanges(r){if(this._checkForErrors(),!this._registered||"name"in r){if(this._registered&&(this._checkName(),this.formDirective)){let i=r.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in r&&this._updateDisabled(r),pg(r,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){ih(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(r){zl.then(()=>{this.control.setValue(r,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(r){let i=r.isDisabled.currentValue,s=i!==0&&Ll(i);zl.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(r){return this._parent?cg(r,this._parent):[r]}};e.\u0275fac=function(i){return new(i||e)(X(Zt,9),X(Ql,10),X(Jl,10),X(Hl,10),X(Fl,8),X(Io,8))},e.\u0275dir=je({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[jn.None,"disabled","isDisabled"],model:[jn.None,"ngModel","model"],options:[jn.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[oi([Eg]),wt,kl]});let t=e;return t})(),KT=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=je({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let t=e;return t})();var Tg=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=$e({type:e}),e.\u0275inj=qe({});let t=e;return t})();var QT=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:Io,useValue:r.callSetDisabledState??Eo}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=$e({type:e}),e.\u0275inj=qe({imports:[Tg]});let t=e;return t})();var ch=function(t){let e=[],n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},Ag=function(t){let e=[],n=0,r=0;for(;n<t.length;){let i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=t[n++],o=t[n++],a=t[n++],c=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{let s=t[n++],o=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},uh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){let s=t[i],o=i+1<t.length,a=o?t[i+1]:0,c=i+2<t.length,u=c?t[i+2]:0,l=s>>2,d=(s&3)<<4|a>>4,f=(a&15)<<2|u>>6,m=u&63;c||(m=64,o||(f=64)),r.push(n[l],n[d],n[f],n[m])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(ch(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Ag(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();let n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){let s=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;let u=i<t.length?n[t.charAt(i)]:64;++i;let d=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||a==null||u==null||d==null)throw new To;let f=s<<2|a>>4;if(r.push(f),u!==64){let m=a<<4&240|u>>2;if(r.push(m),d!==64){let T=u<<6&192|d;r.push(T)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},To=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Sg=function(t){let e=ch(t);return uh.encodeByteArray(e,!0)},Jn=function(t){return Sg(t).replace(/\./g,"")},So=function(t){try{return uh.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function bg(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Cg=()=>bg().__FIREBASE_DEFAULTS__,Dg=()=>{if(typeof process>"u"||typeof process.env>"u")return;let t=process.env.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Rg=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=t&&So(t[1]);return e&&JSON.parse(e)},mi=()=>{try{return Cg()||Dg()||Rg()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},bo=t=>{var e,n;return(n=(e=mi())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},lh=t=>{let e=bo(t);if(!e)return;let n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Co=()=>{var t;return(t=mi())===null||t===void 0?void 0:t.config},Do=t=>{var e;return(e=mi())===null||e===void 0?void 0:e[`_${t}`]};var pi=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}};function hh(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[Jn(JSON.stringify(n)),Jn(JSON.stringify(o)),""].join(".")}function W(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function dh(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(W())}function Pg(){var t;let e=(t=mi())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function fh(){let t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function ph(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function mh(){let t=W();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function gh(){return!Pg()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ro(){try{return typeof indexedDB=="object"}catch{return!1}}function _h(){return new Promise((t,e)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){e(n)}})}var Ng="FirebaseError",he=class t extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=Ng,Object.setPrototypeOf(this,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ge.prototype.create)}},Ge=class{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){let r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?kg(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new he(i,a,r)}};function kg(t,e){return t.replace(Vg,(n,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Vg=/\{\$([^}]+)}/g;function yh(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Tt(t,e){if(t===e)return!0;let n=Object.keys(t),r=Object.keys(e);for(let i of n){if(!r.includes(i))return!1;let s=t[i],o=e[i];if(ah(s)&&ah(o)){if(!Tt(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!n.includes(i))return!1;return!0}function ah(t){return t!==null&&typeof t=="object"}function en(t){let e=[];for(let[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function tn(t){let e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function nn(t){let e=t.indexOf("?");if(!e)return"";let n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function vh(t,e){let n=new Ao(t,e);return n.subscribe.bind(n)}var Ao=class{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Og(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=wo),i.error===void 0&&(i.error=wo),i.complete===void 0&&(i.complete=wo);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Og(t,e){if(typeof t!="object"||t===null)return!1;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function wo(){}var XT=4*60*60*1e3;function Z(t){return t&&t._delegate?t._delegate:t}var _e=class{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var At="[DEFAULT]";var Po=class{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){let r=new pi;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(n=e?.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Mg(e))try{this.getOrInitializeService({instanceIdentifier:At})}catch{}for(let[n,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(n);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=At){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return h(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=At){return this.instances.has(e)}getOptions(e=At){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(let[s,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,n){var r;let i=this.normalizeInstanceIdentifier(n),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){let r=this.onInitCallbacks.get(n);if(r)for(let i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:xg(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=At){return this.component?this.component.multipleInstances?e:At:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function xg(t){return t===At?void 0:t}function Mg(t){return t.instantiationMode==="EAGER"}var gi=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let n=new Po(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}};var Fg=[],R=function(t){return t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT",t}(R||{}),Lg={debug:R.DEBUG,verbose:R.VERBOSE,info:R.INFO,warn:R.WARN,error:R.ERROR,silent:R.SILENT},Ug=R.INFO,Bg={[R.DEBUG]:"log",[R.VERBOSE]:"log",[R.INFO]:"info",[R.WARN]:"warn",[R.ERROR]:"error"},qg=(t,e,...n)=>{if(e<t.logLevel)return;let r=new Date().toISOString(),i=Bg[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},ot=class{constructor(e){this.name=e,this._logLevel=Ug,this._logHandler=qg,this._userLogHandler=null,Fg.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in R))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Lg[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,R.DEBUG,...e),this._logHandler(this,R.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,R.VERBOSE,...e),this._logHandler(this,R.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,R.INFO,...e),this._logHandler(this,R.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,R.WARN,...e),this._logHandler(this,R.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,R.ERROR,...e),this._logHandler(this,R.ERROR,...e)}};var $g=(t,e)=>e.some(n=>t instanceof n),Ih,Eh;function jg(){return Ih||(Ih=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Gg(){return Eh||(Eh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var wh=new WeakMap,ko=new WeakMap,Th=new WeakMap,No=new WeakMap,Oo=new WeakMap;function zg(t){let e=new Promise((n,r)=>{let i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(Re(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&wh.set(n,t)}).catch(()=>{}),Oo.set(e,t),e}function Wg(t){if(ko.has(t))return;let e=new Promise((n,r)=>{let i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});ko.set(t,e)}var Vo={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return ko.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Th.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Re(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Ah(t){Vo=t(Vo)}function Hg(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){let r=t.call(_i(this),e,...n);return Th.set(r,e.sort?e.sort():[e]),Re(r)}:Gg().includes(t)?function(...e){return t.apply(_i(this),e),Re(wh.get(this))}:function(...e){return Re(t.apply(_i(this),e))}}function Kg(t){return typeof t=="function"?Hg(t):(t instanceof IDBTransaction&&Wg(t),$g(t,jg())?new Proxy(t,Vo):t)}function Re(t){if(t instanceof IDBRequest)return zg(t);if(No.has(t))return No.get(t);let e=Kg(t);return e!==t&&(No.set(t,e),Oo.set(e,t)),e}var _i=t=>Oo.get(t);function bh(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(t,e),a=Re(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Re(o.result),c.oldVersion,c.newVersion,Re(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}var Qg=["get","getKey","getAll","getAllKeys","count"],Jg=["put","add","delete","clear"],xo=new Map;function Sh(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(xo.get(e))return xo.get(e);let n=e.replace(/FromIndex$/,""),r=e!==n,i=Jg.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Qg.includes(n)))return;let s=function(o,...a){return h(this,null,function*(){let c=this.transaction(o,i?"readwrite":"readonly"),u=c.store;return r&&(u=u.index(a.shift())),(yield Promise.all([u[n](...a),i&&c.done]))[0]})};return xo.set(e,s),s}Ah(t=>rt(De({},t),{get:(e,n,r)=>Sh(e,n)||t.get(e,n,r),has:(e,n)=>!!Sh(e,n)||t.has(e,n)}));var Fo=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Yg(n)){let r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}};function Yg(t){let e=t.getComponent();return e?.type==="VERSION"}var Lo="@firebase/app",Ch="0.10.2";var St=new ot("@firebase/app"),Xg="@firebase/app-compat",Zg="@firebase/analytics-compat",e_="@firebase/analytics",t_="@firebase/app-check-compat",n_="@firebase/app-check",r_="@firebase/auth",i_="@firebase/auth-compat",s_="@firebase/database",o_="@firebase/database-compat",a_="@firebase/functions",c_="@firebase/functions-compat",u_="@firebase/installations",l_="@firebase/installations-compat",h_="@firebase/messaging",d_="@firebase/messaging-compat",f_="@firebase/performance",p_="@firebase/performance-compat",m_="@firebase/remote-config",g_="@firebase/remote-config-compat",__="@firebase/storage",y_="@firebase/storage-compat",v_="@firebase/firestore",I_="@firebase/firestore-compat",E_="firebase",w_="10.11.1";var Uo="[DEFAULT]",T_={[Lo]:"fire-core",[Xg]:"fire-core-compat",[e_]:"fire-analytics",[Zg]:"fire-analytics-compat",[n_]:"fire-app-check",[t_]:"fire-app-check-compat",[r_]:"fire-auth",[i_]:"fire-auth-compat",[s_]:"fire-rtdb",[o_]:"fire-rtdb-compat",[a_]:"fire-fn",[c_]:"fire-fn-compat",[u_]:"fire-iid",[l_]:"fire-iid-compat",[h_]:"fire-fcm",[d_]:"fire-fcm-compat",[f_]:"fire-perf",[p_]:"fire-perf-compat",[m_]:"fire-rc",[g_]:"fire-rc-compat",[__]:"fire-gcs",[y_]:"fire-gcs-compat",[v_]:"fire-fst",[I_]:"fire-fst-compat","fire-js":"fire-js",[E_]:"fire-js-all"};var Yn=new Map,A_=new Map,Bo=new Map;function Dh(t,e){try{t.container.addComponent(e)}catch(n){St.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function ct(t){let e=t.name;if(Bo.has(e))return St.debug(`There were multiple attempts to register component ${e}.`),!1;Bo.set(e,t);for(let n of Yn.values())Dh(n,t);for(let n of A_.values())Dh(n,t);return!0}function Zn(t,e){let n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ye(t){return t.settings!==void 0}var S_={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},at=new Ge("app","Firebase",S_);var qo=class{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new _e("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw at.create("app-deleted",{appName:this._name})}};var ut=w_;function Go(t,e={}){let n=t;typeof e!="object"&&(e={name:e});let r=Object.assign({name:Uo,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw at.create("bad-app-name",{appName:String(i)});if(n||(n=Co()),!n)throw at.create("no-options");let s=Yn.get(i);if(s){if(Tt(n,s.options)&&Tt(r,s.config))return s;throw at.create("duplicate-app",{appName:i})}let o=new gi(i);for(let c of Bo.values())o.addComponent(c);let a=new qo(n,r,o);return Yn.set(i,a),a}function rn(t=Uo){let e=Yn.get(t);if(!e&&t===Uo&&Co())return Go();if(!e)throw at.create("no-app",{appName:t});return e}function yi(){return Array.from(Yn.values())}function H(t,e,n){var r;let i=(r=T_[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);let s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),St.warn(a.join(" "));return}ct(new _e(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var b_="firebase-heartbeat-database",C_=1,Xn="firebase-heartbeat-store",Mo=null;function kh(){return Mo||(Mo=bh(b_,C_,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Xn)}catch(n){console.warn(n)}}}}).catch(t=>{throw at.create("idb-open",{originalErrorMessage:t.message})})),Mo}function D_(t){return h(this,null,function*(){try{let n=(yield kh()).transaction(Xn),r=yield n.objectStore(Xn).get(Vh(t));return yield n.done,r}catch(e){if(e instanceof he)St.warn(e.message);else{let n=at.create("idb-get",{originalErrorMessage:e?.message});St.warn(n.message)}}})}function Rh(t,e){return h(this,null,function*(){try{let r=(yield kh()).transaction(Xn,"readwrite");yield r.objectStore(Xn).put(e,Vh(t)),yield r.done}catch(n){if(n instanceof he)St.warn(n.message);else{let r=at.create("idb-set",{originalErrorMessage:n?.message});St.warn(r.message)}}})}function Vh(t){return`${t.name}!${t.options.appId}`}var R_=1024,P_=30*24*60*60*1e3,$o=class{constructor(e){this.container=e,this._heartbeatsCache=null;let n=this.container.getProvider("app").getImmediate();this._storage=new jo(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return h(this,null,function*(){var e,n;let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Ph();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let a=new Date(o.date).valueOf();return Date.now()-a<=P_}),this._storage.overwrite(this._heartbeatsCache)})}getHeartbeatsHeader(){return h(this,null,function*(){var e;if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let n=Ph(),{heartbeatsToSend:r,unsentEntries:i}=N_(this._heartbeatsCache.heartbeats),s=Jn(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s})}};function Ph(){return new Date().toISOString().substring(0,10)}function N_(t,e=R_){let n=[],r=t.slice();for(let i of t){let s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),Nh(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Nh(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}var jo=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return h(this,null,function*(){return Ro()?_h().then(()=>!0).catch(()=>!1):!1})}read(){return h(this,null,function*(){if(yield this._canUseIndexedDBPromise){let n=yield D_(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return h(this,null,function*(){var n;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Rh(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return h(this,null,function*(){var n;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Rh(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function Nh(t){return Jn(JSON.stringify({version:2,heartbeats:t})).length}function k_(t){ct(new _e("platform-logger",e=>new Fo(e),"PRIVATE")),ct(new _e("heartbeat",e=>new $o(e),"PRIVATE")),H(Lo,Ch,t),H(Lo,Ch,"esm2017"),H("fire-js","")}k_("");var V_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},we={},_,da=da||{},b=V_||self;function ki(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function fr(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function O_(t){return Object.prototype.hasOwnProperty.call(t,zo)&&t[zo]||(t[zo]=++x_)}var zo="closure_uid_"+(1e9*Math.random()>>>0),x_=0;function M_(t,e,n){return t.call.apply(t.bind,arguments)}function F_(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function ie(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?ie=M_:ie=F_,ie.apply(null,arguments)}function vi(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),t.apply(this,r)}}function J(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function lt(){this.s=this.s,this.o=this.o}var L_=0;lt.prototype.s=!1;lt.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),L_!=0)&&O_(this)};lt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Wh=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function fa(t){let e=t.length;if(0<e){let n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Oh(t,e){for(let n=1;n<arguments.length;n++){let r=arguments[n];if(ki(r)){let i=t.length||0,s=r.length||0;t.length=i+s;for(let o=0;o<s;o++)t[i+o]=r[o]}else t.push(r)}}function se(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}se.prototype.h=function(){this.defaultPrevented=!0};var U_=function(){if(!b.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{let n=()=>{};b.addEventListener("test",n,e),b.removeEventListener("test",n,e)}catch{}return t}();function sr(t){return/^[\s\xa0]*$/.test(t)}function Vi(){var t=b.navigator;return t&&(t=t.userAgent)?t:""}function Pe(t){return Vi().indexOf(t)!=-1}function pa(t){return pa[" "](t),t}pa[" "]=function(){};function B_(t,e){var n=Dy;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}var q_=Pe("Opera"),cn=Pe("Trident")||Pe("MSIE"),Hh=Pe("Edge"),Jo=Hh||cn,Kh=Pe("Gecko")&&!(Vi().toLowerCase().indexOf("webkit")!=-1&&!Pe("Edge"))&&!(Pe("Trident")||Pe("MSIE"))&&!Pe("Edge"),$_=Vi().toLowerCase().indexOf("webkit")!=-1&&!Pe("Edge");function Qh(){var t=b.document;return t?t.documentMode:void 0}var Yo;e:{if(Ii="",Ei=function(){var t=Vi();if(Kh)return/rv:([^\);]+)(\)|;)/.exec(t);if(Hh)return/Edge\/([\d\.]+)/.exec(t);if(cn)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if($_)return/WebKit\/(\S+)/.exec(t);if(q_)return/(?:Version)[ \/]?(\S+)/.exec(t)}(),Ei&&(Ii=Ei?Ei[1]:""),cn&&(wi=Qh(),wi!=null&&wi>parseFloat(Ii))){Yo=String(wi);break e}Yo=Ii}var Ii,Ei,wi,Xo;b.document&&cn?(Wo=Qh(),Xo=Wo||parseInt(Yo,10)||void 0):Xo=void 0;var Wo,j_=Xo;function or(t,e){if(se.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Kh){e:{try{pa(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:G_[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&or.$.h.call(this)}}J(or,se);var G_={2:"touch",3:"pen",4:"mouse"};or.prototype.h=function(){or.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var pr="closure_listenable_"+(1e6*Math.random()|0),z_=0;function W_(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=i,this.key=++z_,this.fa=this.ia=!1}function Oi(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function ma(t,e,n){for(let r in t)e.call(n,t[r],r,t)}function H_(t,e){for(let n in t)e.call(void 0,t[n],n,t)}function Jh(t){let e={};for(let n in t)e[n]=t[n];return e}var xh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Yh(t,e){let n,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(n in r)t[n]=r[n];for(let s=0;s<xh.length;s++)n=xh[s],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function xi(t){this.src=t,this.g={},this.h=0}xi.prototype.add=function(t,e,n,r,i){var s=t.toString();t=this.g[s],t||(t=this.g[s]=[],this.h++);var o=ea(t,e,r,i);return-1<o?(e=t[o],n||(e.ia=!1)):(e=new W_(e,this.src,s,!!r,i),e.ia=n,t.push(e)),e};function Zo(t,e){var n=e.type;if(n in t.g){var r=t.g[n],i=Wh(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Oi(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function ea(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==r)return i}return-1}var ga="closure_lm_"+(1e6*Math.random()|0),Ho={};function Xh(t,e,n,r,i){if(r&&r.once)return ed(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Xh(t,e[s],n,r,i);return null}return n=va(n),t&&t[pr]?t.O(e,n,fr(r)?!!r.capture:!!r,i):Zh(t,e,n,!1,r,i)}function Zh(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=fr(i)?!!i.capture:!!i,a=ya(t);if(a||(t[ga]=a=new xi(t)),n=a.add(e,n,r,o,s),n.proxy)return n;if(r=K_(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)U_||(i=o),i===void 0&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(nd(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function K_(){function t(n){return e.call(t.src,t.listener,n)}let e=Q_;return t}function ed(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)ed(t,e[s],n,r,i);return null}return n=va(n),t&&t[pr]?t.P(e,n,fr(r)?!!r.capture:!!r,i):Zh(t,e,n,!0,r,i)}function td(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)td(t,e[s],n,r,i);else r=fr(r)?!!r.capture:!!r,n=va(n),t&&t[pr]?(t=t.i,e=String(e).toString(),e in t.g&&(s=t.g[e],n=ea(s,n,r,i),-1<n&&(Oi(s[n]),Array.prototype.splice.call(s,n,1),s.length==0&&(delete t.g[e],t.h--)))):t&&(t=ya(t))&&(e=t.g[e.toString()],t=-1,e&&(t=ea(e,n,r,i)),(n=-1<t?e[t]:null)&&_a(n))}function _a(t){if(typeof t!="number"&&t&&!t.fa){var e=t.src;if(e&&e[pr])Zo(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(nd(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ya(e))?(Zo(n,t),n.h==0&&(n.src=null,e[ga]=null)):Oi(t)}}}function nd(t){return t in Ho?Ho[t]:Ho[t]="on"+t}function Q_(t,e){if(t.fa)t=!0;else{e=new or(e,this);var n=t.listener,r=t.la||t.src;t.ia&&_a(t),t=n.call(r,e)}return t}function ya(t){return t=t[ga],t instanceof xi?t:null}var Ko="__closure_events_fn_"+(1e9*Math.random()>>>0);function va(t){return typeof t=="function"?t:(t[Ko]||(t[Ko]=function(e){return t.handleEvent(e)}),t[Ko])}function Q(){lt.call(this),this.i=new xi(this),this.S=this,this.J=null}J(Q,lt);Q.prototype[pr]=!0;Q.prototype.removeEventListener=function(t,e,n,r){td(this,t,e,n,r)};function te(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,typeof e=="string")e=new se(e,t);else if(e instanceof se)e.target=e.target||t;else{var i=e;e=new se(r,t),Yh(e,i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=Ti(o,r,!0,e)&&i}if(o=e.g=t,i=Ti(o,r,!0,e)&&i,i=Ti(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)o=e.g=n[s],i=Ti(o,r,!1,e)&&i}Q.prototype.N=function(){if(Q.$.N.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Oi(n[r]);delete t.g[e],t.h--}}this.J=null};Q.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)};Q.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};function Ti(t,e,n,r){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Zo(t.i,o),i=a.call(c,r)!==!1&&i}}return i&&!r.defaultPrevented}var Ia=b.JSON.stringify,ta=class{constructor(e,n){this.i=e,this.j=n,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function J_(){var t=Ea;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var na=class{constructor(){this.h=this.g=null}add(e,n){let r=rd.get();r.set(e,n),this.h?this.h.next=r:this.g=r,this.h=r}},rd=new ta(()=>new ra,t=>t.reset()),ra=class{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}};function Y_(t){var e=1;t=t.split(":");let n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function X_(t){b.setTimeout(()=>{throw t},0)}var ar,cr=!1,Ea=new na,id=()=>{let t=b.Promise.resolve(void 0);ar=()=>{t.then(Z_)}},Z_=()=>{for(var t;t=J_();){try{t.h.call(t.g)}catch(n){X_(n)}var e=rd;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}cr=!1};function Mi(t,e){Q.call(this),this.h=t||1,this.g=e||b,this.j=ie(this.qb,this),this.l=Date.now()}J(Mi,Q);_=Mi.prototype;_.ga=!1;_.T=null;_.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),te(this,"tick"),this.ga&&(wa(this),this.start()))}};_.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function wa(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}_.N=function(){Mi.$.N.call(this),wa(this),delete this.g};function Ta(t,e,n){if(typeof t=="function")n&&(t=ie(t,n));else if(t&&typeof t.handleEvent=="function")t=ie(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:b.setTimeout(t,e||0)}function sd(t){t.g=Ta(()=>{t.g=null,t.i&&(t.i=!1,sd(t))},t.j);let e=t.h;t.h=null,t.m.apply(null,e)}var ia=class extends lt{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:sd(this)}N(){super.N(),this.g&&(b.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function ur(t){lt.call(this),this.h=t,this.g={}}J(ur,lt);var Mh=[];function od(t,e,n,r){Array.isArray(n)||(n&&(Mh[0]=n.toString()),n=Mh);for(var i=0;i<n.length;i++){var s=Xh(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function ad(t){ma(t.g,function(e,n){this.g.hasOwnProperty(n)&&_a(e)},t),t.g={}}ur.prototype.N=function(){ur.$.N.call(this),ad(this)};ur.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Fi(){this.g=!0}Fi.prototype.Ea=function(){this.g=!1};function ey(t,e,n,r,i,s){t.info(function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var d=l.split("_");o=2<=d.length&&d[1]=="type"?o+(l+"="+u+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+n+`
`+o})}function ty(t,e,n,r,i,s,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+n+`
`+s+" "+o})}function on(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+ry(t,n)+(r?" "+r:"")})}function ny(t,e){t.info(function(){return"TIMEOUT: "+e})}Fi.prototype.info=function(){};function ry(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Ia(n)}catch{return e}}var Rt={},Fh=null;function Li(){return Fh=Fh||new Q}Rt.Ta="serverreachability";function cd(t){se.call(this,Rt.Ta,t)}J(cd,se);function lr(t){let e=Li();te(e,new cd(e))}Rt.STAT_EVENT="statevent";function ud(t,e){se.call(this,Rt.STAT_EVENT,t),this.stat=e}J(ud,se);function ce(t){let e=Li();te(e,new ud(e,t))}Rt.Ua="timingevent";function ld(t,e){se.call(this,Rt.Ua,t),this.size=e}J(ld,se);function mr(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return b.setTimeout(function(){t()},e)}var Ui={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},hd={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Aa(){}Aa.prototype.h=null;function Lh(t){return t.h||(t.h=t.i())}function dd(){}var gr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Sa(){se.call(this,"d")}J(Sa,se);function ba(){se.call(this,"c")}J(ba,se);var sa;function Bi(){}J(Bi,Aa);Bi.prototype.g=function(){return new XMLHttpRequest};Bi.prototype.i=function(){return{}};sa=new Bi;function _r(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new ur(this),this.P=iy,t=Jo?125:void 0,this.V=new Mi(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new fd}function fd(){this.i=null,this.g="",this.h=!1}var iy=45e3,pd={},oa={};_=_r.prototype;_.setTimeout=function(t){this.P=t};function aa(t,e,n){t.L=1,t.A=$i(We(e)),t.u=n,t.S=!0,md(t,null)}function md(t,e){t.G=Date.now(),yr(t),t.B=We(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),Td(n.i,"t",r),t.o=0,n=t.l.J,t.h=new fd,t.g=Gd(t.l,n?e:null,!t.u),0<t.O&&(t.M=new ia(ie(t.Pa,t,t.g),t.O)),od(t.U,t.g,"readystatechange",t.nb),e=t.I?Jh(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),lr(),ey(t.j,t.v,t.B,t.m,t.W,t.u)}_.nb=function(t){t=t.target;let e=this.M;e&&Ne(t)==3?e.l():this.Pa(t)};_.Pa=function(t){try{if(t==this.g)e:{let l=Ne(this.g);var e=this.g.Ia();let d=this.g.da();if(!(3>l)&&(l!=3||Jo||this.g&&(this.h.h||this.g.ja()||$h(this.g)))){this.J||l!=4||e==7||(e==8||0>=d?lr(3):lr(2)),qi(this);var n=this.g.da();this.ca=n;t:if(gd(this)){var r=$h(this.g);t="";var i=r.length,s=Ne(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){bt(this),ir(this);var o="";break t}this.h.i=new b.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,ty(this.j,this.v,this.B,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!sr(a)){var u=a;break t}}u=null}if(n=u)on(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ca(this,n);else{this.i=!1,this.s=3,ce(12),bt(this),ir(this);break e}}this.S?(_d(this,l,o),Jo&&this.i&&l==3&&(od(this.U,this.V,"tick",this.mb),this.V.start())):(on(this.j,this.m,o,null),ca(this,o)),l==4&&bt(this),this.i&&!this.J&&(l==4?Bd(this.l,this):(this.i=!1,yr(this)))}else Sy(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.s=3,ce(12)):(this.s=0,ce(13)),bt(this),ir(this)}}}catch{}finally{}};function gd(t){return t.g?t.v=="GET"&&t.L!=2&&t.l.Ha:!1}function _d(t,e,n){let r=!0,i;for(;!t.J&&t.o<n.length;)if(i=sy(t,n),i==oa){e==4&&(t.s=4,ce(14),r=!1),on(t.j,t.m,null,"[Incomplete Response]");break}else if(i==pd){t.s=4,ce(15),on(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}else on(t.j,t.m,i,null),ca(t,i);gd(t)&&t.o!=0&&(t.h.g=t.h.g.slice(t.o),t.o=0),e!=4||n.length!=0||t.h.h||(t.s=1,ce(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,e=t.l,e.g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),ka(e),e.M=!0,ce(11))):(on(t.j,t.m,n,"[Invalid Chunked Response]"),bt(t),ir(t))}_.mb=function(){if(this.g){var t=Ne(this.g),e=this.g.ja();this.o<e.length&&(qi(this),_d(this,t,e),this.i&&t!=4&&yr(this))}};function sy(t,e){var n=t.o,r=e.indexOf(`
`,n);return r==-1?oa:(n=Number(e.substring(n,r)),isNaN(n)?pd:(r+=1,r+n>e.length?oa:(e=e.slice(r,r+n),t.o=r+n,e)))}_.cancel=function(){this.J=!0,bt(this)};function yr(t){t.Y=Date.now()+t.P,yd(t,t.P)}function yd(t,e){if(t.C!=null)throw Error("WatchDog timer not null");t.C=mr(ie(t.lb,t),e)}function qi(t){t.C&&(b.clearTimeout(t.C),t.C=null)}_.lb=function(){this.C=null;let t=Date.now();0<=t-this.Y?(ny(this.j,this.B),this.L!=2&&(lr(),ce(17)),bt(this),this.s=2,ir(this)):yd(this,this.Y-t)};function ir(t){t.l.H==0||t.J||Bd(t.l,t)}function bt(t){qi(t);var e=t.M;e&&typeof e.sa=="function"&&e.sa(),t.M=null,wa(t.V),ad(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function ca(t,e){try{var n=t.l;if(n.H!=0&&(n.g==t||ua(n.i,t))){if(!t.K&&ua(n.i,t)&&n.H==3){try{var r=n.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!n.u){if(n.g)if(n.g.G+3e3<t.G)Di(n),zi(n);else break e;Na(n),ce(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&n.A==0&&!n.v&&(n.v=mr(ie(n.ib,n),6e3));if(1>=bd(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else Ct(n,11)}else if((t.K||n.g==t)&&Di(n),!sr(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.V=u[0],u=u[1],n.H==2)if(u[0]=="c"){n.K=u[1],n.pa=u[2];let l=u[3];l!=null&&(n.ra=l,n.l.info("VER="+n.ra));let d=u[4];d!=null&&(n.Ga=d,n.l.info("SVER="+n.Ga));let f=u[5];f!=null&&typeof f=="number"&&0<f&&(r=1.5*f,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let m=t.g;if(m){let T=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(T){var s=r.i;s.g||T.indexOf("spdy")==-1&&T.indexOf("quic")==-1&&T.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Ca(s,s.h),s.h=null))}if(r.F){let S=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(r.Da=S,M(r.I,r.F,S))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var o=t;if(r.wa=jd(r,r.J?r.pa:null,r.Y),o.K){Cd(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(qi(a),yr(a)),r.g=o}else Ld(r);0<n.j.length&&Wi(n)}else u[0]!="stop"&&u[0]!="close"||Ct(n,7);else n.H==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?Ct(n,7):Pa(n):u[0]!="noop"&&n.h&&n.h.Aa(u),n.A=0)}}lr(4)}catch{}}function oy(t){if(t.Z&&typeof t.Z=="function")return t.Z();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(ki(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}e=[],n=0;for(r in t)e[n++]=t[r];return e}function ay(t){if(t.ta&&typeof t.ta=="function")return t.ta();if(!t.Z||typeof t.Z!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(ki(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(let r in t)e[n++]=r;return e}}}function vd(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(ki(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=ay(t),r=oy(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}var Id=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function cy(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Dt(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Dt){this.h=t.h,bi(this,t.j),this.s=t.s,this.g=t.g,Ci(this,t.m),this.l=t.l;var e=t.i,n=new hr;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Uh(this,n),this.o=t.o}else t&&(e=String(t).match(Id))?(this.h=!1,bi(this,e[1]||"",!0),this.s=nr(e[2]||""),this.g=nr(e[3]||"",!0),Ci(this,e[4]),this.l=nr(e[5]||"",!0),Uh(this,e[6]||"",!0),this.o=nr(e[7]||"")):(this.h=!1,this.i=new hr(null,this.h))}Dt.prototype.toString=function(){var t=[],e=this.j;e&&t.push(rr(e,Bh,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(rr(e,Bh,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(rr(n,n.charAt(0)=="/"?hy:ly,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",rr(n,fy)),t.join("")};function We(t){return new Dt(t)}function bi(t,e,n){t.j=n?nr(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ci(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Uh(t,e,n){e instanceof hr?(t.i=e,py(t.i,t.h)):(n||(e=rr(e,dy)),t.i=new hr(e,t.h))}function M(t,e,n){t.i.set(e,n)}function $i(t){return M(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function nr(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function rr(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,uy),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function uy(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var Bh=/[#\/\?@]/g,ly=/[#\?:]/g,hy=/[#\?]/g,dy=/[#\?@]/g,fy=/#/g;function hr(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function ht(t){t.g||(t.g=new Map,t.h=0,t.i&&cy(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}_=hr.prototype;_.add=function(t,e){ht(this),this.i=null,t=un(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function Ed(t,e){ht(t),e=un(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function wd(t,e){return ht(t),e=un(t,e),t.g.has(e)}_.forEach=function(t,e){ht(this),this.g.forEach(function(n,r){n.forEach(function(i){t.call(e,i,r,this)},this)},this)};_.ta=function(){ht(this);let t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){let i=t[r];for(let s=0;s<i.length;s++)n.push(e[r])}return n};_.Z=function(t){ht(this);let e=[];if(typeof t=="string")wd(this,t)&&(e=e.concat(this.g.get(un(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};_.set=function(t,e){return ht(this),this.i=null,t=un(this,t),wd(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};_.get=function(t,e){return t?(t=this.Z(t),0<t.length?String(t[0]):e):e};function Td(t,e,n){Ed(t,e),0<n.length&&(t.i=null,t.g.set(un(t,e),fa(n)),t.h+=n.length)}_.toString=function(){if(this.i)return this.i;if(!this.g)return"";let t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};function un(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function py(t,e){e&&!t.j&&(ht(t),t.i=null,t.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(Ed(this,r),Td(this,i,n))},t)),t.j=e}var my=class{constructor(t,e){this.g=t,this.map=e}};function Ad(t){this.l=t||gy,b.PerformanceNavigationTiming?(t=b.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(b.g&&b.g.Ka&&b.g.Ka()&&b.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var gy=10;function Sd(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function bd(t){return t.h?1:t.g?t.g.size:0}function ua(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function Ca(t,e){t.g?t.g.add(e):t.h=e}function Cd(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}Ad.prototype.cancel=function(){if(this.i=Dd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let t of this.g.values())t.cancel();this.g.clear()}};function Dd(t){if(t.h!=null)return t.i.concat(t.h.F);if(t.g!=null&&t.g.size!==0){let e=t.i;for(let n of t.g.values())e=e.concat(n.F);return e}return fa(t.i)}var _y=class{stringify(t){return b.JSON.stringify(t,void 0)}parse(t){return b.JSON.parse(t,void 0)}};function yy(){this.g=new _y}function vy(t,e,n){let r=n||"";try{vd(t,function(i,s){let o=i;fr(i)&&(o=Ia(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Iy(t,e){let n=new Fi;if(b.Image){let r=new Image;r.onload=vi(Ai,n,r,"TestLoadImage: loaded",!0,e),r.onerror=vi(Ai,n,r,"TestLoadImage: error",!1,e),r.onabort=vi(Ai,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=vi(Ai,n,r,"TestLoadImage: timeout",!1,e),b.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}function Ai(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function vr(t){this.l=t.ec||null,this.j=t.ob||!1}J(vr,Aa);vr.prototype.g=function(){return new ji(this.l,this.j)};vr.prototype.i=function(t){return function(){return t}}({});function ji(t,e){Q.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=Da,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}J(ji,Q);var Da=0;_=ji.prototype;_.open=function(t,e){if(this.readyState!=Da)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,dr(this)};_.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||b).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};_.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ir(this)),this.readyState=Da};_.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,dr(this)),this.g&&(this.readyState=3,dr(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof b.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Rd(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))};function Rd(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}_.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ir(this):dr(this),this.readyState==3&&Rd(this)}};_.Za=function(t){this.g&&(this.response=this.responseText=t,Ir(this))};_.Ya=function(t){this.g&&(this.response=t,Ir(this))};_.ka=function(){this.g&&Ir(this)};function Ir(t){t.readyState=4,t.l=null,t.j=null,t.A=null,dr(t)}_.setRequestHeader=function(t,e){this.v.append(t,e)};_.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};_.getAllResponseHeaders=function(){if(!this.h)return"";let t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function dr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(ji.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var Ey=b.JSON.parse;function U(t){Q.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Pd,this.L=this.M=!1}J(U,Q);var Pd="",wy=/^https?$/i,Ty=["POST","PUT"];_=U.prototype;_.Oa=function(t){this.M=t};_.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():sa.g(),this.C=this.u?Lh(this.u):Lh(sa),this.g.onreadystatechange=ie(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(s){qh(this,s);return}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())n.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(s=>s.toLowerCase()=="content-type"),i=b.FormData&&t instanceof b.FormData,!(0<=Wh(Ty,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of n)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Vd(this),0<this.B&&((this.L=Ay(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ie(this.ua,this)):this.A=Ta(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(s){qh(this,s)}};function Ay(t){return cn&&typeof t.timeout=="number"&&t.ontimeout!==void 0}_.ua=function(){typeof da<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,te(this,"timeout"),this.abort(8))};function qh(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Nd(t),Gi(t)}function Nd(t){t.F||(t.F=!0,te(t,"complete"),te(t,"error"))}_.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,te(this,"complete"),te(this,"abort"),Gi(this))};_.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Gi(this,!0)),U.$.N.call(this)};_.La=function(){this.s||(this.G||this.v||this.l?kd(this):this.kb())};_.kb=function(){kd(this)};function kd(t){if(t.h&&typeof da<"u"&&(!t.C[1]||Ne(t)!=4||t.da()!=2)){if(t.v&&Ne(t)==4)Ta(t.La,0,t);else if(te(t,"readystatechange"),Ne(t)==4){t.h=!1;try{let o=t.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var r;if(r=o===0){var i=String(t.I).match(Id)[1]||null;!i&&b.self&&b.self.location&&(i=b.self.location.protocol.slice(0,-1)),r=!wy.test(i?i.toLowerCase():"")}n=r}if(n)te(t,"complete"),te(t,"success");else{t.m=6;try{var s=2<Ne(t)?t.g.statusText:""}catch{s=""}t.j=s+" ["+t.da()+"]",Nd(t)}}finally{Gi(t)}}}}function Gi(t,e){if(t.g){Vd(t);let n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||te(t,"ready");try{n.onreadystatechange=r}catch{}}}function Vd(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(b.clearTimeout(t.A),t.A=null)}_.isActive=function(){return!!this.g};function Ne(t){return t.g?t.g.readyState:0}_.da=function(){try{return 2<Ne(this)?this.g.status:-1}catch{return-1}};_.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};_.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),Ey(e)}};function $h(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Pd:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}function Sy(t){let e={};t=(t.g&&2<=Ne(t)&&t.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<t.length;r++){if(sr(t[r]))continue;var n=Y_(t[r]);let i=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();let s=e[i]||[];e[i]=s,s.push(n)}H_(e,function(r){return r.join(", ")})}_.Ia=function(){return this.m};_.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Od(t){let e="";return ma(t,function(n,r){e+=r,e+=":",e+=n,e+=`\r
`}),e}function Ra(t,e,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Od(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):M(t,e,n))}function er(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function xd(t){this.Ga=0,this.j=[],this.l=new Fi,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=er("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=er("baseRetryDelayMs",5e3,t),this.hb=er("retryDelaySeedMs",1e4,t),this.eb=er("forwardChannelMaxRetries",2,t),this.xa=er("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Ad(t&&t.concurrentRequestLimit),this.Ja=new yy,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}_=xd.prototype;_.ra=8;_.H=1;function Pa(t){if(Md(t),t.H==3){var e=t.W++,n=We(t.I);if(M(n,"SID",t.K),M(n,"RID",e),M(n,"TYPE","terminate"),Er(t,n),e=new _r(t,t.l,e),e.L=2,e.A=$i(We(n)),n=!1,b.navigator&&b.navigator.sendBeacon)try{n=b.navigator.sendBeacon(e.A.toString(),"")}catch{}!n&&b.Image&&(new Image().src=e.A,n=!0),n||(e.g=Gd(e.l,null),e.g.ha(e.A)),e.G=Date.now(),yr(e)}$d(t)}function zi(t){t.g&&(ka(t),t.g.cancel(),t.g=null)}function Md(t){zi(t),t.u&&(b.clearTimeout(t.u),t.u=null),Di(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&b.clearTimeout(t.m),t.m=null)}function Wi(t){if(!Sd(t.i)&&!t.m){t.m=!0;var e=t.Na;ar||id(),cr||(ar(),cr=!0),Ea.add(e,t),t.C=0}}function by(t,e){return bd(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.j=e.F.concat(t.j),!0):t.H==1||t.H==2||t.C>=(t.cb?0:t.eb)?!1:(t.m=mr(ie(t.Na,t,e),qd(t,t.C)),t.C++,!0)}_.Na=function(t){if(this.m)if(this.m=null,this.H==1){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;let i=new _r(this,this.l,t),s=this.s;if(this.U&&(s?(s=Jh(s),Yh(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=n;break e}if(e===4096||n===this.j.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=Fd(this,i,e),n=We(this.I),M(n,"RID",t),M(n,"CVER",22),this.F&&M(n,"X-HTTP-Session-Id",this.F),Er(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Od(s)))+"&"+e:this.o&&Ra(n,this.o,s)),Ca(this.i,i),this.bb&&M(n,"TYPE","init"),this.P?(M(n,"$req",e),M(n,"SID","null"),i.aa=!0,aa(i,n,null)):aa(i,n,e),this.H=2}}else this.H==3&&(t?jh(this,t):this.j.length==0||Sd(this.i)||jh(this))};function jh(t,e){var n;e?n=e.m:n=t.W++;let r=We(t.I);M(r,"SID",t.K),M(r,"RID",n),M(r,"AID",t.V),Er(t,r),t.o&&t.s&&Ra(r,t.o,t.s),n=new _r(t,t.l,n,t.C+1),t.o===null&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Fd(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Ca(t.i,n),aa(n,r,e)}function Er(t,e){t.na&&ma(t.na,function(n,r){M(e,r,n)}),t.h&&vd({},function(n,r){M(e,r,n)})}function Fd(t,e,n){n=Math.min(t.j.length,n);var r=t.h?ie(t.h.Va,t.h,t):null;e:{var i=t.j;let s=-1;for(;;){let o=["count="+n];s==-1?0<n?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<n;c++){let u=i[c].g,l=i[c].map;if(u-=s,0>u)s=Math.max(0,i[c].g-100),a=!1;else try{vy(l,o,"req"+u+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return t=t.j.splice(0,n),e.F=t,r}function Ld(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;ar||id(),cr||(ar(),cr=!0),Ea.add(e,t),t.A=0}}function Na(t){return t.g||t.u||3<=t.A?!1:(t.ba++,t.u=mr(ie(t.Ma,t),qd(t,t.A)),t.A++,!0)}_.Ma=function(){if(this.u=null,Ud(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=mr(ie(this.jb,this),t)}};_.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ce(10),zi(this),Ud(this))};function ka(t){t.B!=null&&(b.clearTimeout(t.B),t.B=null)}function Ud(t){t.g=new _r(t,t.l,"rpc",t.ba),t.o===null&&(t.g.I=t.s),t.g.O=0;var e=We(t.wa);M(e,"RID","rpc"),M(e,"SID",t.K),M(e,"AID",t.V),M(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&M(e,"TO",t.qa),M(e,"TYPE","xmlhttp"),Er(t,e),t.o&&t.s&&Ra(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=$i(We(e)),n.u=null,n.S=!0,md(n,t)}_.ib=function(){this.v!=null&&(this.v=null,zi(this),Na(this),ce(19))};function Di(t){t.v!=null&&(b.clearTimeout(t.v),t.v=null)}function Bd(t,e){var n=null;if(t.g==e){Di(t),ka(t),t.g=null;var r=2}else if(ua(t.i,e))n=e.F,Cd(t.i,e),r=1;else return;if(t.H!=0){if(e.i)if(r==1){n=e.u?e.u.length:0,e=Date.now()-e.G;var i=t.C;r=Li(),te(r,new ld(r,n)),Wi(t)}else Ld(t);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&by(t,e)||r==2&&Na(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Ct(t,5);break;case 4:Ct(t,10);break;case 3:Ct(t,6);break;default:Ct(t,2)}}}function qd(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Ct(t,e){if(t.l.info("Error code "+e),e==2){var n=null;t.h&&(n=null);var r=ie(t.pb,t);n||(n=new Dt("//www.google.com/images/cleardot.gif"),b.location&&b.location.protocol=="http"||bi(n,"https"),$i(n)),Iy(n.toString(),r)}else ce(2);t.H=0,t.h&&t.h.za(e),$d(t),Md(t)}_.pb=function(t){t?(this.l.info("Successfully pinged google.com"),ce(2)):(this.l.info("Failed to ping google.com"),ce(1))};function $d(t){if(t.H=0,t.ma=[],t.h){let e=Dd(t.i);(e.length!=0||t.j.length!=0)&&(Oh(t.ma,e),Oh(t.ma,t.j),t.i.i.length=0,fa(t.j),t.j.length=0),t.h.ya()}}function jd(t,e,n){var r=n instanceof Dt?We(n):new Dt(n);if(r.g!="")e&&(r.g=e+"."+r.g),Ci(r,r.m);else{var i=b.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Dt(null);r&&bi(s,r),e&&(s.g=e),i&&Ci(s,i),n&&(s.l=n),r=s}return n=t.F,e=t.Da,n&&e&&M(r,n,e),M(r,"VER",t.ra),Er(t,r),r}function Gd(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=t.Ha&&!t.va?new U(new vr({ob:n})):new U(t.va),e.Oa(t.J),e}_.isActive=function(){return!!this.h&&this.h.isActive(this)};function zd(){}_=zd.prototype;_.Ba=function(){};_.Aa=function(){};_.za=function(){};_.ya=function(){};_.isActive=function(){return!0};_.Va=function(){};function Ri(){if(cn&&!(10<=Number(j_)))throw Error("Environmental error: no available transport.")}Ri.prototype.g=function(t,e){return new de(t,e)};function de(t,e){Q.call(this),this.g=new xd(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!sr(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!sr(e)&&(this.g.F=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new ln(this)}J(de,Q);de.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;ce(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=jd(t,null,t.Y),Wi(t)};de.prototype.close=function(){Pa(this.g)};de.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=Ia(t),t=n);e.j.push(new my(e.fb++,t)),e.H==3&&Wi(e)};de.prototype.N=function(){this.g.h=null,delete this.j,Pa(this.g),delete this.g,de.$.N.call(this)};function Wd(t){Sa.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){e:{for(let n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}J(Wd,Sa);function Hd(){ba.call(this),this.status=1}J(Hd,ba);function ln(t){this.g=t}J(ln,zd);ln.prototype.Ba=function(){te(this.g,"a")};ln.prototype.Aa=function(t){te(this.g,new Wd(t))};ln.prototype.za=function(t){te(this.g,new Hd)};ln.prototype.ya=function(){te(this.g,"b")};function Cy(){this.blockSize=-1}function Ee(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}J(Ee,Cy);Ee.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Qo(t,e,n){n||(n=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[3]+3250441966&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[4]+4118548399&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[7]+4249261313&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[8]+1770035416&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[11]+2304563134&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[12]+1804603682&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[15]+1236535329&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(n^i))+r[1]+4129170786&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[0]+3921069994&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[5]+3593408605&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[4]+3889429448&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[9]+568446438&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[8]+1163531501&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[13]+2850285829&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[12]+2368359562&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(n^i^s)+r[5]+4294588738&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[14]+4259657740&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[1]+2763975236&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[10]+3200236656&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[13]+681279174&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[6]+76029189&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[9]+3654602809&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[2]+3299628645&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(i^(n|~s))+r[0]+4096336452&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[5]+4237533241&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[12]+1700485571&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[1]+2240044497&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[8]+1873313359&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[13]+1309151649&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[4]+4149444226&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}Ee.prototype.j=function(t,e){e===void 0&&(e=t.length);for(var n=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=n;)Qo(this,t,s),s+=this.blockSize;if(typeof t=="string"){for(;s<e;)if(r[i++]=t.charCodeAt(s++),i==this.blockSize){Qo(this,r),i=0;break}}else for(;s<e;)if(r[i++]=t[s++],i==this.blockSize){Qo(this,r),i=0;break}}this.h=i,this.i+=e};Ee.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=n&255,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};function O(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=t[i]|0;r&&s==e||(n[i]=s,r=!1)}this.g=n}var Dy={};function Va(t){return-128<=t&&128>t?B_(t,function(e){return new O([e|0],0>e?-1:0)}):new O([t|0],0>t?-1:0)}function ke(t){if(isNaN(t)||!isFinite(t))return an;if(0>t)return ee(ke(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=la;return new O(e,0)}function Kd(t,e){if(t.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(t.charAt(0)=="-")return ee(Kd(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=ke(Math.pow(e,8)),r=an,i=0;i<t.length;i+=8){var s=Math.min(8,t.length-i),o=parseInt(t.substring(i,i+s),e);8>s?(s=ke(Math.pow(e,s)),r=r.R(s).add(ke(o))):(r=r.R(n),r=r.add(ke(o)))}return r}var la=4294967296,an=Va(0),ha=Va(1),Gh=Va(16777216);_=O.prototype;_.ea=function(){if(ve(this))return-ee(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:la+r)*e,e*=la}return t};_.toString=function(t){if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(ze(this))return"0";if(ve(this))return"-"+ee(this).toString(t);for(var e=ke(Math.pow(t,6)),n=this,r="";;){var i=Ni(n,e).g;n=Pi(n,i.R(e));var s=((0<n.g.length?n.g[0]:n.h)>>>0).toString(t);if(n=i,ze(n))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};_.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h};function ze(t){if(t.h!=0)return!1;for(var e=0;e<t.g.length;e++)if(t.g[e]!=0)return!1;return!0}function ve(t){return t.h==-1}_.X=function(t){return t=Pi(this,t),ve(t)?-1:ze(t)?0:1};function ee(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new O(n,~t.h).add(ha)}_.abs=function(){return ve(this)?ee(this):this};_.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(t.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new O(n,n[n.length-1]&-2147483648?-1:0)};function Pi(t,e){return t.add(ee(e))}_.R=function(t){if(ze(this)||ze(t))return an;if(ve(this))return ve(t)?ee(this).R(ee(t)):ee(ee(this).R(t));if(ve(t))return ee(this.R(ee(t)));if(0>this.X(Gh)&&0>t.X(Gh))return ke(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=t.D(i)>>>16,c=t.D(i)&65535;n[2*r+2*i]+=o*c,Si(n,2*r+2*i),n[2*r+2*i+1]+=s*c,Si(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,Si(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,Si(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new O(n,0)};function Si(t,e){for(;(t[e]&65535)!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function tr(t,e){this.g=t,this.h=e}function Ni(t,e){if(ze(e))throw Error("division by zero");if(ze(t))return new tr(an,an);if(ve(t))return e=Ni(ee(t),e),new tr(ee(e.g),ee(e.h));if(ve(e))return e=Ni(t,ee(e)),new tr(ee(e.g),e.h);if(30<t.g.length){if(ve(t)||ve(e))throw Error("slowDivide_ only works with positive integers.");for(var n=ha,r=e;0>=r.X(t);)n=zh(n),r=zh(r);var i=sn(n,1),s=sn(r,1);for(r=sn(r,2),n=sn(n,2);!ze(r);){var o=s.add(r);0>=o.X(t)&&(i=i.add(n),s=o),r=sn(r,1),n=sn(n,1)}return e=Pi(t,i.R(e)),new tr(i,e)}for(i=an;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=Math.ceil(Math.log(n)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=ke(n),o=s.R(e);ve(o)||0<o.X(t);)n-=r,s=ke(n),o=s.R(e);ze(s)&&(s=ha),i=i.add(s),t=Pi(t,o)}return new tr(i,t)}_.gb=function(t){return Ni(this,t).h};_.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new O(n,this.h&t.h)};_.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new O(n,this.h|t.h)};_.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new O(n,this.h^t.h)};function zh(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new O(n,t.h)}function sn(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],s=0;s<r;s++)i[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new O(i,t.h)}Ri.prototype.createWebChannel=Ri.prototype.g;de.prototype.send=de.prototype.u;de.prototype.open=de.prototype.m;de.prototype.close=de.prototype.close;Ui.NO_ERROR=0;Ui.TIMEOUT=8;Ui.HTTP_ERROR=6;hd.COMPLETE="complete";dd.EventType=gr;gr.OPEN="a";gr.CLOSE="b";gr.ERROR="c";gr.MESSAGE="d";Q.prototype.listen=Q.prototype.O;U.prototype.listenOnce=U.prototype.P;U.prototype.getLastError=U.prototype.Sa;U.prototype.getLastErrorCode=U.prototype.Ia;U.prototype.getStatus=U.prototype.da;U.prototype.getResponseJson=U.prototype.Wa;U.prototype.getResponseText=U.prototype.ja;U.prototype.send=U.prototype.ha;U.prototype.setWithCredentials=U.prototype.Oa;Ee.prototype.digest=Ee.prototype.l;Ee.prototype.reset=Ee.prototype.reset;Ee.prototype.update=Ee.prototype.j;O.prototype.add=O.prototype.add;O.prototype.multiply=O.prototype.R;O.prototype.modulo=O.prototype.gb;O.prototype.compare=O.prototype.X;O.prototype.toNumber=O.prototype.ea;O.prototype.toString=O.prototype.toString;O.prototype.getBits=O.prototype.D;O.fromNumber=ke;O.fromString=Kd;var Qd=we.createWebChannelTransport=function(){return new Ri},Jd=we.getStatEventTarget=function(){return Li()},Hi=we.ErrorCode=Ui,Yd=we.EventType=hd,Xd=we.Event=Rt,Oa=we.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Zd=we.FetchXmlHttpFactory=vr,wr=we.WebChannel=dd,ef=we.XhrIo=U,tf=we.Md5=Ee,Pt=we.Integer=O;var nf="@firebase/firestore";var Y=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Y.UNAUTHENTICATED=new Y(null),Y.GOOGLE_CREDENTIALS=new Y("google-credentials-uid"),Y.FIRST_PARTY=new Y("first-party-uid"),Y.MOCK_USER=new Y("mock-user");var Rn="10.11.1";var xt=new ot("@firebase/firestore");function Tr(){return xt.logLevel}function v(t,...e){if(xt.logLevel<=R.DEBUG){let n=e.map(Iu);xt.debug(`Firestore (${Rn}): ${t}`,...n)}}function Ke(t,...e){if(xt.logLevel<=R.ERROR){let n=e.map(Iu);xt.error(`Firestore (${Rn}): ${t}`,...n)}}function _n(t,...e){if(xt.logLevel<=R.WARN){let n=e.map(Iu);xt.warn(`Firestore (${Rn}): ${t}`,...n)}}function Iu(t){if(typeof t=="string")return t;try{return function(n){return JSON.stringify(n)}(t)}catch{return t}}function A(t="Unexpected state"){let e=`FIRESTORE (${Rn}) INTERNAL ASSERTION FAILED: `+t;throw Ke(e),new Error(e)}function x(t,e){t||A()}function C(t,e){return t}var p={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},y=class extends he{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var He=class{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}};var Xi=class{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Ua=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Y.UNAUTHENTICATED))}shutdown(){}},Ba=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}},qa=class{constructor(e){this.t=e,this.currentUser=Y.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let r=this.i,i=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve(),s=new He;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new He,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>h(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},a=c=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new He)}},0),o()}getToken(){let e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(x(typeof r.accessToken=="string"),new Xi(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return x(e===null||typeof e=="string"),new Y(e)}},$a=class{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=Y.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},ja=class{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new $a(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(Y.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ga=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},za=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){let r=s=>{s.error!=null&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,v("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(x(typeof n.token=="string"),this.R=n.token,new Ga(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function Ry(t){let e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Zi=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=Ry(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%e.length))}return r}};function V(t,e){return t<e?-1:t>e?1:0}function yn(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}var ne=class t{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new y(p.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new y(p.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new y(p.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(p.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return t.fromMillis(Date.now())}static fromDate(e){return t.fromMillis(e.getTime())}static fromMillis(e){let n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new t(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?V(this.nanoseconds,e.nanoseconds):V(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var D=class t{constructor(e){this.timestamp=e}static fromTimestamp(e){return new t(e)}static min(){return new t(new ne(0,0))}static max(){return new t(new ne(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var es=class t{constructor(e,n,r){n===void 0?n=0:n>e.length&&A(),r===void 0?r=e.length-n:r>e.length-n&&A(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return t.comparator(this,e)===0}child(e){let n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){let r=Math.min(e.length,n.length);for(let i=0;i<r;i++){let s=e.get(i),o=n.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}},L=class t extends es{construct(e,n,r){return new t(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let n=[];for(let r of e){if(r.indexOf("//")>=0)throw new y(p.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new t(n)}static emptyPath(){return new t([])}},Py=/^[_a-zA-Z][_a-zA-Z0-9]*$/,fe=class t extends es{construct(e,n,r){return new t(e,n,r)}static isValidIdentifier(e){return Py.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new t(["__name__"])}static fromServerFormat(e){let n=[],r="",i=0,s=()=>{if(r.length===0)throw new y(p.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new y(p.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new y(p.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new y(p.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new t(n)}static emptyPath(){return new t([])}};var E=class t{constructor(e){this.path=e}static fromPath(e){return new t(L.fromString(e))}static fromName(e){return new t(L.fromString(e).popFirst(5))}static empty(){return new t(L.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&L.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return L.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new t(new L(e.slice()))}};var Wa=class{constructor(e,n,r,i){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=i}};Wa.UNKNOWN_ID=-1;function Ny(t,e){let n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=D.fromTimestamp(r===1e9?new ne(n+1,0):new ne(n,r));return new Mt(i,E.empty(),e)}function ky(t){return new Mt(t.readTime,t.key,-1)}var Mt=class t{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new t(D.min(),E.empty(),-1)}static max(){return new t(D.max(),E.empty(),-1)}};function Vy(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=E.comparator(t.documentKey,e.documentKey),n!==0?n:V(t.largestBatchId,e.largestBatchId))}var Oy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ha=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function qr(t){return h(this,null,function*(){if(t.code!==p.FAILED_PRECONDITION||t.message!==Oy)throw t;v("LocalStore","Unexpectedly lost primary lease")})}var g=class t{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&A(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{let n=e();return n instanceof t?n:t.resolve(n)}catch(n){return t.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):t.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):t.reject(n)}static resolve(e){return new t((n,r)=>{n(e)})}static reject(e){return new t((n,r)=>{r(e)})}static waitFor(e){return new t((n,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},c=>r(c))}),o=!0,s===i&&n()})}static or(e){let n=t.resolve(!1);for(let r of e)n=n.next(i=>i?t.resolve(i):r());return n}static forEach(e,n){let r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new t((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;n(e[u]).next(l=>{o[u]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,n){return new t((r,i)=>{let s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}};function xy(t){let e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function $r(t){return t.name==="IndexedDbTransactionError"}var Mf=(()=>{class t{constructor(n,r){this.previousValue=n,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){let n=++this.previousValue;return this.se&&this.se(n),n}}return t.oe=-1,t})();function Rs(t){return t==null}function Pr(t){return t===0&&1/t==-1/0}function My(t){return typeof t=="number"&&Number.isInteger(t)&&!Pr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Fy=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],DA=[...Fy,"documentOverlays"],Ly=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Uy=Ly,RA=[...Uy,"indexConfiguration","indexState","indexEntries"];function rf(t){let e=0;for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Pn(t,e){for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ff(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var q=class t{constructor(e,n){this.comparator=e,this.root=n||xe.EMPTY}insert(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,xe.BLACK,null,null))}remove(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xe.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){let e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new pn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new pn(this.root,e,this.comparator,!1)}getReverseIterator(){return new pn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new pn(this.root,e,this.comparator,!0)}},pn=class{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},xe=class t{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??t.RED,this.left=i??t.EMPTY,this.right=s??t.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new t(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return t.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw A();let e=this.left.check();if(e!==this.right.check())throw A();return e+(this.isRed()?0:1)}};xe.EMPTY=null,xe.RED=!0,xe.BLACK=!1;xe.EMPTY=new class{constructor(){this.size=0}get key(){throw A()}get value(){throw A()}get color(){throw A()}get left(){throw A()}get right(){throw A()}copy(e,n,r,i,s){return this}insert(e,n,r){return new xe(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ae=class t{constructor(e){this.comparator=e,this.data=new q(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new ts(this.data.getIterator())}getIteratorFrom(e){return new ts(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof t)||this.size!==e.size)return!1;let n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){let i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(n=>{e.push(n)}),e}toString(){let e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){let n=new t(this.comparator);return n.data=e,n}},ts=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Oe=class t{constructor(e){this.fields=e,e.sort(fe.comparator)}static empty(){return new t([])}unionWith(e){let n=new ae(fe.comparator);for(let r of this.fields)n=n.add(r);for(let r of e)n=n.add(r);return new t(n.toArray())}covers(e){for(let n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return yn(this.fields,e.fields,(n,r)=>n.isEqual(r))}};var ns=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var ue=class t{constructor(e){this.binaryString=e}static fromBase64String(e){let n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ns("Invalid base64 string: "+s):s}}(e);return new t(n)}static fromUint8Array(e){let n=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new t(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){let r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return V(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ue.EMPTY_BYTE_STRING=new ue("");var By=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qe(t){if(x(!!t),typeof t=="string"){let e=0,n=By.exec(t);if(x(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:B(t.seconds),nanos:B(t.nanos)}}function B(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ft(t){return typeof t=="string"?ue.fromBase64String(t):ue.fromUint8Array(t)}function Eu(t){var e,n;return((n=(((e=t?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function wu(t){let e=t.mapValue.fields.__previous_value__;return Eu(e)?wu(e):e}function Nr(t){let e=Qe(t.mapValue.fields.__local_write_time__.timestampValue);return new ne(e.seconds,e.nanos)}var Ka=class{constructor(e,n,r,i,s,o,a,c,u){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},rs=class t{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new t("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database}};var Ki={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Ft(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Eu(t)?4:Lf(t)?9007199254740991:10:A()}function Le(t,e){if(t===e)return!0;let n=Ft(t);if(n!==Ft(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Nr(t).isEqual(Nr(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Qe(i.timestampValue),a=Qe(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return ft(i.bytesValue).isEqual(ft(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return B(i.geoPointValue.latitude)===B(s.geoPointValue.latitude)&&B(i.geoPointValue.longitude)===B(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return B(i.integerValue)===B(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=B(i.doubleValue),a=B(s.doubleValue);return o===a?Pr(o)===Pr(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return yn(t.arrayValue.values||[],e.arrayValue.values||[],Le);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(rf(o)!==rf(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Le(o[c],a[c])))return!1;return!0}(t,e);default:return A()}}function kr(t,e){return(t.values||[]).find(n=>Le(n,e))!==void 0}function vn(t,e){if(t===e)return 0;let n=Ft(t),r=Ft(e);if(n!==r)return V(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return V(t.booleanValue,e.booleanValue);case 2:return function(s,o){let a=B(s.integerValue||s.doubleValue),c=B(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(t,e);case 3:return sf(t.timestampValue,e.timestampValue);case 4:return sf(Nr(t),Nr(e));case 5:return V(t.stringValue,e.stringValue);case 6:return function(s,o){let a=ft(s),c=ft(o);return a.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let l=V(a[u],c[u]);if(l!==0)return l}return V(a.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,o){let a=V(B(s.latitude),B(o.latitude));return a!==0?a:V(B(s.longitude),B(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],c=o.values||[];for(let u=0;u<a.length&&u<c.length;++u){let l=vn(a[u],c[u]);if(l)return l}return V(a.length,c.length)}(t.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Ki.mapValue&&o===Ki.mapValue)return 0;if(s===Ki.mapValue)return 1;if(o===Ki.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},l=Object.keys(u);c.sort(),l.sort();for(let d=0;d<c.length&&d<l.length;++d){let f=V(c[d],l[d]);if(f!==0)return f;let m=vn(a[c[d]],u[l[d]]);if(m!==0)return m}return V(c.length,l.length)}(t.mapValue,e.mapValue);default:throw A()}}function sf(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return V(t,e);let n=Qe(t),r=Qe(e),i=V(n.seconds,r.seconds);return i!==0?i:V(n.nanos,r.nanos)}function In(t){return Qa(t)}function Qa(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){let r=Qe(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return ft(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return E.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(let s of n.values||[])i?i=!1:r+=",",r+=Qa(s);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){let r=Object.keys(n.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Qa(n.fields[o])}`;return i+"}"}(t.mapValue):A()}function of(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ja(t){return!!t&&"integerValue"in t}function Tu(t){return!!t&&"arrayValue"in t}function af(t){return!!t&&"nullValue"in t}function cf(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ji(t){return!!t&&"mapValue"in t}function Sr(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){let e={mapValue:{fields:{}}};return Pn(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Sr(r)),e}if(t.arrayValue){let e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Sr(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Lf(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Te=class t{constructor(e){this.value=e}static empty(){return new t({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Ji(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Sr(n)}setAll(e){let n=fe.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){let c=this.getFieldsMap(n);this.applyChanges(c,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=Sr(o):i.push(a.lastSegment())});let s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){let n=this.field(e.popLast());Ji(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Le(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];Ji(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Pn(n,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new t(Sr(this.value))}};function Uf(t){let e=[];return Pn(t.fields,(n,r)=>{let i=new fe([n]);if(Ji(r)){let s=Uf(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Oe(e)}var Ae=class t{constructor(e,n,r,i,s,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new t(e,0,D.min(),D.min(),D.min(),Te.empty(),0)}static newFoundDocument(e,n,r,i){return new t(e,1,n,D.min(),r,i,0)}static newNoDocument(e,n){return new t(e,2,n,D.min(),D.min(),Te.empty(),0)}static newUnknownDocument(e,n){return new t(e,3,n,D.min(),D.min(),Te.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(D.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Te.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Te.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=D.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var En=class{constructor(e,n){this.position=e,this.inclusive=n}};function uf(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){let s=e[i],o=t.position[i];if(s.field.isKeyField()?r=E.comparator(E.fromName(o.referenceValue),n.key):r=vn(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function lf(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Le(t.position[n],e.position[n]))return!1;return!0}var Lt=class{constructor(e,n="asc"){this.field=e,this.dir=n}};function qy(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var is=class{},z=class t extends is{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new Xa(e,n,r):n==="array-contains"?new tc(e,r):n==="in"?new nc(e,r):n==="not-in"?new rc(e,r):n==="array-contains-any"?new ic(e,r):new t(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new Za(e,r):new ec(e,r)}matches(e){let n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(vn(n,this.value)):n!==null&&Ft(this.value)===Ft(n)&&this.matchesComparison(vn(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return A()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Se=class t extends is{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new t(e,n)}matches(e){return Bf(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Bf(t){return t.op==="and"}function qf(t){return $y(t)&&Bf(t)}function $y(t){for(let e of t.filters)if(e instanceof Se)return!1;return!0}function Ya(t){if(t instanceof z)return t.field.canonicalString()+t.op.toString()+In(t.value);if(qf(t))return t.filters.map(e=>Ya(e)).join(",");{let e=t.filters.map(n=>Ya(n)).join(",");return`${t.op}(${e})`}}function $f(t,e){return t instanceof z?function(r,i){return i instanceof z&&r.op===i.op&&r.field.isEqual(i.field)&&Le(r.value,i.value)}(t,e):t instanceof Se?function(r,i){return i instanceof Se&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&$f(o,i.filters[a]),!0):!1}(t,e):void A()}function jf(t){return t instanceof z?function(n){return`${n.field.canonicalString()} ${n.op} ${In(n.value)}`}(t):t instanceof Se?function(n){return n.op.toString()+" {"+n.getFilters().map(jf).join(" ,")+"}"}(t):"Filter"}var Xa=class extends z{constructor(e,n,r){super(e,n,r),this.key=E.fromName(r.referenceValue)}matches(e){let n=E.comparator(e.key,this.key);return this.matchesComparison(n)}},Za=class extends z{constructor(e,n){super(e,"in",n),this.keys=Gf("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}},ec=class extends z{constructor(e,n){super(e,"not-in",n),this.keys=Gf("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}};function Gf(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>E.fromName(r.referenceValue))}var tc=class extends z{constructor(e,n){super(e,"array-contains",n)}matches(e){let n=e.data.field(this.field);return Tu(n)&&kr(n.arrayValue,this.value)}},nc=class extends z{constructor(e,n){super(e,"in",n)}matches(e){let n=e.data.field(this.field);return n!==null&&kr(this.value.arrayValue,n)}},rc=class extends z{constructor(e,n){super(e,"not-in",n)}matches(e){if(kr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let n=e.data.field(this.field);return n!==null&&!kr(this.value.arrayValue,n)}},ic=class extends z{constructor(e,n){super(e,"array-contains-any",n)}matches(e){let n=e.data.field(this.field);return!(!Tu(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>kr(this.value.arrayValue,r))}};var sc=class{constructor(e,n=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function hf(t,e=null,n=[],r=[],i=null,s=null,o=null){return new sc(t,e,n,r,i,s,o)}function Au(t){let e=C(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Ya(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Rs(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>In(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>In(r)).join(",")),e.ue=n}return e.ue}function Su(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!qy(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!$f(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!lf(t.startAt,e.startAt)&&lf(t.endAt,e.endAt)}function oc(t){return E.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}var pt=class{constructor(e,n=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function jy(t,e,n,r,i,s,o,a){return new pt(t,e,n,r,i,s,o,a)}function bu(t){return new pt(t)}function df(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function zf(t){return t.collectionGroup!==null}function br(t){let e=C(t);if(e.ce===null){e.ce=[];let n=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),n.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ae(fe.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Lt(s,r))}),n.has(fe.keyField().canonicalString())||e.ce.push(new Lt(fe.keyField(),r))}return e.ce}function Me(t){let e=C(t);return e.le||(e.le=Gy(e,br(t))),e.le}function Gy(t,e){if(t.limitType==="F")return hf(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Lt(i.field,s)});let n=t.endAt?new En(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new En(t.startAt.position,t.startAt.inclusive):null;return hf(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function ac(t,e){let n=t.filters.concat([e]);return new pt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function cc(t,e,n){return new pt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ps(t,e){return Su(Me(t),Me(e))&&t.limitType===e.limitType}function Wf(t){return`${Au(Me(t))}|lt:${t.limitType}`}function hn(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>jf(i)).join(", ")}]`),Rs(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>In(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>In(i)).join(",")),`Target(${r})`}(Me(t))}; limitType=${t.limitType})`}function Ns(t,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):E.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(t,e)&&function(r,i){for(let s of br(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(o,a,c){let u=uf(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,br(r),i)||r.endAt&&!function(o,a,c){let u=uf(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,br(r),i))}(t,e)}function zy(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Hf(t){return(e,n)=>{let r=!1;for(let i of br(t)){let s=Wy(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Wy(t,e,n){let r=t.field.isKeyField()?E.comparator(e.key,n.key):function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?vn(c,u):A()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return A()}}var mt=class{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){let n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){let n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Pn(this.inner,(n,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return Ff(this.inner)}size(){return this.innerSize}};var Hy=new q(E.comparator);function Je(){return Hy}var Kf=new q(E.comparator);function Ar(...t){let e=Kf;for(let n of t)e=e.insert(n.key,n);return e}function Qf(t){let e=Kf;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Nt(){return Cr()}function Jf(){return Cr()}function Cr(){return new mt(t=>t.toString(),(t,e)=>t.isEqual(e))}var Ky=new q(E.comparator),Qy=new ae(E.comparator);function P(...t){let e=Qy;for(let n of t)e=e.add(n);return e}var Jy=new ae(V);function Yy(){return Jy}function Yf(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pr(e)?"-0":e}}function Xf(t){return{integerValue:""+t}}function Xy(t,e){return My(e)?Xf(e):Yf(t,e)}var wn=class{constructor(){this._=void 0}};function Zy(t,e,n){return t instanceof Tn?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Eu(s)&&(s=wu(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(n,e):t instanceof Ut?ep(t,e):t instanceof Bt?tp(t,e):function(i,s){let o=Zf(i,s),a=ff(o)+ff(i.Pe);return Ja(o)&&Ja(i.Pe)?Xf(a):Yf(i.serializer,a)}(t,e)}function ev(t,e,n){return t instanceof Ut?ep(t,e):t instanceof Bt?tp(t,e):n}function Zf(t,e){return t instanceof An?function(r){return Ja(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Tn=class extends wn{},Ut=class extends wn{constructor(e){super(),this.elements=e}};function ep(t,e){let n=np(e);for(let r of t.elements)n.some(i=>Le(i,r))||n.push(r);return{arrayValue:{values:n}}}var Bt=class extends wn{constructor(e){super(),this.elements=e}};function tp(t,e){let n=np(e);for(let r of t.elements)n=n.filter(i=>!Le(i,r));return{arrayValue:{values:n}}}var An=class extends wn{constructor(e,n){super(),this.serializer=e,this.Pe=n}};function ff(t){return B(t.integerValue||t.doubleValue)}function np(t){return Tu(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function tv(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof Ut&&i instanceof Ut||r instanceof Bt&&i instanceof Bt?yn(r.elements,i.elements,Le):r instanceof An&&i instanceof An?Le(r.Pe,i.Pe):r instanceof Tn&&i instanceof Tn}(t.transform,e.transform)}var uc=class{constructor(e,n){this.version=e,this.transformResults=n}},Ot=class t{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new t}static exists(e){return new t(void 0,e)}static updateTime(e){return new t(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Yi(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}var Sn=class{};function rp(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new ss(t.key,Ot.none()):new qt(t.key,t.data,Ot.none());{let n=t.data,r=Te.empty(),i=new ae(fe.comparator);for(let s of e.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Ye(t.key,r,new Oe(i.toArray()),Ot.none())}}function nv(t,e,n){t instanceof qt?function(i,s,o){let a=i.value.clone(),c=mf(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof Ye?function(i,s,o){if(!Yi(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=mf(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(ip(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(t,e,n):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function Dr(t,e,n,r){return t instanceof qt?function(s,o,a,c){if(!Yi(s.precondition,o))return a;let u=s.value.clone(),l=gf(s.fieldTransforms,c,o);return u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(t,e,n,r):t instanceof Ye?function(s,o,a,c){if(!Yi(s.precondition,o))return a;let u=gf(s.fieldTransforms,c,o),l=o.data;return l.setAll(ip(s)),l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(d=>d.field))}(t,e,n,r):function(s,o,a){return Yi(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function rv(t,e){let n=null;for(let r of t.fieldTransforms){let i=e.data.field(r.field),s=Zf(r.transform,i||null);s!=null&&(n===null&&(n=Te.empty()),n.set(r.field,s))}return n||null}function pf(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&yn(r,i,(s,o)=>tv(s,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}var qt=class extends Sn{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Ye=class extends Sn{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function ip(t){let e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=t.data.field(n);e.set(n,r)}}),e}function mf(t,e,n){let r=new Map;x(t.length===n.length);for(let i=0;i<n.length;i++){let s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,ev(o,a,n[i]))}return r}function gf(t,e,n){let r=new Map;for(let i of t){let s=i.transform,o=n.data.field(i.field);r.set(i.field,Zy(s,o,e))}return r}var ss=class extends Sn{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},lc=class extends Sn{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var hc=class{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){let r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&nv(s,e,r[i])}}applyToLocalView(e,n){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(n=Dr(r,e,n,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(n=Dr(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){let r=Jf();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;let c=rp(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(D.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),P())}isEqual(e){return this.batchId===e.batchId&&yn(this.mutations,e.mutations,(n,r)=>pf(n,r))&&yn(this.baseMutations,e.baseMutations,(n,r)=>pf(n,r))}},dc=class t{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){x(e.mutations.length===r.length);let i=function(){return Ky}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new t(e,n,r,i)}};var fc=class{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var pc=class{constructor(e,n){this.count=e,this.unchangedNames=n}};var j,N;function iv(t){switch(t){default:return A();case p.CANCELLED:case p.UNKNOWN:case p.DEADLINE_EXCEEDED:case p.RESOURCE_EXHAUSTED:case p.INTERNAL:case p.UNAVAILABLE:case p.UNAUTHENTICATED:return!1;case p.INVALID_ARGUMENT:case p.NOT_FOUND:case p.ALREADY_EXISTS:case p.PERMISSION_DENIED:case p.FAILED_PRECONDITION:case p.ABORTED:case p.OUT_OF_RANGE:case p.UNIMPLEMENTED:case p.DATA_LOSS:return!0}}function sp(t){if(t===void 0)return Ke("GRPC error has no .code"),p.UNKNOWN;switch(t){case j.OK:return p.OK;case j.CANCELLED:return p.CANCELLED;case j.UNKNOWN:return p.UNKNOWN;case j.DEADLINE_EXCEEDED:return p.DEADLINE_EXCEEDED;case j.RESOURCE_EXHAUSTED:return p.RESOURCE_EXHAUSTED;case j.INTERNAL:return p.INTERNAL;case j.UNAVAILABLE:return p.UNAVAILABLE;case j.UNAUTHENTICATED:return p.UNAUTHENTICATED;case j.INVALID_ARGUMENT:return p.INVALID_ARGUMENT;case j.NOT_FOUND:return p.NOT_FOUND;case j.ALREADY_EXISTS:return p.ALREADY_EXISTS;case j.PERMISSION_DENIED:return p.PERMISSION_DENIED;case j.FAILED_PRECONDITION:return p.FAILED_PRECONDITION;case j.ABORTED:return p.ABORTED;case j.OUT_OF_RANGE:return p.OUT_OF_RANGE;case j.UNIMPLEMENTED:return p.UNIMPLEMENTED;case j.DATA_LOSS:return p.DATA_LOSS;default:return A()}}(N=j||(j={}))[N.OK=0]="OK",N[N.CANCELLED=1]="CANCELLED",N[N.UNKNOWN=2]="UNKNOWN",N[N.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",N[N.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",N[N.NOT_FOUND=5]="NOT_FOUND",N[N.ALREADY_EXISTS=6]="ALREADY_EXISTS",N[N.PERMISSION_DENIED=7]="PERMISSION_DENIED",N[N.UNAUTHENTICATED=16]="UNAUTHENTICATED",N[N.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",N[N.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",N[N.ABORTED=10]="ABORTED",N[N.OUT_OF_RANGE=11]="OUT_OF_RANGE",N[N.UNIMPLEMENTED=12]="UNIMPLEMENTED",N[N.INTERNAL=13]="INTERNAL",N[N.UNAVAILABLE=14]="UNAVAILABLE",N[N.DATA_LOSS=15]="DATA_LOSS";var _f=null;function sv(){return new TextEncoder}var ov=new Pt([4294967295,4294967295],0);function yf(t){let e=sv().encode(t),n=new tf;return n.update(e),new Uint8Array(n.digest())}function vf(t){let e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Pt([n,r],0),new Pt([i,s],0)]}var mc=class t{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new kt(`Invalid padding: ${n}`);if(r<0)throw new kt(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new kt(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new kt(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=Pt.fromNumber(this.Ie)}Ee(e,n,r){let i=e.add(n.multiply(Pt.fromNumber(r)));return i.compare(ov)===1&&(i=new Pt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let n=yf(e),[r,i]=vf(n);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,n,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new t(s,i,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let n=yf(e),[r,i]=vf(n);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}},kt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var os=class t{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){let i=new Map;return i.set(e,Vr.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new t(D.min(),i,new q(V),Je(),P())}},Vr=class t{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new t(r,n,P(),P(),P())}};var mn=class{constructor(e,n,r,i){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=i}},as=class{constructor(e,n){this.targetId=e,this.me=n}},cs=class{constructor(e,n,r=ue.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}},us=class{constructor(){this.fe=0,this.ge=Ef(),this.pe=ue.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=P(),n=P(),r=P();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:A()}}),new Vr(this.pe,this.ye,e,n,r)}ve(){this.we=!1,this.ge=Ef()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,x(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},gc=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Je(),this.qe=If(),this.Qe=new q(V)}Ke(e){for(let n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(let n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{let r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:A()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,i)=>{this.ze(i)&&n(i)})}He(e){let n=e.targetId,r=e.me.count,i=this.Je(n);if(i){let s=i.target;if(oc(s))if(r===0){let o=new E(s.path);this.Ue(n,o,Ae.newNoDocument(o,D.min()))}else x(r===1);else{let o=this.Ye(n);if(o!==r){let a=this.Ze(e),c=a?this.Xe(a,e,o):1;if(c!==0){this.je(n);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,u)}_f?.et(function(l,d,f,m,T){var S,I,k,F,$,re;let Ce={localCacheCount:l,existenceFilterCount:d.count,databaseId:f.database,projectId:f.projectId},K=d.unchangedNames;return K&&(Ce.bloomFilter={applied:T===0,hashCount:(S=K?.hashCount)!==null&&S!==void 0?S:0,bitmapLength:(F=(k=(I=K?.bits)===null||I===void 0?void 0:I.bitmap)===null||k===void 0?void 0:k.length)!==null&&F!==void 0?F:0,padding:(re=($=K?.bits)===null||$===void 0?void 0:$.padding)!==null&&re!==void 0?re:0,mightContain:Be=>{var Jt;return(Jt=m?.mightContain(Be))!==null&&Jt!==void 0&&Jt}}),Ce}(o,e.me,this.Le.tt(),a,c))}}}}Ze(e){let n=e.me.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n,o,a;try{o=ft(r).toUint8Array()}catch(c){if(c instanceof ns)return _n("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new mc(o,i,s)}catch(c){return _n(c instanceof kt?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Ie===0?null:a}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){let r=this.Le.getRemoteKeysForTarget(n),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(n,s,null),i++)}),i}rt(e){let n=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&oc(a.target)){let c=new E(a.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,Ae.newNoDocument(c,e))}s.be&&(n.set(o,s.Ce()),s.ve())}});let r=P();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Je(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new os(e,n,this.Qe,this.ke,r);return this.ke=Je(),this.qe=If(),this.Qe=new q(V),i}$e(e,n){if(!this.ze(e))return;let r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,n)?i.Fe(n,1):i.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let n=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new us,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new ae(V),this.qe=this.qe.insert(e,n)),n}ze(e){let n=this.Je(e)!==null;return n||v("WatchChangeAggregator","Detected inactive target",e),n}Je(e){let n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new us),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}};function If(){return new q(E.comparator)}function Ef(){return new q(E.comparator)}var av={asc:"ASCENDING",desc:"DESCENDING"},cv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},uv={and:"AND",or:"OR"},_c=class{constructor(e,n){this.databaseId=e,this.useProto3Json=n}};function yc(t,e){return t.useProto3Json||Rs(e)?e:{value:e}}function ls(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function op(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function lv(t,e){return ls(t,e.toTimestamp())}function Fe(t){return x(!!t),D.fromTimestamp(function(n){let r=Qe(n);return new ne(r.seconds,r.nanos)}(t))}function Cu(t,e){return vc(t,e).canonicalString()}function vc(t,e){let n=function(i){return new L(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function ap(t){let e=L.fromString(t);return x(dp(e)),e}function Ic(t,e){return Cu(t.databaseId,e.path)}function xa(t,e){let n=ap(e);if(n.get(1)!==t.databaseId.projectId)throw new y(p.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new y(p.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new E(up(n))}function cp(t,e){return Cu(t.databaseId,e)}function hv(t){let e=ap(t);return e.length===4?L.emptyPath():up(e)}function Ec(t){return new L(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function up(t){return x(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function wf(t,e,n){return{name:Ic(t,e),fields:n.value.mapValue.fields}}function dv(t,e){let n;if("targetChange"in e){e.targetChange;let r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:A()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,l){return u.useProto3Json?(x(l===void 0||typeof l=="string"),ue.fromBase64String(l||"")):(x(l===void 0||l instanceof Buffer||l instanceof Uint8Array),ue.fromUint8Array(l||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let l=u.code===void 0?p.UNKNOWN:sp(u.code);return new y(l,u.message||"")}(o);n=new cs(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=xa(t,r.document.name),s=Fe(r.document.updateTime),o=r.document.createTime?Fe(r.document.createTime):D.min(),a=new Te({mapValue:{fields:r.document.fields}}),c=Ae.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new mn(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=xa(t,r.document),s=r.readTime?Fe(r.readTime):D.min(),o=Ae.newNoDocument(i,s),a=r.removedTargetIds||[];n=new mn([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=xa(t,r.document),s=r.removedTargetIds||[];n=new mn([],s,i,null)}else{if(!("filter"in e))return A();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new pc(i,s),a=r.targetId;n=new as(a,o)}}return n}function fv(t,e){let n;if(e instanceof qt)n={update:wf(t,e.key,e.value)};else if(e instanceof ss)n={delete:Ic(t,e.key)};else if(e instanceof Ye)n={update:wf(t,e.key,e.data),updateMask:wv(e.fieldMask)};else{if(!(e instanceof lc))return A();n={verify:Ic(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Tn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Ut)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Bt)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof An)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw A()}(0,r))),e.precondition.isNone||(n.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:lv(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:A()}(t,e.precondition)),n}function pv(t,e){return t&&t.length>0?(x(e!==void 0),t.map(n=>function(i,s){let o=i.updateTime?Fe(i.updateTime):Fe(s);return o.isEqual(D.min())&&(o=Fe(s)),new uc(o,i.transformResults||[])}(n,e))):[]}function mv(t,e){return{documents:[cp(t,e.path)]}}function gv(t,e){let n={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=cp(t,i);let s=function(u){if(u.length!==0)return hp(Se.create(u,"and"))}(e.filters);s&&(n.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(l=>function(f){return{field:dn(f.field),direction:vv(f.dir)}}(l))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);let a=yc(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:n,parent:i}}function _v(t){let e=hv(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){x(r===1);let l=n.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];n.where&&(s=function(d){let f=lp(d);return f instanceof Se&&qf(f)?f.getFilters():[f]}(n.where));let o=[];n.orderBy&&(o=function(d){return d.map(f=>function(T){return new Lt(fn(T.field),function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction))}(f))}(n.orderBy));let a=null;n.limit&&(a=function(d){let f;return f=typeof d=="object"?d.value:d,Rs(f)?null:f}(n.limit));let c=null;n.startAt&&(c=function(d){let f=!!d.before,m=d.values||[];return new En(m,f)}(n.startAt));let u=null;return n.endAt&&(u=function(d){let f=!d.before,m=d.values||[];return new En(m,f)}(n.endAt)),jy(e,i,o,s,a,"F",c,u)}function yv(t,e){let n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return A()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function lp(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":let r=fn(n.unaryFilter.field);return z.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=fn(n.unaryFilter.field);return z.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=fn(n.unaryFilter.field);return z.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=fn(n.unaryFilter.field);return z.create(o,"!=",{nullValue:"NULL_VALUE"});default:return A()}}(t):t.fieldFilter!==void 0?function(n){return z.create(fn(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return A()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Se.create(n.compositeFilter.filters.map(r=>lp(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return A()}}(n.compositeFilter.op))}(t):A()}function vv(t){return av[t]}function Iv(t){return cv[t]}function Ev(t){return uv[t]}function dn(t){return{fieldPath:t.canonicalString()}}function fn(t){return fe.fromServerFormat(t.fieldPath)}function hp(t){return t instanceof z?function(n){if(n.op==="=="){if(cf(n.value))return{unaryFilter:{field:dn(n.field),op:"IS_NAN"}};if(af(n.value))return{unaryFilter:{field:dn(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(cf(n.value))return{unaryFilter:{field:dn(n.field),op:"IS_NOT_NAN"}};if(af(n.value))return{unaryFilter:{field:dn(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dn(n.field),op:Iv(n.op),value:n.value}}}(t):t instanceof Se?function(n){let r=n.getFilters().map(i=>hp(i));return r.length===1?r[0]:{compositeFilter:{op:Ev(n.op),filters:r}}}(t):A()}function wv(t){let e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function dp(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}var Or=class t{constructor(e,n,r,i,s=D.min(),o=D.min(),a=ue.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var wc=class{constructor(e){this.ut=e}};function Tv(t){let e=_v({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?cc(e,e.limit,"L"):e}var hs=class{constructor(){}ht(e,n){this.Pt(e,n),n.It()}Pt(e,n){if("nullValue"in e)this.Tt(n,5);else if("booleanValue"in e)this.Tt(n,10),n.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(n,15),n.Et(B(e.integerValue));else if("doubleValue"in e){let r=B(e.doubleValue);isNaN(r)?this.Tt(n,13):(this.Tt(n,15),Pr(r)?n.Et(0):n.Et(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Tt(n,20),typeof r=="string"&&(r=Qe(r)),n.dt(`${r.seconds||""}`),n.Et(r.nanos||0)}else if("stringValue"in e)this.At(e.stringValue,n),this.Rt(n);else if("bytesValue"in e)this.Tt(n,30),n.Vt(ft(e.bytesValue)),this.Rt(n);else if("referenceValue"in e)this.ft(e.referenceValue,n);else if("geoPointValue"in e){let r=e.geoPointValue;this.Tt(n,45),n.Et(r.latitude||0),n.Et(r.longitude||0)}else"mapValue"in e?Lf(e)?this.Tt(n,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,n),this.Rt(n)):"arrayValue"in e?(this.yt(e.arrayValue,n),this.Rt(n)):A()}At(e,n){this.Tt(n,25),this.wt(e,n)}wt(e,n){n.dt(e)}gt(e,n){let r=e.fields||{};this.Tt(n,55);for(let i of Object.keys(r))this.At(i,n),this.Pt(r[i],n)}yt(e,n){let r=e.values||[];this.Tt(n,50);for(let i of r)this.Pt(i,n)}ft(e,n){this.Tt(n,37),E.fromName(e).path.forEach(r=>{this.Tt(n,60),this.wt(r,n)})}Tt(e,n){e.Et(n)}Rt(e){e.Et(2)}};hs.St=new hs;var Tc=class{constructor(){this.on=new Ac}addToCollectionParentIndex(e,n){return this.on.add(n),g.resolve()}getCollectionParents(e,n){return g.resolve(this.on.getEntries(n))}addFieldIndex(e,n){return g.resolve()}deleteFieldIndex(e,n){return g.resolve()}deleteAllFieldIndexes(e){return g.resolve()}createTargetIndexes(e,n){return g.resolve()}getDocumentsMatchingTarget(e,n){return g.resolve(null)}getIndexType(e,n){return g.resolve(0)}getFieldIndexes(e,n){return g.resolve([])}getNextCollectionGroupToUpdate(e){return g.resolve(null)}getMinOffset(e,n){return g.resolve(Mt.min())}getMinOffsetFromCollectionGroup(e,n){return g.resolve(Mt.min())}updateCollectionGroup(e,n,r){return g.resolve()}updateIndexEntries(e,n){return g.resolve()}},Ac=class{constructor(){this.index={}}add(e){let n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new ae(L.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){let n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ae(L.comparator)).toArray()}};var NA=new Uint8Array(0);var Ve=class t{constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Ve.DEFAULT_COLLECTION_PERCENTILE=10,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ve.DEFAULT=new Ve(41943040,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ve.DISABLED=new Ve(-1,0,0);var xr=class t{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new t(0)}static Nn(){return new t(-1)}};var Sc=class{constructor(){this.changes=new mt(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Ae.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();let r=this.changes.get(n);return r!==void 0?g.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var bc=class{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}};var Cc=class{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&Dr(r.mutation,i,Oe.empty(),ne.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,P()).next(()=>r))}getLocalViewOfDocuments(e,n,r=P()){let i=Nt();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let o=Ar();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){let r=Nt();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,P()))}populateOverlays(e,n,r){let i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,i){let s=Je(),o=Cr(),a=function(){return Cr()}();return n.forEach((c,u)=>{let l=r.get(u.key);i.has(u.key)&&(l===void 0||l.mutation instanceof Ye)?s=s.insert(u.key,u):l!==void 0?(o.set(u.key,l.mutation.getFieldMask()),Dr(l.mutation,u,l.mutation.getFieldMask(),ne.now())):o.set(u.key,Oe.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((u,l)=>o.set(u,l)),n.forEach((u,l)=>{var d;return a.set(u,new bc(l,(d=o.get(u))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,n){let r=Cr(),i=new q((o,a)=>o-a),s=P();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=n.get(c);if(u===null)return;let l=r.get(c)||Oe.empty();l=a.applyToLocalView(u,l),r.set(c,l);let d=(i.get(a.batchId)||P()).add(c);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,l=c.value,d=Jf();l.forEach(f=>{if(!s.has(f)){let m=rp(n.get(f),r.get(f));m!==null&&d.set(f,m),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,d))}return g.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(o){return E.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):zf(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):g.resolve(Nt()),a=-1,c=s;return o.next(u=>g.forEach(u,(l,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(l)?g.resolve():this.remoteDocumentCache.getEntry(e,l).next(f=>{c=c.insert(l,f)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,c,u,P())).next(l=>({batchId:a,changes:Qf(l)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new E(n)).next(r=>{let i=Ar();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){let s=n.collectionGroup,o=Ar();return this.indexManager.getCollectionParents(e,s).next(a=>g.forEach(a,c=>{let u=function(d,f){return new pt(f,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)}(n,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(l=>{l.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s,i))).next(o=>{s.forEach((c,u)=>{let l=u.getKey();o.get(l)===null&&(o=o.insert(l,Ae.newInvalidDocument(l)))});let a=Ar();return o.forEach((c,u)=>{let l=s.get(c);l!==void 0&&Dr(l.mutation,u,Oe.empty(),ne.now()),Ns(n,u)&&(a=a.insert(c,u))}),a})}};var Dc=class{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,n){return g.resolve(this.ur.get(n))}saveBundleMetadata(e,n){return this.ur.set(n.id,function(i){return{id:i.id,version:i.version,createTime:Fe(i.createTime)}}(n)),g.resolve()}getNamedQuery(e,n){return g.resolve(this.cr.get(n))}saveNamedQuery(e,n){return this.cr.set(n.name,function(i){return{name:i.name,query:Tv(i.bundledQuery),readTime:Fe(i.readTime)}}(n)),g.resolve()}};var Rc=class{constructor(){this.overlays=new q(E.comparator),this.lr=new Map}getOverlay(e,n){return g.resolve(this.overlays.get(n))}getOverlays(e,n){let r=Nt();return g.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.lt(e,n,s)}),g.resolve()}removeOverlaysForBatchId(e,n,r){let i=this.lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),g.resolve()}getOverlaysForCollection(e,n,r){let i=Nt(),s=n.length+1,o=new E(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return g.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new q((u,l)=>u-l),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>r){let l=s.get(u.largestBatchId);l===null&&(l=Nt(),s=s.insert(u.largestBatchId,l)),l.set(u.getKey(),u)}}let a=Nt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,l)=>a.set(u,l)),!(a.size()>=i)););return g.resolve(a)}lt(e,n,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new fc(n,r));let s=this.lr.get(n);s===void 0&&(s=P(),this.lr.set(n,s)),this.lr.set(n,s.add(r.key))}};var Mr=class{constructor(){this.hr=new ae(G.Pr),this.Ir=new ae(G.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,n){let r=new G(e,n);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.dr(new G(e,n))}Ar(e,n){e.forEach(r=>this.removeReference(r,n))}Rr(e){let n=new E(new L([])),r=new G(n,e),i=new G(n,e+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){let n=new E(new L([])),r=new G(n,e),i=new G(n,e+1),s=P();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let n=new G(e,0),r=this.hr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}},G=class{constructor(e,n){this.key=e,this.gr=n}static Pr(e,n){return E.comparator(e.key,n.key)||V(e.gr,n.gr)}static Tr(e,n){return V(e.gr,n.gr)||E.comparator(e.key,n.key)}};var Pc=class{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.pr=1,this.yr=new ae(G.Pr)}checkEmpty(e){return g.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){let s=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new hc(s,n,r,i);this.mutationQueue.push(o);for(let a of i)this.yr=this.yr.add(new G(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return g.resolve(o)}lookupMutationBatch(e,n){return g.resolve(this.wr(n))}getNextMutationBatchAfterBatchId(e,n){let r=n+1,i=this.Sr(r),s=i<0?0:i;return g.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return g.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(e){return g.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){let r=new G(n,0),i=new G(n,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{let a=this.wr(o.gr);s.push(a)}),g.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ae(V);return n.forEach(i=>{let s=new G(i,0),o=new G(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{r=r.add(a.gr)})}),g.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,n){let r=n.path,i=r.length+1,s=r;E.isDocumentKey(s)||(s=s.child(""));let o=new G(new E(s),0),a=new ae(V);return this.yr.forEachWhile(c=>{let u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(c.gr)),!0)},o),g.resolve(this.br(a))}br(e){let n=[];return e.forEach(r=>{let i=this.wr(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){x(this.Dr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.yr;return g.forEach(n.mutations,i=>{let s=new G(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,n){let r=new G(n,0),i=this.yr.firstAfterOrEqual(r);return g.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,g.resolve()}Dr(e,n){return this.Sr(e)}Sr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}wr(e){let n=this.Sr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}};var Nc=class{constructor(e){this.Cr=e,this.docs=function(){return new q(E.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){let r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){let r=this.docs.get(n);return g.resolve(r?r.document.mutableCopy():Ae.newInvalidDocument(n))}getEntries(e,n){let r=Je();return n.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ae.newInvalidDocument(i))}),g.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=Je(),o=n.path,a=new E(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:l}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Vy(ky(l),r)<=0||(i.has(l.key)||Ns(n,l))&&(s=s.insert(l.key,l.mutableCopy()))}return g.resolve(s)}getAllFromCollectionGroup(e,n,r,i){A()}vr(e,n){return g.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new kc(this)}getSize(e){return g.resolve(this.size)}},kc=class extends Sc{constructor(e){super(),this._r=e}applyChanges(e){let n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),g.waitFor(n)}getFromCache(e,n){return this._r.getEntry(e,n)}getAllFromCache(e,n){return this._r.getEntries(e,n)}};var Vc=class{constructor(e){this.persistence=e,this.Fr=new mt(n=>Au(n),Su),this.lastRemoteSnapshotVersion=D.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Mr,this.targetCount=0,this.Nr=xr.On()}forEachTarget(e,n){return this.Fr.forEach((r,i)=>n(i)),g.resolve()}getLastRemoteSnapshotVersion(e){return g.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return g.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),g.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Mr&&(this.Mr=n),g.resolve()}kn(e){this.Fr.set(e.target,e);let n=e.targetId;n>this.highestTargetId&&(this.Nr=new xr(n),this.highestTargetId=n),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,n){return this.kn(n),this.targetCount+=1,g.resolve()}updateTargetData(e,n){return this.kn(n),g.resolve()}removeTargetData(e,n){return this.Fr.delete(n.target),this.Or.Rr(n.targetId),this.targetCount-=1,g.resolve()}removeTargets(e,n,r){let i=0,s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),g.waitFor(s).next(()=>i)}getTargetCount(e){return g.resolve(this.targetCount)}getTargetData(e,n){let r=this.Fr.get(n)||null;return g.resolve(r)}addMatchingKeys(e,n,r){return this.Or.Er(n,r),g.resolve()}removeMatchingKeys(e,n,r){this.Or.Ar(n,r);let i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),g.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.Or.Rr(n),g.resolve()}getMatchingKeysForTargetId(e,n){let r=this.Or.mr(n);return g.resolve(r)}containsKey(e,n){return g.resolve(this.Or.containsKey(n))}};var Oc=class{constructor(e,n){this.Lr={},this.overlays={},this.Br=new Mf(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new Vc(this),this.indexManager=new Tc,this.remoteDocumentCache=function(i){return new Nc(i)}(r=>this.referenceDelegate.Qr(r)),this.serializer=new wc(n),this.Kr=new Dc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new Rc,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.Lr[e.toKey()];return r||(r=new Pc(n,this.referenceDelegate),this.Lr[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,n,r){v("MemoryPersistence","Starting transaction:",e);let i=new xc(this.Br.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,n){return g.or(Object.values(this.Lr).map(r=>()=>r.containsKey(e,n)))}},xc=class extends Ha{constructor(e){super(),this.currentSequenceNumber=e}},Mc=class t{constructor(e){this.persistence=e,this.Gr=new Mr,this.zr=null}static jr(e){return new t(e)}get Hr(){if(this.zr)return this.zr;throw A()}addReference(e,n,r){return this.Gr.addReference(r,n),this.Hr.delete(r.toString()),g.resolve()}removeReference(e,n,r){return this.Gr.removeReference(r,n),this.Hr.add(r.toString()),g.resolve()}markPotentiallyOrphaned(e,n){return this.Hr.add(n.toString()),g.resolve()}removeTarget(e,n){this.Gr.Rr(n.targetId).forEach(i=>this.Hr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}$r(){this.zr=new Set}Ur(e){let n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return g.forEach(this.Hr,r=>{let i=E.fromPath(r);return this.Jr(e,i).next(s=>{s||n.removeEntry(i,D.min())})}).next(()=>(this.zr=null,n.apply(e)))}updateLimboDocument(e,n){return this.Jr(e,n).next(r=>{r?this.Hr.delete(n.toString()):this.Hr.add(n.toString())})}Qr(e){return 0}Jr(e,n){return g.or([()=>g.resolve(this.Gr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Wr(e,n)])}};var Fc=class t{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.ki=r,this.qi=i}static Qi(e,n){let r=P(),i=P();for(let s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new t(e,n.fromCache,r,i)}};var Lc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Uc=class{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=function(){return gh()?8:xy(W())>0?6:4}()}initialize(e,n){this.Gi=e,this.indexManager=n,this.Ki=!0}getDocumentsMatchingQuery(e,n,r,i){let s={result:null};return this.zi(e,n).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(e,n,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Lc;return this.Hi(e,n,o).next(a=>{if(s.result=a,this.$i)return this.Ji(e,n,o,a.size)})}).next(()=>s.result)}Ji(e,n,r,i){return r.documentReadCount<this.Ui?(Tr()<=R.DEBUG&&v("QueryEngine","SDK will not create cache indexes for query:",hn(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),g.resolve()):(Tr()<=R.DEBUG&&v("QueryEngine","Query:",hn(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(Tr()<=R.DEBUG&&v("QueryEngine","The SDK decides to create cache indexes for query:",hn(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Me(n))):g.resolve())}zi(e,n){if(df(n))return g.resolve(null);let r=Me(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=cc(n,null,"F"),r=Me(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=P(...s);return this.Gi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{let u=this.Yi(n,a);return this.Zi(n,u,o,c.readTime)?this.zi(e,cc(n,null,"F")):this.Xi(e,u,n,c)}))})))}ji(e,n,r,i){return df(n)||i.isEqual(D.min())?g.resolve(null):this.Gi.getDocuments(e,r).next(s=>{let o=this.Yi(n,s);return this.Zi(n,o,r,i)?g.resolve(null):(Tr()<=R.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),hn(n)),this.Xi(e,o,n,Ny(i,-1)).next(a=>a))})}Yi(e,n){let r=new ae(Hf(e));return n.forEach((i,s)=>{Ns(e,s)&&(r=r.add(s))}),r}Zi(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;let s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,n,r){return Tr()<=R.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",hn(n)),this.Gi.getDocumentsMatchingQuery(e,n,Mt.min(),r)}Xi(e,n,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Bc=class{constructor(e,n,r,i){this.persistence=e,this.es=n,this.serializer=i,this.ts=new q(V),this.ns=new mt(s=>Au(s),Su),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Cc(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.ts))}};function Av(t,e,n,r){return new Bc(t,e,n,r)}function fp(t,e){return h(this,null,function*(){let n=C(t);return yield n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n.os(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],c=P();for(let u of i){o.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}for(let u of s){a.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}return n.localDocuments.getDocuments(r,c).next(u=>({_s:u,removedBatchIds:o,addedBatchIds:a}))})})})}function Sv(t,e){let n=C(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=n.ss.newChangeBuffer({trackRemovals:!0});return function(a,c,u,l){let d=u.batch,f=d.keys(),m=g.resolve();return f.forEach(T=>{m=m.next(()=>l.getEntry(c,T)).next(S=>{let I=u.docVersions.get(T);x(I!==null),S.version.compareTo(I)<0&&(d.applyToRemoteDocument(S,u),S.isValidDocument()&&(S.setReadTime(u.commitVersion),l.addEntry(S)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(c,d))}(n,r,e,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=P();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function pp(t){let e=C(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.qr.getLastRemoteSnapshotVersion(n))}function bv(t,e){let n=C(t),r=e.snapshotVersion,i=n.ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=n.ss.newChangeBuffer({trackRemovals:!0});i=n.ts;let a=[];e.targetChanges.forEach((l,d)=>{let f=i.get(d);if(!f)return;a.push(n.qr.removeMatchingKeys(s,l.removedDocuments,d).next(()=>n.qr.addMatchingKeys(s,l.addedDocuments,d)));let m=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?m=m.withResumeToken(ue.EMPTY_BYTE_STRING,D.min()).withLastLimboFreeSnapshotVersion(D.min()):l.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(l.resumeToken,r)),i=i.insert(d,m),function(S,I,k){return S.resumeToken.approximateByteSize()===0||I.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:k.addedDocuments.size+k.modifiedDocuments.size+k.removedDocuments.size>0}(f,m,l)&&a.push(n.qr.updateTargetData(s,m))});let c=Je(),u=P();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(Cv(s,o,e.documentUpdates).next(l=>{c=l.us,u=l.cs})),!r.isEqual(D.min())){let l=n.qr.getLastRemoteSnapshotVersion(s).next(d=>n.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return g.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(n.ts=i,s))}function Cv(t,e,n){let r=P(),i=P();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let o=Je();return n.forEach((a,c)=>{let u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(D.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):v("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{us:o,cs:i}})}function Dv(t,e){let n=C(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Rv(t,e){let n=C(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.qr.getTargetData(r,e).next(s=>s?(i=s,g.resolve(i)):n.qr.allocateTargetId(r).next(o=>(i=new Or(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=n.ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.ts=n.ts.insert(r.targetId,r),n.ns.set(e,r.targetId)),r})}function qc(t,e,n){return h(this,null,function*(){let r=C(t),i=r.ts.get(e),s=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!$r(o))throw o;v("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)})}function Tf(t,e,n){let r=C(t),i=D.min(),s=P();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,l){let d=C(c),f=d.ns.get(l);return f!==void 0?g.resolve(d.ts.get(f)):d.qr.getTargetData(u,l)}(r,o,Me(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.es.getDocumentsMatchingQuery(o,e,n?i:D.min(),n?s:P())).next(a=>(Pv(r,zy(e),a),{documents:a,ls:s})))}function Pv(t,e,n){let r=t.rs.get(e)||D.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.rs.set(e,r)}var ds=class{constructor(){this.activeTargetIds=Yy()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var $c=class{constructor(){this.eo=new ds,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,n,r){this.no[e]=n}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new ds,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var jc=class{ro(e){}shutdown(){}};var fs=class{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ao)e(0)}_o(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ao)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Qi=null;function Ma(){return Qi===null?Qi=function(){return 268435456+Math.round(2147483648*Math.random())}():Qi++,"0x"+Qi.toString(16)}var Nv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Gc=class{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}Eo(e){this.Ao=e}onMessage(e){this.Ro=e}close(){this.lo()}send(e){this.co(e)}Vo(){this.Po()}mo(){this.To()}fo(e){this.Ao(e)}po(e){this.Ro(e)}};var oe="WebChannelConnection",zc=class extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;let r=n.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.yo=r+"://"+n.host,this.wo=`projects/${i}/databases/${s}`,this.So=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get bo(){return!1}Do(n,r,i,s,o){let a=Ma(),c=this.Co(n,r.toUriEncodedString());v("RestConnection",`Sending RPC '${n}' ${a}:`,c,i);let u={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(u,s,o),this.Fo(n,c,u,i).then(l=>(v("RestConnection",`Received RPC '${n}' ${a}: `,l),l),l=>{throw _n("RestConnection",`RPC '${n}' ${a} failed with error: `,l,"url: ",c,"request:",i),l})}Mo(n,r,i,s,o,a){return this.Do(n,r,i,s,o)}vo(n,r,i){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Rn}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>n[o]=s),i&&i.headers.forEach((s,o)=>n[o]=s)}Co(n,r){let i=Nv[n];return`${this.yo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Fo(e,n,r,i){let s=Ma();return new Promise((o,a)=>{let c=new ef;c.setWithCredentials(!0),c.listenOnce(Yd.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Hi.NO_ERROR:let l=c.getResponseJson();v(oe,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case Hi.TIMEOUT:v(oe,`RPC '${e}' ${s} timed out`),a(new y(p.DEADLINE_EXCEEDED,"Request time out"));break;case Hi.HTTP_ERROR:let d=c.getStatus();if(v(oe,`RPC '${e}' ${s} failed with status:`,d,"response text:",c.getResponseText()),d>0){let f=c.getResponseJson();Array.isArray(f)&&(f=f[0]);let m=f?.error;if(m&&m.status&&m.message){let T=function(I){let k=I.toLowerCase().replace(/_/g,"-");return Object.values(p).indexOf(k)>=0?k:p.UNKNOWN}(m.status);a(new y(T,m.message))}else a(new y(p.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new y(p.UNAVAILABLE,"Connection failed."));break;default:A()}}finally{v(oe,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(i);v(oe,`RPC '${e}' ${s} sending request:`,i),c.send(n,"POST",u,r,15)})}xo(e,n,r){let i=Ma(),s=[this.yo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Qd(),a=Jd(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.xmlHttpFactory=new Zd({})),this.vo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;let l=s.join("");v(oe,`Creating RPC '${e}' stream ${i}: ${l}`,c);let d=o.createWebChannel(l,c),f=!1,m=!1,T=new Gc({co:I=>{m?v(oe,`Not sending because RPC '${e}' stream ${i} is closed:`,I):(f||(v(oe,`Opening RPC '${e}' stream ${i} transport.`),d.open(),f=!0),v(oe,`RPC '${e}' stream ${i} sending:`,I),d.send(I))},lo:()=>d.close()}),S=(I,k,F)=>{I.listen(k,$=>{try{F($)}catch(re){setTimeout(()=>{throw re},0)}})};return S(d,wr.EventType.OPEN,()=>{m||(v(oe,`RPC '${e}' stream ${i} transport opened.`),T.Vo())}),S(d,wr.EventType.CLOSE,()=>{m||(m=!0,v(oe,`RPC '${e}' stream ${i} transport closed`),T.fo())}),S(d,wr.EventType.ERROR,I=>{m||(m=!0,_n(oe,`RPC '${e}' stream ${i} transport errored:`,I),T.fo(new y(p.UNAVAILABLE,"The operation could not be completed")))}),S(d,wr.EventType.MESSAGE,I=>{var k;if(!m){let F=I.data[0];x(!!F);let $=F,re=$.error||((k=$[0])===null||k===void 0?void 0:k.error);if(re){v(oe,`RPC '${e}' stream ${i} received error:`,re);let Ce=re.status,K=function(Un){let ni=j[Un];if(ni!==void 0)return sp(ni)}(Ce),Be=re.message;K===void 0&&(K=p.INTERNAL,Be="Unknown error status: "+Ce+" with message "+re.message),m=!0,T.fo(new y(K,Be)),d.close()}else v(oe,`RPC '${e}' stream ${i} received:`,F),T.po(F)}}),S(a,Xd.STAT_EVENT,I=>{I.stat===Oa.PROXY?v(oe,`RPC '${e}' stream ${i} detected buffering proxy`):I.stat===Oa.NOPROXY&&v(oe,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{T.mo()},0),T}};function Fa(){return typeof document<"u"?document:null}function ks(t){return new _c(t,!0)}var ps=class{constructor(e,n,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=n,this.Oo=r,this.No=i,this.Lo=s,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(e){this.cancel();let n=Math.floor(this.Bo+this.$o()),r=Math.max(0,Date.now()-this.qo),i=Math.max(0,n-r);i>0&&v("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Bo} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.qo=Date.now(),e())),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){this.ko!==null&&(this.ko.skipDelay(),this.ko=null)}cancel(){this.ko!==null&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}};var ms=class{constructor(e,n,r,i,s,o,a,c){this.si=e,this.Wo=r,this.Go=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new ps(e,n)}Yo(){return this.state===1||this.state===5||this.Zo()}Zo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Xo()}stop(){return h(this,null,function*(){this.Yo()&&(yield this.close(0))})}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&this.jo===null&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,()=>this.n_()))}r_(e){this.i_(),this.stream.send(e)}n_(){return h(this,null,function*(){if(this.Zo())return this.close(0)})}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}close(e,n){return h(this,null,function*(){this.i_(),this.s_(),this.Jo.cancel(),this.zo++,e!==4?this.Jo.reset():n&&n.code===p.RESOURCE_EXHAUSTED?(Ke(n.toString()),Ke("Using maximum backoff delay to prevent overloading the backend."),this.Jo.Qo()):n&&n.code===p.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.o_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Eo(n)})}o_(){}auth(){this.state=1;let e=this.__(this.zo),n=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.zo===n&&this.a_(r,i)},r=>{e(()=>{let i=new y(p.UNKNOWN,"Fetching auth token failed: "+r.message);return this.u_(i)})})}a_(e,n){let r=this.__(this.zo);this.stream=this.c_(e,n),this.stream.ho(()=>{r(()=>this.listener.ho())}),this.stream.Io(()=>{r(()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,()=>(this.Zo()&&(this.state=3),Promise.resolve())),this.listener.Io()))}),this.stream.Eo(i=>{r(()=>this.u_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Xo(){this.state=5,this.Jo.Ko(()=>h(this,null,function*(){this.state=0,this.start()}))}u_(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}__(e){return n=>{this.si.enqueueAndForget(()=>this.zo===e?n():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Wc=class extends ms{constructor(e,n,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}c_(e,n){return this.connection.xo("Listen",e,n)}onMessage(e){this.Jo.reset();let n=dv(this.serializer,e),r=function(s){if(!("targetChange"in s))return D.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?D.min():o.readTime?Fe(o.readTime):D.min()}(e);return this.listener.l_(n,r)}h_(e){let n={};n.database=Ec(this.serializer),n.addTarget=function(s,o){let a,c=o.target;if(a=oc(c)?{documents:mv(s,c)}:{query:gv(s,c)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=op(s,o.resumeToken);let u=yc(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(D.min())>0){a.readTime=ls(s,o.snapshotVersion.toTimestamp());let u=yc(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let r=yv(this.serializer,e);r&&(n.labels=r),this.r_(n)}P_(e){let n={};n.database=Ec(this.serializer),n.removeTarget=e,this.r_(n)}},Hc=class extends ms{constructor(e,n,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s,this.I_=!1}get T_(){return this.I_}start(){this.I_=!1,this.lastStreamToken=void 0,super.start()}o_(){this.I_&&this.E_([])}c_(e,n){return this.connection.xo("Write",e,n)}onMessage(e){if(x(!!e.streamToken),this.lastStreamToken=e.streamToken,this.I_){this.Jo.reset();let n=pv(e.writeResults,e.commitTime),r=Fe(e.commitTime);return this.listener.d_(r,n)}return x(!e.writeResults||e.writeResults.length===0),this.I_=!0,this.listener.A_()}R_(){let e={};e.database=Ec(this.serializer),this.r_(e)}E_(e){let n={streamToken:this.lastStreamToken,writes:e.map(r=>fv(this.serializer,r))};this.r_(n)}};var Kc=class extends class{}{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.V_=!1}m_(){if(this.V_)throw new y(p.FAILED_PRECONDITION,"The client has already been terminated.")}Do(e,n,r,i){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Do(e,vc(n,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===p.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(p.UNKNOWN,s.toString())})}Mo(e,n,r,i,s){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Mo(e,vc(n,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===p.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new y(p.UNKNOWN,o.toString())})}terminate(){this.V_=!0,this.connection.terminate()}};var Qc=class{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,e==="Online"&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){let n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(Ke(n),this.y_=!1):v("OnlineStateTracker",n)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var Jc=class{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.ro(o=>{r.enqueueAndForget(()=>h(this,null,function*(){jt(this)&&(v("RemoteStore","Restarting streams for network reachability change."),yield function(c){return h(this,null,function*(){let u=C(c);u.M_.add(4),yield jr(u),u.N_.set("Unknown"),u.M_.delete(4),yield Vs(u)})}(this))}))}),this.N_=new Qc(r,i)}};function Vs(t){return h(this,null,function*(){if(jt(t))for(let e of t.x_)yield e(!0)})}function jr(t){return h(this,null,function*(){for(let e of t.x_)yield e(!1)})}function mp(t,e){let n=C(t);n.F_.has(e.targetId)||(n.F_.set(e.targetId,e),Nu(n)?Pu(n):Nn(n).Zo()&&Ru(n,e))}function Du(t,e){let n=C(t),r=Nn(n);n.F_.delete(e),r.Zo()&&gp(n,e),n.F_.size===0&&(r.Zo()?r.t_():jt(n)&&n.N_.set("Unknown"))}function Ru(t,e){if(t.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(D.min())>0){let n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Nn(t).h_(e)}function gp(t,e){t.L_.xe(e),Nn(t).P_(e)}function Pu(t){t.L_=new gc({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.F_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),Nn(t).start(),t.N_.w_()}function Nu(t){return jt(t)&&!Nn(t).Yo()&&t.F_.size>0}function jt(t){return C(t).M_.size===0}function _p(t){t.L_=void 0}function kv(t){return h(this,null,function*(){t.N_.set("Online")})}function Vv(t){return h(this,null,function*(){t.F_.forEach((e,n)=>{Ru(t,e)})})}function Ov(t,e){return h(this,null,function*(){_p(t),Nu(t)?(t.N_.D_(e),Pu(t)):t.N_.set("Unknown")})}function xv(t,e,n){return h(this,null,function*(){if(t.N_.set("Online"),e instanceof cs&&e.state===2&&e.cause)try{yield function(i,s){return h(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.F_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.F_.delete(a),i.L_.removeTarget(a))})}(t,e)}catch(r){v("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield gs(t,r)}else if(e instanceof mn?t.L_.Ke(e):e instanceof as?t.L_.He(e):t.L_.We(e),!n.isEqual(D.min()))try{let r=yield pp(t.localStore);n.compareTo(r)>=0&&(yield function(s,o){let a=s.L_.rt(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let l=s.F_.get(u);l&&s.F_.set(u,l.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let l=s.F_.get(c);if(!l)return;s.F_.set(c,l.withResumeToken(ue.EMPTY_BYTE_STRING,l.snapshotVersion)),gp(s,c);let d=new Or(l.target,c,u,l.sequenceNumber);Ru(s,d)}),s.remoteSyncer.applyRemoteEvent(a)}(t,n))}catch(r){v("RemoteStore","Failed to raise snapshot:",r),yield gs(t,r)}})}function gs(t,e,n){return h(this,null,function*(){if(!$r(e))throw e;t.M_.add(1),yield jr(t),t.N_.set("Offline"),n||(n=()=>pp(t.localStore)),t.asyncQueue.enqueueRetryable(()=>h(this,null,function*(){v("RemoteStore","Retrying IndexedDB access"),yield n(),t.M_.delete(1),yield Vs(t)}))})}function yp(t,e){return e().catch(n=>gs(t,n,e))}function Os(t){return h(this,null,function*(){let e=C(t),n=gt(e),r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;Mv(e);)try{let i=yield Dv(e.localStore,r);if(i===null){e.v_.length===0&&n.t_();break}r=i.batchId,Fv(e,i)}catch(i){yield gs(e,i)}vp(e)&&Ip(e)})}function Mv(t){return jt(t)&&t.v_.length<10}function Fv(t,e){t.v_.push(e);let n=gt(t);n.Zo()&&n.T_&&n.E_(e.mutations)}function vp(t){return jt(t)&&!gt(t).Yo()&&t.v_.length>0}function Ip(t){gt(t).start()}function Lv(t){return h(this,null,function*(){gt(t).R_()})}function Uv(t){return h(this,null,function*(){let e=gt(t);for(let n of t.v_)e.E_(n.mutations)})}function Bv(t,e,n){return h(this,null,function*(){let r=t.v_.shift(),i=dc.from(r,e,n);yield yp(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),yield Os(t)})}function qv(t,e){return h(this,null,function*(){e&&gt(t).T_&&(yield function(r,i){return h(this,null,function*(){if(function(o){return iv(o)&&o!==p.ABORTED}(i.code)){let s=r.v_.shift();gt(r).e_(),yield yp(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Os(r)}})}(t,e)),vp(t)&&Ip(t)})}function Af(t,e){return h(this,null,function*(){let n=C(t);n.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");let r=jt(n);n.M_.add(3),yield jr(n),r&&n.N_.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(e),n.M_.delete(3),yield Vs(n)})}function $v(t,e){return h(this,null,function*(){let n=C(t);e?(n.M_.delete(2),yield Vs(n)):e||(n.M_.add(2),yield jr(n),n.N_.set("Unknown"))})}function Nn(t){return t.B_||(t.B_=function(n,r,i){let s=C(n);return s.m_(),new Wc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{ho:kv.bind(null,t),Io:Vv.bind(null,t),Eo:Ov.bind(null,t),l_:xv.bind(null,t)}),t.x_.push(e=>h(this,null,function*(){e?(t.B_.e_(),Nu(t)?Pu(t):t.N_.set("Unknown")):(yield t.B_.stop(),_p(t))}))),t.B_}function gt(t){return t.k_||(t.k_=function(n,r,i){let s=C(n);return s.m_(),new Hc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{ho:()=>Promise.resolve(),Io:Lv.bind(null,t),Eo:qv.bind(null,t),A_:Uv.bind(null,t),d_:Bv.bind(null,t)}),t.x_.push(e=>h(this,null,function*(){e?(t.k_.e_(),yield Os(t)):(yield t.k_.stop(),t.v_.length>0&&(v("RemoteStore",`Stopping write stream with ${t.v_.length} pending writes`),t.v_=[]))}))),t.k_}var Yc=class t{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new He,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,s){let o=Date.now()+r,a=new t(e,n,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(p.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ku(t,e){if(Ke("AsyncQueue",`${e}: ${t}`),$r(t))return new y(p.UNAVAILABLE,`${e}: ${t}`);throw t}var _s=class t{constructor(e){this.comparator=e?(n,r)=>e(n,r)||E.comparator(n.key,r.key):(n,r)=>E.comparator(n.key,r.key),this.keyedMap=Ar(),this.sortedSet=new q(this.comparator)}static emptySet(e){return new t(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){let n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){let n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof t)||this.size!==e.size)return!1;let n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){let i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){let r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}};var ys=class{constructor(){this.q_=new q(E.comparator)}track(e){let n=e.doc.key,r=this.q_.get(n);r?e.type!==0&&r.type===3?this.q_=this.q_.insert(n,e):e.type===3&&r.type!==1?this.q_=this.q_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.q_=this.q_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.q_=this.q_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.q_=this.q_.remove(n):e.type===1&&r.type===2?this.q_=this.q_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.q_=this.q_.insert(n,{type:2,doc:e.doc}):A():this.q_=this.q_.insert(n,e)}Q_(){let e=[];return this.q_.inorderTraversal((n,r)=>{e.push(r)}),e}},bn=class t{constructor(e,n,r,i,s,o,a,c,u){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,n,r,i,s){let o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new t(e,n,_s.emptySet(n),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ps(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}};var Xc=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}},Zc=class{constructor(){this.queries=new mt(e=>Wf(e),Ps),this.onlineState="Unknown",this.z_=new Set}};function jv(t,e){return h(this,null,function*(){let n=C(t),r=3,i=e.query,s=n.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new Xc,r=e.G_()?0:1);try{switch(r){case 0:s.K_=yield n.onListen(i,!0);break;case 1:s.K_=yield n.onListen(i,!1);break;case 2:yield n.onFirstRemoteStoreListen(i)}}catch(o){let a=ku(o,`Initialization of query '${hn(e.query)}' failed`);return void e.onError(a)}n.queries.set(i,s),s.U_.push(e),e.j_(n.onlineState),s.K_&&e.H_(s.K_)&&Vu(n)})}function Gv(t,e){return h(this,null,function*(){let n=C(t),r=e.query,i=3,s=n.queries.get(r);if(s){let o=s.U_.indexOf(e);o>=0&&(s.U_.splice(o,1),s.U_.length===0?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}})}function zv(t,e){let n=C(t),r=!1;for(let i of e){let s=i.query,o=n.queries.get(s);if(o){for(let a of o.U_)a.H_(i)&&(r=!0);o.K_=i}}r&&Vu(n)}function Wv(t,e,n){let r=C(t),i=r.queries.get(e);if(i)for(let s of i.U_)s.onError(n);r.queries.delete(e)}function Vu(t){t.z_.forEach(e=>{e.next()})}var eu,Sf;(Sf=eu||(eu={})).J_="default",Sf.Cache="cache";var tu=class{constructor(e,n,r){this.query=e,this.Y_=n,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new bn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),n=!0):this.ta(e,this.onlineState)&&(this.na(e),n=!0),this.X_=e,n}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let n=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),n=!0),n}ta(e,n){if(!e.fromCache||!this.G_())return!0;let r=n!=="Offline";return(!this.options.ra||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ea(e){if(e.docChanges.length>0)return!0;let n=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}na(e){e=bn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==eu.Cache}};var vs=class{constructor(e){this.key=e}},Is=class{constructor(e){this.key=e}},nu=class{constructor(e,n){this.query=e,this.la=n,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=P(),this.mutatedKeys=P(),this.Ia=Hf(e),this.Ta=new _s(this.Ia)}get Ea(){return this.la}da(e,n){let r=n?n.Aa:new ys,i=n?n.Ta:this.Ta,s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,d)=>{let f=i.get(l),m=Ns(this.query,d)?d:null,T=!!f&&this.mutatedKeys.has(f.key),S=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations),I=!1;f&&m?f.data.isEqual(m.data)?T!==S&&(r.track({type:3,doc:m}),I=!0):this.Ra(f,m)||(r.track({type:2,doc:m}),I=!0,(c&&this.Ia(m,c)>0||u&&this.Ia(m,u)<0)&&(a=!0)):!f&&m?(r.track({type:0,doc:m}),I=!0):f&&!m&&(r.track({type:1,doc:f}),I=!0,(c||u)&&(a=!0)),I&&(m?(o=o.add(m),s=S?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Ta:o,Aa:r,Zi:a,mutatedKeys:s}}Ra(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){let s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;let o=e.Aa.Q_();o.sort((l,d)=>function(m,T){let S=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return A()}};return S(m)-S(T)}(l.type,d.type)||this.Ia(l.doc,d.doc)),this.Va(r),i=i!=null&&i;let a=n&&!i?this.ma():[],c=this.Pa.size===0&&this.current&&!i?1:0,u=c!==this.ha;return this.ha=c,o.length!==0||u?{snapshot:new bn(this.query,e.Ta,s,o,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new ys,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(n=>this.la=this.la.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.la=this.la.delete(n)),this.current=e.current)}ma(){if(!this.current)return[];let e=this.Pa;this.Pa=P(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});let n=[];return e.forEach(r=>{this.Pa.has(r)||n.push(new Is(r))}),this.Pa.forEach(r=>{e.has(r)||n.push(new vs(r))}),n}pa(e){this.la=e.ls,this.Pa=P();let n=this.da(e.documents);return this.applyChanges(n,!0)}ya(){return bn.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},ru=class{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}},iu=class{constructor(e){this.key=e,this.wa=!1}},su=class{constructor(e,n,r,i,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new mt(a=>Wf(a),Ps),this.Da=new Map,this.Ca=new Set,this.va=new q(E.comparator),this.Fa=new Map,this.Ma=new Mr,this.xa={},this.Oa=new Map,this.Na=xr.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function Hv(t,e,n=!0){return h(this,null,function*(){let r=bp(t),i,s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield Ep(r,e,n,!0),i})}function Kv(t,e){return h(this,null,function*(){let n=bp(t);yield Ep(n,e,!0,!1)})}function Ep(t,e,n,r){return h(this,null,function*(){let i=yield Rv(t.localStore,Me(e)),s=i.targetId,o=n?t.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield Qv(t,e,s,o==="current",i.resumeToken)),t.isPrimaryClient&&n&&mp(t.remoteStore,i),a})}function Qv(t,e,n,r,i){return h(this,null,function*(){t.Ba=(d,f,m)=>function(S,I,k,F){return h(this,null,function*(){let $=I.view.da(k);$.Zi&&($=yield Tf(S.localStore,I.query,!1).then(({documents:Be})=>I.view.da(Be,$)));let re=F&&F.targetChanges.get(I.targetId),Ce=F&&F.targetMismatches.get(I.targetId)!=null,K=I.view.applyChanges($,S.isPrimaryClient,re,Ce);return Cf(S,I.targetId,K.fa),K.snapshot})}(t,d,f,m);let s=yield Tf(t.localStore,e,!0),o=new nu(e,s.ls),a=o.da(s.documents),c=Vr.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),u=o.applyChanges(a,t.isPrimaryClient,c);Cf(t,n,u.fa);let l=new ru(e,n,o);return t.ba.set(e,l),t.Da.has(n)?t.Da.get(n).push(e):t.Da.set(n,[e]),u.snapshot})}function Jv(t,e,n){return h(this,null,function*(){let r=C(t),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(o=>!Ps(o,e))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield qc(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Du(r.remoteStore,i.targetId),ou(r,i.targetId)}).catch(qr))):(ou(r,i.targetId),yield qc(r.localStore,i.targetId,!0))})}function Yv(t,e){return h(this,null,function*(){let n=C(t),r=n.ba.get(e),i=n.Da.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Du(n.remoteStore,r.targetId))})}function Xv(t,e,n){return h(this,null,function*(){let r=sI(t);try{let i=yield function(o,a){let c=C(o),u=ne.now(),l=a.reduce((m,T)=>m.add(T.key),P()),d,f;return c.persistence.runTransaction("Locally write mutations","readwrite",m=>{let T=Je(),S=P();return c.ss.getEntries(m,l).next(I=>{T=I,T.forEach((k,F)=>{F.isValidDocument()||(S=S.add(k))})}).next(()=>c.localDocuments.getOverlayedDocuments(m,T)).next(I=>{d=I;let k=[];for(let F of a){let $=rv(F,d.get(F.key).overlayedDocument);$!=null&&k.push(new Ye(F.key,$,Uf($.value.mapValue),Ot.exists(!0)))}return c.mutationQueue.addMutationBatch(m,u,k,a)}).next(I=>{f=I;let k=I.applyToLocalDocumentSet(d,S);return c.documentOverlayCache.saveOverlays(m,I.batchId,k)})}).then(()=>({batchId:f.batchId,changes:Qf(d)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let u=o.xa[o.currentUser.toKey()];u||(u=new q(V)),u=u.insert(a,c),o.xa[o.currentUser.toKey()]=u}(r,i.batchId,n),yield Gr(r,i.changes),yield Os(r.remoteStore)}catch(i){let s=ku(i,"Failed to persist write");n.reject(s)}})}function wp(t,e){return h(this,null,function*(){let n=C(t);try{let r=yield bv(n.localStore,e);e.targetChanges.forEach((i,s)=>{let o=n.Fa.get(s);o&&(x(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?x(o.wa):i.removedDocuments.size>0&&(x(o.wa),o.wa=!1))}),yield Gr(n,r,e)}catch(r){yield qr(r)}})}function bf(t,e,n){let r=C(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){let i=[];r.ba.forEach((s,o)=>{let a=o.view.j_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let c=C(o);c.onlineState=a;let u=!1;c.queries.forEach((l,d)=>{for(let f of d.U_)f.j_(a)&&(u=!0)}),u&&Vu(c)}(r.eventManager,e),i.length&&r.Sa.l_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Zv(t,e,n){return h(this,null,function*(){let r=C(t);r.sharedClientState.updateQueryState(e,"rejected",n);let i=r.Fa.get(e),s=i&&i.key;if(s){let o=new q(E.comparator);o=o.insert(s,Ae.newNoDocument(s,D.min()));let a=P().add(s),c=new os(D.min(),new Map,new q(V),o,a);yield wp(r,c),r.va=r.va.remove(s),r.Fa.delete(e),Ou(r)}else yield qc(r.localStore,e,!1).then(()=>ou(r,e,n)).catch(qr)})}function eI(t,e){return h(this,null,function*(){let n=C(t),r=e.batch.batchId;try{let i=yield Sv(n.localStore,e);Ap(n,r,null),Tp(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield Gr(n,i)}catch(i){yield qr(i)}})}function tI(t,e,n){return h(this,null,function*(){let r=C(t);try{let i=yield function(o,a){let c=C(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let l;return c.mutationQueue.lookupMutationBatch(u,a).next(d=>(x(d!==null),l=d.keys(),c.mutationQueue.removeMutationBatch(u,d))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,l,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,l)).next(()=>c.localDocuments.getDocuments(u,l))})}(r.localStore,e);Ap(r,e,n),Tp(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),yield Gr(r,i)}catch(i){yield qr(i)}})}function Tp(t,e){(t.Oa.get(e)||[]).forEach(n=>{n.resolve()}),t.Oa.delete(e)}function Ap(t,e,n){let r=C(t),i=r.xa[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function ou(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(let r of t.Da.get(e))t.ba.delete(r),n&&t.Sa.ka(r,n);t.Da.delete(e),t.isPrimaryClient&&t.Ma.Rr(e).forEach(r=>{t.Ma.containsKey(r)||Sp(t,r)})}function Sp(t,e){t.Ca.delete(e.path.canonicalString());let n=t.va.get(e);n!==null&&(Du(t.remoteStore,n),t.va=t.va.remove(e),t.Fa.delete(n),Ou(t))}function Cf(t,e,n){for(let r of n)r instanceof vs?(t.Ma.addReference(r.key,e),nI(t,r)):r instanceof Is?(v("SyncEngine","Document no longer in limbo: "+r.key),t.Ma.removeReference(r.key,e),t.Ma.containsKey(r.key)||Sp(t,r.key)):A()}function nI(t,e){let n=e.key,r=n.path.canonicalString();t.va.get(n)||t.Ca.has(r)||(v("SyncEngine","New document in limbo: "+n),t.Ca.add(r),Ou(t))}function Ou(t){for(;t.Ca.size>0&&t.va.size<t.maxConcurrentLimboResolutions;){let e=t.Ca.values().next().value;t.Ca.delete(e);let n=new E(L.fromString(e)),r=t.Na.next();t.Fa.set(r,new iu(n)),t.va=t.va.insert(n,r),mp(t.remoteStore,new Or(Me(bu(n.path)),r,"TargetPurposeLimboResolution",Mf.oe))}}function Gr(t,e,n){return h(this,null,function*(){let r=C(t),i=[],s=[],o=[];r.ba.isEmpty()||(r.ba.forEach((a,c)=>{o.push(r.Ba(c,e,n).then(u=>{if((u||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,u?.fromCache?"not-current":"current"),u){i.push(u);let l=Fc.Qi(c.targetId,u);s.push(l)}}))}),yield Promise.all(o),r.Sa.l_(i),yield function(c,u){return h(this,null,function*(){let l=C(c);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>g.forEach(u,f=>g.forEach(f.ki,m=>l.persistence.referenceDelegate.addReference(d,f.targetId,m)).next(()=>g.forEach(f.qi,m=>l.persistence.referenceDelegate.removeReference(d,f.targetId,m)))))}catch(d){if(!$r(d))throw d;v("LocalStore","Failed to update sequence numbers: "+d)}for(let d of u){let f=d.targetId;if(!d.fromCache){let m=l.ts.get(f),T=m.snapshotVersion,S=m.withLastLimboFreeSnapshotVersion(T);l.ts=l.ts.insert(f,S)}}})}(r.localStore,s))})}function rI(t,e){return h(this,null,function*(){let n=C(t);if(!n.currentUser.isEqual(e)){v("SyncEngine","User change. New user:",e.toKey());let r=yield fp(n.localStore,e);n.currentUser=e,function(s,o){s.Oa.forEach(a=>{a.forEach(c=>{c.reject(new y(p.CANCELLED,o))})}),s.Oa.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Gr(n,r._s)}})}function iI(t,e){let n=C(t),r=n.Fa.get(e);if(r&&r.wa)return P().add(r.key);{let i=P(),s=n.Da.get(e);if(!s)return i;for(let o of s){let a=n.ba.get(o);i=i.unionWith(a.view.Ea)}return i}}function bp(t){let e=C(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=wp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=iI.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Zv.bind(null,e),e.Sa.l_=zv.bind(null,e.eventManager),e.Sa.ka=Wv.bind(null,e.eventManager),e}function sI(t){let e=C(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=eI.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=tI.bind(null,e),e}var Es=class{constructor(){this.synchronizeTabs=!1}initialize(e){return h(this,null,function*(){this.serializer=ks(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,n){return null}createIndexBackfillerScheduler(e,n){return null}createLocalStore(e){return Av(this.persistence,new Uc,e.initialUser,this.serializer)}createPersistence(e){return new Oc(Mc.jr,this.serializer)}createSharedClientState(e){return new $c}terminate(){return h(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var au=class{initialize(e,n){return h(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>bf(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=rI.bind(null,this.syncEngine),yield $v(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Zc}()}createDatastore(e){let n=ks(e.databaseInfo.databaseId),r=function(s){return new zc(s)}(e.databaseInfo);return function(s,o,a,c){return new Kc(s,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,s,o,a){return new Jc(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>bf(this.syncEngine,n,0),function(){return fs.D()?new fs:new jc}())}createSyncEngine(e,n){return function(i,s,o,a,c,u,l){let d=new su(i,s,o,a,c,u);return l&&(d.La=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return h(this,null,function*(){var e;yield function(r){return h(this,null,function*(){let i=C(r);v("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield jr(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};var cu=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):Ke("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}};var uu=class{constructor(e,n,r,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Y.UNAUTHENTICATED,this.clientId=Zi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>h(this,null,function*(){v("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(v("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(p.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new He;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>h(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let r=ku(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function La(t,e){return h(this,null,function*(){t.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");let n=t.configuration;yield e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(i=>h(this,null,function*(){r.isEqual(i)||(yield fp(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e})}function Df(t,e){return h(this,null,function*(){t.asyncQueue.verifyOperationInProgress();let n=yield aI(t);v("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>Af(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>Af(e.remoteStore,i)),t._onlineComponents=e})}function oI(t){return t.name==="FirebaseError"?t.code===p.FAILED_PRECONDITION||t.code===p.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}function aI(t){return h(this,null,function*(){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{yield La(t,t._uninitializedComponentsProvider._offline)}catch(e){let n=e;if(!oI(n))throw n;_n("Error using user provided cache. Falling back to memory cache: "+n),yield La(t,new Es)}}else v("FirestoreClient","Using default OfflineComponentProvider"),yield La(t,new Es);return t._offlineComponents})}function Cp(t){return h(this,null,function*(){return t._onlineComponents||(t._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),yield Df(t,t._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),yield Df(t,new au))),t._onlineComponents})}function cI(t){return Cp(t).then(e=>e.syncEngine)}function Rf(t){return h(this,null,function*(){let e=yield Cp(t),n=e.eventManager;return n.onListen=Hv.bind(null,e.syncEngine),n.onUnlisten=Jv.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Kv.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Yv.bind(null,e.syncEngine),n})}function Dp(t){let e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}var Pf=new Map;function Rp(t,e,n){if(!n)throw new y(p.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function uI(t,e,n,r){if(e===!0&&r===!0)throw new y(p.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Nf(t){if(!E.isDocumentKey(t))throw new y(p.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function kf(t){if(E.isDocumentKey(t))throw new y(p.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function xs(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":A()}function Rr(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new y(p.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=xs(t);throw new y(p.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}var ws=class{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new y(p.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new y(p.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}uI("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Dp((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new y(p.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new y(p.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new y(p.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Cn=class{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ws({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(p.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new y(p.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ws(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Ua;switch(r.type){case"firstParty":return new ja(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new y(p.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){let r=Pf.get(n);r&&(v("ComponentProvider","Removing Datastore"),Pf.delete(n),r.terminate())}(this),Promise.resolve()}};function Pp(t,e,n,r={}){var i;let s=(t=Rr(t,Cn))._getSettings(),o=`${e}:${n}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&_n("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,c;if(typeof r.mockUserToken=="string")a=r.mockUserToken,c=Y.MOCK_USER;else{a=hh(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);let u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new y(p.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Y(u)}t._authCredentials=new Ba(new Xi(a,c))}}var $t=class t{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new t(this.firestore,e,this._query)}},pe=class t{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new dt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new t(this.firestore,e,this._key)}},dt=class t extends $t{constructor(e,n,r){super(e,n,bu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new pe(this.firestore,null,new E(e))}withConverter(e){return new t(this.firestore,e,this._path)}};function Np(t,e,...n){if(t=Z(t),Rp("collection","path",e),t instanceof Cn){let r=L.fromString(e,...n);return kf(r),new dt(t,null,r)}{if(!(t instanceof pe||t instanceof dt))throw new y(p.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=t._path.child(L.fromString(e,...n));return kf(r),new dt(t.firestore,null,r)}}function kp(t,e,...n){if(t=Z(t),arguments.length===1&&(e=Zi.newId()),Rp("doc","path",e),t instanceof Cn){let r=L.fromString(e,...n);return Nf(r),new pe(t,null,new E(r))}{if(!(t instanceof pe||t instanceof dt))throw new y(p.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=t._path.child(L.fromString(e,...n));return Nf(r),new pe(t.firestore,t instanceof dt?t.converter:null,new E(r))}}var lu=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new ps(this,"async_queue_retry"),this.hu=()=>{let n=Fa();n&&v("AsyncQueue","Visibility state changed to "+n.visibilityState),this.Jo.Uo()};let e=Fa();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;let n=Fa();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});let n=new He;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){return h(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Jo.reset()}catch(e){if(!$r(e))throw e;v("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Jo.Ko(()=>this.Tu())}})}Iu(e){let n=this.iu.then(()=>(this.uu=!0,e().catch(r=>{this.au=r,this.uu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Ke("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.uu=!1,r))));return this.iu=n,n}enqueueAfterDelay(e,n,r){this.Pu(),this.lu.indexOf(e)>-1&&(n=0);let i=Yc.createAndSchedule(this,e,n,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&A()}verifyOperationInProgress(){}du(){return h(this,null,function*(){let e;do e=this.iu,yield e;while(e!==this.iu)})}Au(e){for(let n of this._u)if(n.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(let n of this._u)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){let n=this._u.indexOf(e);this._u.splice(n,1)}};function Vf(t){return function(n,r){if(typeof n!="object"||n===null)return!1;let i=n;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(t,["next","error","complete"])}var Dn=class extends Cn{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=function(){return new lu}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||xp(this),this._firestoreClient.terminate()}};function Vp(t,e){let n=typeof t=="object"?t:rn(),r=typeof t=="string"?t:e||"(default)",i=Zn(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=lh("firestore");s&&Pp(i,...s)}return i}function Op(t){return t._firestoreClient||xp(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function xp(t){var e,n,r;let i=t._freezeSettings(),s=function(a,c,u,l){return new Ka(a,c,u,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Dp(l.experimentalLongPollingOptions),l.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new uu(t._authCredentials,t._appCheckCredentials,t._queue,s),!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}var Fr=class t{constructor(e){this._byteString=e}static fromBase64String(e){try{return new t(ue.fromBase64String(e))}catch(n){throw new y(p.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new t(ue.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Lr=class{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new y(p.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Ts=class{constructor(e){this._methodName=e}};var Ur=class{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new y(p.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new y(p.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return V(this._lat,e._lat)||V(this._long,e._long)}};var lI=/^__.*__$/,hu=class{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Ye(e,this.data,this.fieldMask,n,this.fieldTransforms):new qt(e,this.data,n,this.fieldTransforms)}};function Mp(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw A()}}var du=class t{constructor(e,n,r,i,s,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var n;let r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.gu({path:r,yu:!1});return i.wu(e),i}Su(e){var n;let r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return As(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(e.length===0)throw this.Du("Document fields must not be empty");if(Mp(this.fu)&&lI.test(e))throw this.Du('Document fields cannot begin and end with "__"')}},fu=class{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||ks(e)}Fu(e,n,r,i=!1){return new du({fu:e,methodName:n,vu:r,path:fe.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Fp(t){let e=t._freezeSettings(),n=ks(t._databaseId);return new fu(t._databaseId,!!e.ignoreUndefinedProperties,n)}function hI(t,e,n,r,i,s={}){let o=t.Fu(s.merge||s.mergeFields?2:0,e,n,i);Bp("Data must be an object, but it was:",o,r);let a=Lp(r,o),c,u;if(s.merge)c=new Oe(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let d of s.mergeFields){let f=fI(e,d,n);if(!o.contains(f))throw new y(p.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);mI(l,f)||l.push(f)}c=new Oe(l),u=o.fieldTransforms.filter(d=>c.covers(d.field))}else c=null,u=o.fieldTransforms;return new hu(new Te(a),c,u)}function dI(t,e,n,r=!1){return xu(n,t.Fu(r?4:3,e))}function xu(t,e){if(Up(t=Z(t)))return Bp("Unsupported field value:",e,t),Lp(t,e);if(t instanceof Ts)return function(r,i){if(!Mp(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.yu&&e.fu!==4)throw e.Du("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let c=xu(a,i.bu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(t,e)}return function(r,i){if((r=Z(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Xy(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=ne.fromDate(r);return{timestampValue:ls(i.serializer,s)}}if(r instanceof ne){let s=new ne(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ls(i.serializer,s)}}if(r instanceof Ur)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Fr)return{bytesValue:op(i.serializer,r._byteString)};if(r instanceof pe){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Cu(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${xs(r)}`)}(t,e)}function Lp(t,e){let n={};return Ff(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Pn(t,(r,i)=>{let s=xu(i,e.pu(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function Up(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof ne||t instanceof Ur||t instanceof Fr||t instanceof pe||t instanceof Ts)}function Bp(t,e,n){if(!Up(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){let r=xs(n);throw r==="an object"?e.Du(t+" a custom object"):e.Du(t+" "+r)}}function fI(t,e,n){if((e=Z(e))instanceof Lr)return e._internalPath;if(typeof e=="string")return qp(t,e);throw As("Field path arguments must be of type string or ",t,!1,void 0,n)}var pI=new RegExp("[~\\*/\\[\\]]");function qp(t,e,n){if(e.search(pI)>=0)throw As(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Lr(...e.split("."))._internalPath}catch{throw As(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function As(t,e,n,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new y(p.INVALID_ARGUMENT,a+t+c)}function mI(t,e){return t.some(n=>n.isEqual(e))}var Ss=class{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new pu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let n=this._document.data.field(Mu("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}},pu=class extends Ss{data(){return super.data()}};function Mu(t,e){return typeof e=="string"?qp(t,e):e instanceof Lr?e._internalPath:e._delegate._internalPath}function gI(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new y(p.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Br=class{},bs=class extends Br{};function $p(t,e,...n){let r=[];e instanceof Br&&r.push(e),r=r.concat(n),function(s){let o=s.filter(c=>c instanceof gu).length,a=s.filter(c=>c instanceof mu).length;if(o>1||o>0&&a>0)throw new y(p.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)t=i._apply(t);return t}var mu=class t extends bs{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new t(e,n,r)}_apply(e){let n=this._parse(e);return Gp(e._query,n),new $t(e.firestore,e.converter,ac(e._query,n))}_parse(e){let n=Fp(e.firestore);return function(s,o,a,c,u,l,d){let f;if(u.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(p.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){xf(d,l);let m=[];for(let T of d)m.push(Of(c,s,T));f={arrayValue:{values:m}}}else f=Of(c,s,d)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||xf(d,l),f=dI(a,o,d,l==="in"||l==="not-in");return z.create(u,l,f)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}};var gu=class t extends Br{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new t(e,n)}_parse(e){let n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Se.create(n,this._getOperator())}_apply(e){let n=this._parse(e);return n.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let c of a)Gp(o,c),o=ac(o,c)}(e._query,n),new $t(e.firestore,e.converter,ac(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var _u=class t extends bs{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new t(e,n)}_apply(e){let n=function(i,s,o){if(i.startAt!==null)throw new y(p.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new y(p.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Lt(s,o)}(e._query,this._field,this._direction);return new $t(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new pt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,n))}};function jp(t,e="asc"){let n=e,r=Mu("orderBy",t);return _u._create(r,n)}function Of(t,e,n){if(typeof(n=Z(n))=="string"){if(n==="")throw new y(p.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!zf(e)&&n.indexOf("/")!==-1)throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=e.path.child(L.fromString(n));if(!E.isDocumentKey(r))throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return of(t,new E(r))}if(n instanceof pe)return of(t,n._key);throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${xs(n)}.`)}function xf(t,e){if(!Array.isArray(t)||t.length===0)throw new y(p.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Gp(t,e){let n=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new y(p.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new y(p.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}var yu=class{convertValue(e,n="none"){switch(Ft(e)){case 0:return null;case 1:return e.booleanValue;case 2:return B(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ft(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw A()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){let r={};return Pn(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertGeoPoint(e){return new Ur(B(e.latitude),B(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":let r=wu(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Nr(e));default:return null}}convertTimestamp(e){let n=Qe(e);return new ne(n.seconds,n.nanos)}convertDocumentKey(e,n){let r=L.fromString(e);x(dp(r));let i=new rs(r.get(1),r.get(3)),s=new E(r.popFirst(5));return i.isEqual(n)||Ke(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}};function _I(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}var Vt=class{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Cs=class extends Ss{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let n=new gn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){let r=this._document.data.field(Mu("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}},gn=class extends Cs{data(e={}){return super.data(e)}},vu=class{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Vt(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new gn(this._firestore,this._userDataWriter,r.key,r,new Vt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new y(p.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let c=new gn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Vt(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new gn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Vt(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),u=-1,l=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:yI(a.type),doc:c,oldIndex:u,newIndex:l}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}};function yI(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return A()}}var Ds=class extends yu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Fr(e)}convertReference(e){let n=this.convertDocumentKey(e,this.firestore._databaseId);return new pe(this.firestore,null,n)}};function zp(t,e){let n=Rr(t.firestore,Dn),r=kp(t),i=_I(t.converter,e);return vI(n,[hI(Fp(t.firestore),"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,Ot.exists(!1))]).then(()=>r)}function Fu(t,...e){var n,r,i;t=Z(t);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Vf(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Vf(e[o])){let d=e[o];e[o]=(n=d.next)===null||n===void 0?void 0:n.bind(d),e[o+1]=(r=d.error)===null||r===void 0?void 0:r.bind(d),e[o+2]=(i=d.complete)===null||i===void 0?void 0:i.bind(d)}let c,u,l;if(t instanceof pe)u=Rr(t.firestore,Dn),l=bu(t._key.path),c={next:d=>{e[o]&&e[o](II(u,t,d))},error:e[o+1],complete:e[o+2]};else{let d=Rr(t,$t);u=Rr(d.firestore,Dn),l=d._query;let f=new Ds(u);c={next:m=>{e[o]&&e[o](new vu(u,f,d,m))},error:e[o+1],complete:e[o+2]},gI(t._query)}return function(f,m,T,S){let I=new cu(S),k=new tu(m,I,T);return f.asyncQueue.enqueueAndForget(()=>h(this,null,function*(){return jv(yield Rf(f),k)})),()=>{I.$a(),f.asyncQueue.enqueueAndForget(()=>h(this,null,function*(){return Gv(yield Rf(f),k)}))}}(Op(u),l,a,c)}function vI(t,e){return function(r,i){let s=new He;return r.asyncQueue.enqueueAndForget(()=>h(this,null,function*(){return Xv(yield cI(r),i,s)})),s.promise}(Op(t),e)}function II(t,e,n){let r=n.docs.get(e._key),i=new Ds(t);return new Cs(t,i,e._key,r,new Vt(n.hasPendingWrites,n.fromCache),e.converter)}(function(e,n=!0){(function(i){Rn=i})(ut),ct(new _e("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new Dn(new qa(r.getProvider("auth-internal")),new za(r.getProvider("app-check-internal")),function(u,l){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new y(p.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rs(u.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:n},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),H(nf,"4.6.1",e),H(nf,"4.6.1","esm2017")})();var EI="firebase",wI="10.11.1";H(EI,wI,"app");var zt=new mo("ANGULARFIRE2_VERSION");function Fs(t,e,n){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===n);if(s.length===1)return s[0]}return n.container.getProvider(t).getImmediate({optional:!0})}var zr=(t,e)=>{let n=e?[e]:yi(),r=[];return n.forEach(i=>{i.container.getProvider(t).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Vn=class{constructor(){return zr(TI)}},TI="app-check";function kn(){}var Ms=class{zone;delegate;constructor(e,n=Rl){this.zone=e,this.delegate=n}now(){return this.delegate.now()}schedule(e,n,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,n,r)}},Lu=class{zone;task=null;constructor(e){this.zone=e}call(e,n){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",kn,{},kn,kn)),n.pipe(Nl({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},On=(()=>{class t{ngZone;outsideAngular;insideAngular;constructor(n){this.ngZone=n,this.outsideAngular=n.runOutsideAngular(()=>new Ms(Zone.current)),this.insideAngular=n.run(()=>new Ms(Zone.current,Dl)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||t)(Yt(st))};static \u0275prov=$n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Ls(){let t=globalThis.\u0275AngularFireScheduler;if(!t)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return t}function AI(t){return Ls().ngZone.runOutsideAngular(()=>t())}function Gt(t){return Ls().ngZone.run(()=>t())}function SI(t){return bI(Ls())(t)}function bI(t){return function(n){return n=n.lift(new Lu(t.ngZone)),n.pipe(co(t.outsideAngular),ao(t.insideAngular))}}var CI=(t,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Gt(()=>t.apply(void 0,r))},le=(t,e)=>function(){let n,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(n||=Gt(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",kn,{},kn,kn))),r[s]=CI(r[s],n));let i=AI(()=>t.apply(this,r));if(!e)if(i instanceof Bn){let s=Ls();return i.pipe(co(s.outsideAngular),ao(s.insideAngular))}else return Gt(()=>i);return i instanceof Bn?i.pipe(SI):i instanceof Promise?Gt(()=>new Promise((s,o)=>i.then(a=>Gt(()=>s(a)),a=>Gt(()=>o(a))))):typeof i=="function"&&n?function(){return setTimeout(()=>{n&&n.state==="scheduled"&&n.invoke()},10),i.apply(this,arguments)}:Gt(()=>i)};var Xe=class{constructor(e){return e}},Wt=class{constructor(){return yi()}};function DI(t){return t&&t.length===1?t[0]:new Xe(rn())}var Uu=new me("angularfire2._apps"),RI={provide:Xe,useFactory:DI,deps:[[new ge,Uu]]},PI={provide:Wt,deps:[[new ge,Uu]]};function NI(t){return(e,n)=>{let r=e.runOutsideAngular(()=>t(n));return new Xe(r)}}var kI=(()=>{class t{constructor(n){H("angularfire",zt.full,"core"),H("angularfire",zt.full,"app"),H("angular",xl.full,n.toString())}static \u0275fac=function(r){return new(r||t)(Yt(Ol))};static \u0275mod=$e({type:t});static \u0275inj=qe({providers:[RI,PI]})}return t})();function t0(t,...e){return{ngModule:kI,providers:[{provide:Uu,useFactory:NI(t),multi:!0,deps:[st,Et,On,...e]}]}}var n0=le(Go,!0);function cm(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var um=cm,lm=new Ge("auth","Firebase",cm());var Gs=new ot("@firebase/auth");function VI(t,...e){Gs.logLevel<=R.WARN&&Gs.warn(`Auth (${ut}): ${t}`,...e)}function Bs(t,...e){Gs.logLevel<=R.ERROR&&Gs.error(`Auth (${ut}): ${t}`,...e)}function Ie(t,...e){throw ol(t,...e)}function be(t,...e){return ol(t,...e)}function sl(t,e,n){let r=Object.assign(Object.assign({},um()),{[e]:n});return new Ge("auth","Firebase",r).create(e,{appName:t.name})}function tt(t){return sl(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function OI(t,e,n){let r=n;if(!(e instanceof r))throw r.name!==e.constructor.name&&Ie(t,"argument-error"),sl(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ol(t,...e){if(typeof t!="string"){let n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return lm.create(t,...e)}function w(t,e,...n){if(!t)throw ol(e,...n)}function Ze(t){let e="INTERNAL ASSERTION FAILED: "+t;throw Bs(e),new Error(e)}function nt(t,e){t||Ze(e)}function $u(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function xI(){return Wp()==="http:"||Wp()==="https:"}function Wp(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}function MI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(xI()||fh()||"connection"in navigator)?navigator.onLine:!0}function FI(){if(typeof navigator>"u")return null;let t=navigator;return t.languages&&t.languages[0]||t.language||null}var Ht=class{constructor(e,n){this.shortDelay=e,this.longDelay=n,nt(n>e,"Short delay should be less than long delay!"),this.isMobile=dh()||ph()}get(){return MI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function al(t,e){nt(t.emulator,"Emulator should always be set here");let{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}var zs=class{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ze("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ze("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ze("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var LI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var UI=new Ht(3e4,6e4);function yt(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}function vt(s,o,a,c){return h(this,arguments,function*(t,e,n,r,i={}){return hm(t,i,()=>h(this,null,function*(){let u={},l={};r&&(e==="GET"?l=r:u={body:JSON.stringify(r)});let d=en(Object.assign({key:t.config.apiKey},l)).slice(1),f=yield t._getAdditionalHeaders();return f["Content-Type"]="application/json",t.languageCode&&(f["X-Firebase-Locale"]=t.languageCode),zs.fetch()(dm(t,t.config.apiHost,n,d),Object.assign({method:e,headers:f,referrerPolicy:"no-referrer"},u))}))})}function hm(t,e,n){return h(this,null,function*(){t._canInitEmulator=!1;let r=Object.assign(Object.assign({},LI),e);try{let i=new ju(t),s=yield Promise.race([n(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw Us(t,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Us(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Us(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw Us(t,"user-disabled",o);let l=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw sl(t,l,u);Ie(t,l)}}catch(i){if(i instanceof he)throw i;Ie(t,"network-request-failed",{message:String(i)})}})}function Zr(s,o,a,c){return h(this,arguments,function*(t,e,n,r,i={}){let u=yield vt(t,e,n,r,i);return"mfaPendingCredential"in u&&Ie(t,"multi-factor-auth-required",{_serverResponse:u}),u})}function dm(t,e,n,r){let i=`${e}${n}?${r}`;return t.config.emulator?al(t.config,i):`${t.config.apiScheme}://${i}`}function BI(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var ju=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(be(this.auth,"network-request-failed")),UI.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function Us(t,e,n){let r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=be(t,e,r);return i.customData._tokenResponse=n,i}function Hp(t){return t!==void 0&&t.enterprise!==void 0}var Gu=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return BI(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}};function qI(t,e){return h(this,null,function*(){return vt(t,"GET","/v2/recaptchaConfig",yt(t,e))})}function $I(t,e){return h(this,null,function*(){return vt(t,"POST","/v1/accounts:delete",e)})}function fm(t,e){return h(this,null,function*(){return vt(t,"POST","/v1/accounts:lookup",e)})}function Wr(t){if(t)try{let e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function cl(t,e=!1){return h(this,null,function*(){let n=Z(t),r=yield n.getIdToken(e),i=ul(r);w(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:Wr(Bu(i.auth_time)),issuedAtTime:Wr(Bu(i.iat)),expirationTime:Wr(Bu(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function Bu(t){return Number(t)*1e3}function ul(t){let[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Bs("JWT malformed, contained fewer than 3 sections"),null;try{let i=So(n);return i?JSON.parse(i):(Bs("Failed to decode base64 JWT payload"),null)}catch(i){return Bs("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Kp(t){let e=ul(t);return w(e,"internal-error"),w(typeof e.exp<"u","internal-error"),w(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Kr(t,e,n=!1){return h(this,null,function*(){if(n)return e;try{return yield e}catch(r){throw r instanceof he&&jI(r)&&t.auth.currentUser===t&&(yield t.auth.signOut()),r}})}function jI({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}var zu=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let n=this.getInterval(e);this.timerId=setTimeout(()=>h(this,null,function*(){yield this.iteration()}),n)}iteration(){return h(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Qr=class{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wr(this.lastLoginAt),this.creationTime=Wr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Ws(t){return h(this,null,function*(){var e;let n=t.auth,r=yield t.getIdToken(),i=yield Kr(t,fm(n,{idToken:r}));w(i?.users.length,n,"internal-error");let s=i.users[0];t._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?pm(s.providerUserInfo):[],a=GI(t.providerData,o),c=t.isAnonymous,u=!(t.email&&s.passwordHash)&&!a?.length,l=c?u:!1,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Qr(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(t,d)})}function ll(t){return h(this,null,function*(){let e=Z(t);yield Ws(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function GI(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function pm(t){return t.map(e=>{var{providerId:n}=e,r=ri(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function zI(t,e){return h(this,null,function*(){let n=yield hm(t,{},()=>h(this,null,function*(){let r=en({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,o=dm(t,i,"/v1/token",`key=${s}`),a=yield t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",zs.fetch()(o,{method:"POST",headers:a,body:r})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}})}function WI(t,e){return h(this,null,function*(){return vt(t,"POST","/v2/accounts:revokeToken",yt(t,e))})}var Hr=class t{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){w(e.idToken,"internal-error"),w(typeof e.idToken<"u","internal-error"),w(typeof e.refreshToken<"u","internal-error");let n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Kp(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){w(e.length!==0,"internal-error");let n=Kp(e);this.updateTokensAndExpiration(e,null,n)}getToken(e,n=!1){return h(this,null,function*(){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(w(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,n){return h(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield zI(e,n);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){let{refreshToken:r,accessToken:i,expirationTime:s}=n,o=new t;return r&&(w(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(w(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(w(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new t,this.toJSON())}_performRefresh(){return Ze("not implemented")}};function _t(t,e){w(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}var Mn=class t{constructor(e){var{uid:n,auth:r,stsTokenManager:i}=e,s=ri(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new zu(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Qr(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return h(this,null,function*(){let n=yield Kr(this,this.stsTokenManager.getToken(this.auth,e));return w(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n})}getIdTokenResult(e){return cl(this,e)}reload(){return ll(this)}_assign(e){this!==e&&(w(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let n=new t(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){w(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,n=!1){return h(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&(yield Ws(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return h(this,null,function*(){if(ye(this.auth.app))return Promise.reject(tt(this.auth));let e=yield this.getIdToken();return yield Kr(this,$I(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,i,s,o,a,c,u,l;let d=(r=n.displayName)!==null&&r!==void 0?r:void 0,f=(i=n.email)!==null&&i!==void 0?i:void 0,m=(s=n.phoneNumber)!==null&&s!==void 0?s:void 0,T=(o=n.photoURL)!==null&&o!==void 0?o:void 0,S=(a=n.tenantId)!==null&&a!==void 0?a:void 0,I=(c=n._redirectEventId)!==null&&c!==void 0?c:void 0,k=(u=n.createdAt)!==null&&u!==void 0?u:void 0,F=(l=n.lastLoginAt)!==null&&l!==void 0?l:void 0,{uid:$,emailVerified:re,isAnonymous:Ce,providerData:K,stsTokenManager:Be}=n;w($&&Be,e,"internal-error");let Jt=Hr.fromJSON(this.name,Be);w(typeof $=="string",e,"internal-error"),_t(d,e.name),_t(f,e.name),w(typeof re=="boolean",e,"internal-error"),w(typeof Ce=="boolean",e,"internal-error"),_t(m,e.name),_t(T,e.name),_t(S,e.name),_t(I,e.name),_t(k,e.name),_t(F,e.name);let Un=new t({uid:$,auth:e,email:f,emailVerified:re,displayName:d,isAnonymous:Ce,photoURL:T,phoneNumber:m,tenantId:S,stsTokenManager:Jt,createdAt:k,lastLoginAt:F});return K&&Array.isArray(K)&&(Un.providerData=K.map(ni=>Object.assign({},ni))),I&&(Un._redirectEventId=I),Un}static _fromIdTokenResponse(e,n,r=!1){return h(this,null,function*(){let i=new Hr;i.updateFromServerResponse(n);let s=new t({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Ws(s),s})}static _fromGetAccountInfoResponse(e,n,r){return h(this,null,function*(){let i=n.users[0];w(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?pm(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,a=new Hr;a.updateFromIdToken(r);let c=new t({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Qr(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(c,u),c})}};var Qp=new Map;function et(t){nt(t instanceof Function,"Expected a class definition");let e=Qp.get(t);return e?(nt(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Qp.set(t,e),e)}var HI=(()=>{class t{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return h(this,null,function*(){return!0})}_set(n,r){return h(this,null,function*(){this.storage[n]=r})}_get(n){return h(this,null,function*(){let r=this.storage[n];return r===void 0?null:r})}_remove(n){return h(this,null,function*(){delete this.storage[n]})}_addListener(n,r){}_removeListener(n,r){}}return t.type="NONE",t})(),Wu=HI;function qs(t,e,n){return`firebase:${t}:${e}:${n}`}var Hs=class t{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=qs(this.userKey,i.apiKey,s),this.fullPersistenceKey=qs("persistence",i.apiKey,s),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return h(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?Mn._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return h(this,null,function*(){if(this.persistence===e)return;let n=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,n,r="authUser"){return h(this,null,function*(){if(!n.length)return new t(et(Wu),e,r);let i=(yield Promise.all(n.map(u=>h(this,null,function*(){if(yield u._isAvailable())return u})))).filter(u=>u),s=i[0]||et(Wu),o=qs(r,e.config.apiKey,e.name),a=null;for(let u of n)try{let l=yield u._get(o);if(l){let d=Mn._fromJSON(e,l);u!==s&&(a=d),s=u;break}}catch{}let c=i.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new t(s,e,r):(s=c[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(n.map(u=>h(this,null,function*(){if(u!==s)try{yield u._remove(o)}catch{}}))),new t(s,e,r))})}};function Jp(t){let e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(_m(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(mm(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(vm(e))return"Blackberry";if(Im(e))return"Webos";if(hl(e))return"Safari";if((e.includes("chrome/")||gm(e))&&!e.includes("edge/"))return"Chrome";if(ym(e))return"Android";{let n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function mm(t=W()){return/firefox\//i.test(t)}function hl(t=W()){let e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function gm(t=W()){return/crios\//i.test(t)}function _m(t=W()){return/iemobile/i.test(t)}function ym(t=W()){return/android/i.test(t)}function vm(t=W()){return/blackberry/i.test(t)}function Im(t=W()){return/webos/i.test(t)}function ro(t=W()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function KI(t=W()){var e;return ro(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function QI(){return mh()&&document.documentMode===10}function Em(t=W()){return ro(t)||ym(t)||Im(t)||vm(t)||/windows phone/i.test(t)||_m(t)}function JI(){try{return!!(window&&window!==window.top)}catch{return!1}}function wm(t,e=[]){let n;switch(t){case"Browser":n=Jp(W());break;case"Worker":n=`${Jp(W())}-${t}`;break;default:n=t}let r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${ut}/${r}`}var Hu=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){let r=s=>new Promise((o,a)=>{try{let c=e(s);o(c)}catch(c){a(c)}});r.onAbort=n,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return h(this,null,function*(){if(this.auth.currentUser===e)return;let n=[];try{for(let r of this.queue)yield r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(let i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function YI(n){return h(this,arguments,function*(t,e={}){return vt(t,"GET","/v2/passwordPolicy",yt(t,e))})}var XI=6,Ku=class{constructor(e){var n,r,i,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:XI,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,i,s,o,a;let c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(n=c.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(s=c.containsUppercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,n){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var Qu=class{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ks(this),this.idTokenSubscription=new Ks(this),this.beforeStateQueue=new Hu(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=lm,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=et(n)),this._initializationPromise=this.queue(()=>h(this,null,function*(){var r,i;if(!this._deleted&&(this.persistenceManager=yield Hs.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return h(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return h(this,null,function*(){try{let n=yield fm(this,{idToken:e}),r=yield Mn._fromGetAccountInfoResponse(this,n,e);yield this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return h(this,null,function*(){var n;if(ye(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=i?._redirectEventId,c=yield this.tryRedirectSignIn(e);(!o||o===a)&&c?.user&&(i=c.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return w(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return h(this,null,function*(){let n=null;try{n=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return n})}reloadAndSetCurrentUserOrClear(e){return h(this,null,function*(){try{yield Ws(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=FI()}_delete(){return h(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return h(this,null,function*(){if(ye(this.app))return Promise.reject(tt(this));let n=e?Z(e):null;return n&&w(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))})}_updateCurrentUser(e,n=!1){return h(this,null,function*(){if(!this._deleted)return e&&w(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>h(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return h(this,null,function*(){return ye(this.app)?Promise.reject(tt(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return ye(this.app)?Promise.reject(tt(this)):this.queue(()=>h(this,null,function*(){yield this.assertedPersistence.setPersistence(et(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return h(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return h(this,null,function*(){let e=yield YI(this),n=new Ku(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ge("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},n)}})}revokeAccessToken(e){return h(this,null,function*(){if(this.currentUser){let n=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),yield WI(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,n){return h(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return h(this,null,function*(){if(!this.redirectPersistenceManager){let n=e&&et(e)||this._popupRedirectResolver;w(n,this,"argument-error"),this.redirectPersistenceManager=yield Hs.create(this,[et(n._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return h(this,null,function*(){var n,r;return this._isInitialized&&(yield this.queue(()=>h(this,null,function*(){}))),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return h(this,null,function*(){if(e===this.currentUser)return this.queue(()=>h(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};let s=typeof n=="function"?n:n.next.bind(n),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(w(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof n=="function"){let c=e.addObserver(n,r,i);return()=>{o=!0,c()}}else{let c=e.addObserver(n);return()=>{o=!0,c()}}}directlySetCurrentUser(e){return h(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return w(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=wm(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return h(this,null,function*(){var e;let n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(n["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n})}_getAppCheckToken(){return h(this,null,function*(){var e;let n=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return n?.error&&VI(`Error while retrieving App Check token: ${n.error}`),n?.token})}};function It(t){return Z(t)}var Ks=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=vh(n=>this.observer=n)}get next(){return w(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var io={loadJS(){return h(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ZI(t){io=t}function Tm(t){return io.loadJS(t)}function eE(){return io.recaptchaEnterpriseScript}function tE(){return io.gapiScript}function Am(t){return`__${t}${Math.floor(Math.random()*1e6)}`}var nE="recaptcha-enterprise",rE="NO_RECAPTCHA",Ju=class{constructor(e){this.type=nE,this.auth=It(e)}verify(e="verify",n=!1){return h(this,null,function*(){function r(s){return h(this,null,function*(){if(!n){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((o,a)=>h(this,null,function*(){qI(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{let u=new Gu(c);return s.tenantId==null?s._agentRecaptchaConfig=u:s._tenantRecaptchaConfigs[s.tenantId]=u,o(u.siteKey)}}).catch(c=>{a(c)})}))})}function i(s,o,a){let c=window.grecaptcha;Hp(c)?c.enterprise.ready(()=>{c.enterprise.execute(s,{action:e}).then(u=>{o(u)}).catch(()=>{o(rE)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((s,o)=>{r(this.auth).then(a=>{if(!n&&Hp(window.grecaptcha))i(a,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=eE();c.length!==0&&(c+=a),Tm(c).then(()=>{i(a,s,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})})}};function Yp(t,e,n,r=!1){return h(this,null,function*(){let i=new Ju(t),s;try{s=yield i.verify(n)}catch{s=yield i.verify(n,!0)}let o=Object.assign({},e);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o})}function Yu(t,e,n,r){return h(this,null,function*(){var i;if(!((i=t._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let s=yield Yp(t,e,n,n==="getOobCode");return r(t,s)}else return r(t,e).catch(s=>h(this,null,function*(){if(s.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let o=yield Yp(t,e,n,n==="getOobCode");return r(t,o)}else return Promise.reject(s)}))})}function dl(t,e){let n=Zn(t,"auth");if(n.isInitialized()){let i=n.getImmediate(),s=n.getOptions();if(Tt(s,e??{}))return i;Ie(i,"already-initialized")}return n.initialize({options:e})}function iE(t,e){let n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(et);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function fl(t,e,n){let r=It(t);w(r._canInitEmulator,r,"emulator-config-failed"),w(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!n?.disableWarnings,s=Sm(e),{host:o,port:a}=sE(e),c=a===null?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||oE()}function Sm(t){let e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function sE(t){let e=Sm(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};let r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:Xp(r.substr(s.length+1))}}else{let[s,o]=r.split(":");return{host:s,port:Xp(o)}}}function Xp(t){if(!t)return null;let e=Number(t);return isNaN(e)?null:e}function oE(){function t(){let e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}var Fn=class{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Ze("not implemented")}_getIdTokenResponse(e){return Ze("not implemented")}_linkToIdToken(e,n){return Ze("not implemented")}_getReauthenticationResolver(e){return Ze("not implemented")}};function aE(t,e){return h(this,null,function*(){return vt(t,"POST","/v1/accounts:signUp",e)})}function cE(t,e){return h(this,null,function*(){return Zr(t,"POST","/v1/accounts:signInWithPassword",yt(t,e))})}function uE(t,e){return h(this,null,function*(){return Zr(t,"POST","/v1/accounts:signInWithEmailLink",yt(t,e))})}function lE(t,e){return h(this,null,function*(){return Zr(t,"POST","/v1/accounts:signInWithEmailLink",yt(t,e))})}var Jr=class t extends Fn{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new t(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new t(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}_getIdTokenResponse(e){return h(this,null,function*(){switch(this.signInMethod){case"password":let n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Yu(e,n,"signInWithPassword",cE);case"emailLink":return uE(e,{email:this._email,oobCode:this._password});default:Ie(e,"internal-error")}})}_linkToIdToken(e,n){return h(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Yu(e,r,"signUpPassword",aE);case"emailLink":return lE(e,{idToken:n,email:this._email,oobCode:this._password});default:Ie(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function xn(t,e){return h(this,null,function*(){return Zr(t,"POST","/v1/accounts:signInWithIdp",yt(t,e))})}var hE="http://localhost",Qs=class t extends Fn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let n=new t(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Ie("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=n,s=ri(n,["providerId","signInMethod"]);if(!r||!i)return null;let o=new t(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){let n=this.buildRequest();return xn(e,n)}_linkToIdToken(e,n){let r=this.buildRequest();return r.idToken=n,xn(e,r)}_getReauthenticationResolver(e){let n=this.buildRequest();return n.autoCreate=!1,xn(e,n)}buildRequest(){let e={requestUri:hE,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=en(n)}return e}};function dE(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function fE(t){let e=tn(nn(t)).link,n=e?tn(nn(e)).deep_link_id:null,r=tn(nn(t)).deep_link_id;return(r?tn(nn(r)).link:null)||r||n||e||t}var Js=class t{constructor(e){var n,r,i,s,o,a;let c=tn(nn(e)),u=(n=c.apiKey)!==null&&n!==void 0?n:null,l=(r=c.oobCode)!==null&&r!==void 0?r:null,d=dE((i=c.mode)!==null&&i!==void 0?i:null);w(u&&l&&d,"argument-error"),this.apiKey=u,this.operation=d,this.code=l,this.continueUrl=(s=c.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=c.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){let n=fE(e);try{return new t(n)}catch{return null}}};var bm=(()=>{class t{constructor(){this.providerId=t.PROVIDER_ID}static credential(n,r){return Jr._fromEmailAndPassword(n,r)}static credentialWithLink(n,r){let i=Js.parseLink(r);return w(i,"argument-error"),Jr._fromEmailAndCode(n,i.code,i.tenantId)}}t.PROVIDER_ID="password",t.EMAIL_PASSWORD_SIGN_IN_METHOD="password",t.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return t})(),Yr=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var Ys=class extends Yr{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var pl=(()=>{class t extends Ys{constructor(){super("google.com"),this.addScope("profile")}static credential(n,r){return Qs._fromParams({providerId:t.PROVIDER_ID,signInMethod:t.GOOGLE_SIGN_IN_METHOD,idToken:n,accessToken:r})}static credentialFromResult(n){return t.credentialFromTaggedObject(n)}static credentialFromError(n){return t.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;let{oauthIdToken:r,oauthAccessToken:i}=n;if(!r&&!i)return null;try{return t.credential(r,i)}catch{return null}}}t.GOOGLE_SIGN_IN_METHOD="google.com",t.PROVIDER_ID="google.com";return t})();function pE(t,e){return h(this,null,function*(){return Zr(t,"POST","/v1/accounts:signUp",yt(t,e))})}var Ln=class t{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,n,r,i=!1){return h(this,null,function*(){let s=yield Mn._fromIdTokenResponse(e,r,i),o=Zp(r);return new t({user:s,providerId:o,_tokenResponse:r,operationType:n})})}static _forOperation(e,n,r){return h(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=Zp(r);return new t({user:e,providerId:i,_tokenResponse:r,operationType:n})})}};function Zp(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}var Xu=class t extends he{constructor(e,n,r,i){var s;super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,t.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new t(e,n,r,i)}};function Cm(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Xu._fromErrorAndOperation(t,s,e,r):s})}function mE(t,e,n=!1){return h(this,null,function*(){let r=yield Kr(t,e._linkToIdToken(t.auth,yield t.getIdToken()),n);return Ln._forOperation(t,"link",r)})}function gE(t,e,n=!1){return h(this,null,function*(){let{auth:r}=t;if(ye(r.app))return Promise.reject(tt(r));let i="reauthenticate";try{let s=yield Kr(t,Cm(r,i,e,t),n);w(s.idToken,r,"internal-error");let o=ul(s.idToken);w(o,r,"internal-error");let{sub:a}=o;return w(t.uid===a,r,"user-mismatch"),Ln._forOperation(t,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&Ie(r,"user-mismatch"),s}})}function Dm(t,e,n=!1){return h(this,null,function*(){if(ye(t.app))return Promise.reject(tt(t));let r="signIn",i=yield Cm(t,r,e),s=yield Ln._fromIdTokenResponse(t,r,i);return n||(yield t._updateCurrentUser(s.user)),s})}function ml(t,e){return h(this,null,function*(){return Dm(It(t),e)})}function Rm(t){return h(this,null,function*(){let e=It(t);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function gl(t,e,n){return h(this,null,function*(){if(ye(t.app))return Promise.reject(tt(t));let r=It(t),o=yield Yu(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",pE).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&Rm(t),c}),a=yield Ln._fromIdTokenResponse(r,"signIn",o);return yield r._updateCurrentUser(a.user),a})}function _l(t,e,n){return ye(t.app)?Promise.reject(tt(t)):ml(Z(t),bm.credential(e,n)).catch(r=>h(this,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&Rm(t),r}))}function yl(t,e,n,r){return Z(t).onIdTokenChanged(e,n,r)}function vl(t,e,n){return Z(t).beforeAuthStateChanged(e,n)}function Il(t){return Z(t).signOut()}var Xs="__sak";var Zs=class{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Xs,"1"),this.storage.removeItem(Xs),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){let n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};function _E(){let t=W();return hl(t)||ro(t)}var yE=1e3,vE=10,IE=(()=>{class t extends Zs{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(n,r)=>this.onStorageEvent(n,r),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=_E()&&JI(),this.fallbackToPolling=Em(),this._shouldAllowMigration=!0}forAllChangedKeys(n){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&n(r,s,i)}}onStorageEvent(n,r=!1){if(!n.key){this.forAllChangedKeys((a,c,u)=>{this.notifyListeners(a,u)});return}let i=n.key;if(r?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){let a=this.storage.getItem(i);if(n.newValue!==a)n.newValue!==null?this.storage.setItem(i,n.newValue):this.storage.removeItem(i);else if(this.localCache[i]===n.newValue&&!r)return}let s=()=>{let a=this.storage.getItem(i);!r&&this.localCache[i]===a||this.notifyListeners(i,a)},o=this.storage.getItem(i);QI()&&o!==n.newValue&&n.newValue!==n.oldValue?setTimeout(s,vE):s()}notifyListeners(n,r){this.localCache[n]=r;let i=this.listeners[n];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((n,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:n,oldValue:r,newValue:i}),!0)})},yE)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(n,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[n]||(this.listeners[n]=new Set,this.localCache[n]=this.storage.getItem(n)),this.listeners[n].add(r)}_removeListener(n,r){this.listeners[n]&&(this.listeners[n].delete(r),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(n,r){return h(this,null,function*(){yield it(t.prototype,this,"_set").call(this,n,r),this.localCache[n]=JSON.stringify(r)})}_get(n){return h(this,null,function*(){let r=yield it(t.prototype,this,"_get").call(this,n);return this.localCache[n]=JSON.stringify(r),r})}_remove(n){return h(this,null,function*(){yield it(t.prototype,this,"_remove").call(this,n),delete this.localCache[n]})}}return t.type="LOCAL",t})(),Pm=IE;var EE=(()=>{class t extends Zs{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(n,r){}_removeListener(n,r){}}return t.type="SESSION",t})(),El=EE;function wE(t){return Promise.all(t.map(e=>h(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(n){return{fulfilled:!1,reason:n}}})))}var TE=(()=>{class t{constructor(n){this.eventTarget=n,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(n){let r=this.receivers.find(s=>s.isListeningto(n));if(r)return r;let i=new t(n);return this.receivers.push(i),i}isListeningto(n){return this.eventTarget===n}handleEvent(n){return h(this,null,function*(){let r=n,{eventId:i,eventType:s,data:o}=r.data,a=this.handlersMap[s];if(!a?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let c=Array.from(a).map(l=>h(this,null,function*(){return l(r.origin,o)})),u=yield wE(c);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:u})})}_subscribe(n,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[n]||(this.handlersMap[n]=new Set),this.handlersMap[n].add(r)}_unsubscribe(n,r){this.handlersMap[n]&&r&&this.handlersMap[n].delete(r),(!r||this.handlersMap[n].size===0)&&delete this.handlersMap[n],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}t.receivers=[];return t})();function wl(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}var Zu=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,n,r=50){return h(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{let u=wl("",20);i.port1.start();let l=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(d){let f=d;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(l),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(f.data.response);break;default:clearTimeout(l),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function Ue(){return window}function AE(t){Ue().location.href=t}function Nm(){return typeof Ue().WorkerGlobalScope<"u"&&typeof Ue().importScripts=="function"}function SE(){return h(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function bE(){var t;return((t=navigator?.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function CE(){return Nm()?self:null}var km="firebaseLocalStorageDb",DE=1,eo="firebaseLocalStorage",Vm="fbase_key",Kt=class{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}};function so(t,e){return t.transaction([eo],e?"readwrite":"readonly").objectStore(eo)}function RE(){let t=indexedDB.deleteDatabase(km);return new Kt(t).toPromise()}function el(){let t=indexedDB.open(km,DE);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{let r=t.result;try{r.createObjectStore(eo,{keyPath:Vm})}catch(i){n(i)}}),t.addEventListener("success",()=>h(this,null,function*(){let r=t.result;r.objectStoreNames.contains(eo)?e(r):(r.close(),yield RE(),e(yield el()))}))})}function em(t,e,n){return h(this,null,function*(){let r=so(t,!0).put({[Vm]:e,value:n});return new Kt(r).toPromise()})}function PE(t,e){return h(this,null,function*(){let n=so(t,!1).get(e),r=yield new Kt(n).toPromise();return r===void 0?null:r.value})}function tm(t,e){let n=so(t,!0).delete(e);return new Kt(n).toPromise()}var NE=800,kE=3,VE=(()=>{class t{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return h(this,null,function*(){return this.db?this.db:(this.db=yield el(),this.db)})}_withRetries(n){return h(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield n(i)}catch(i){if(r++>kE)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return h(this,null,function*(){return Nm()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return h(this,null,function*(){this.receiver=TE._getInstance(CE()),this.receiver._subscribe("keyChanged",(n,r)=>h(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(n,r)=>h(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return h(this,null,function*(){var n,r;if(this.activeServiceWorker=yield SE(),!this.activeServiceWorker)return;this.sender=new Zu(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((n=i[0])===null||n===void 0)&&n.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(n){return h(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||bE()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:n},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return h(this,null,function*(){try{if(!indexedDB)return!1;let n=yield el();return yield em(n,Xs,"1"),yield tm(n,Xs),!0}catch{}return!1})}_withPendingWrite(n){return h(this,null,function*(){this.pendingWrites++;try{yield n()}finally{this.pendingWrites--}})}_set(n,r){return h(this,null,function*(){return this._withPendingWrite(()=>h(this,null,function*(){return yield this._withRetries(i=>em(i,n,r)),this.localCache[n]=r,this.notifyServiceWorker(n)}))})}_get(n){return h(this,null,function*(){let r=yield this._withRetries(i=>PE(i,n));return this.localCache[n]=r,r})}_remove(n){return h(this,null,function*(){return this._withPendingWrite(()=>h(this,null,function*(){return yield this._withRetries(r=>tm(r,n)),delete this.localCache[n],this.notifyServiceWorker(n)}))})}_poll(){return h(this,null,function*(){let n=yield this._withRetries(s=>{let o=so(s,!1).getAll();return new Kt(o).toPromise()});if(!n)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(n.length!==0)for(let{fbase_key:s,value:o}of n)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(n,r){this.localCache[n]=r;let i=this.listeners[n];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>h(this,null,function*(){return this._poll()}),NE)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(n,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[n]||(this.listeners[n]=new Set,this._get(n)),this.listeners[n].add(r)}_removeListener(n,r){this.listeners[n]&&(this.listeners[n].delete(r),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return t.type="LOCAL",t})(),Om=VE;var l0=Am("rcb"),h0=new Ht(3e4,6e4);function xm(t,e){return e?et(e):(w(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}var Xr=class extends Fn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return xn(e,this._buildIdpRequest())}_linkToIdToken(e,n){return xn(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return xn(e,this._buildIdpRequest())}_buildIdpRequest(e){let n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}};function OE(t){return Dm(t.auth,new Xr(t),t.bypassAuthState)}function xE(t){let{auth:e,user:n}=t;return w(n,e,"internal-error"),gE(n,new Xr(t),t.bypassAuthState)}function ME(t){return h(this,null,function*(){let{auth:e,user:n}=t;return w(n,e,"internal-error"),mE(n,new Xr(t),t.bypassAuthState)})}var to=class{constructor(e,n,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise((e,n)=>h(this,null,function*(){this.pendingPromise={resolve:e,reject:n};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return h(this,null,function*(){let{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}let c={auth:this.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(c))}catch(u){this.reject(u)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return OE;case"linkViaPopup":case"linkViaRedirect":return ME;case"reauthViaPopup":case"reauthViaRedirect":return xE;default:Ie(this.auth,"internal-error")}}resolve(e){nt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){nt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var FE=new Ht(2e3,1e4);function Tl(t,e,n){return h(this,null,function*(){if(ye(t.app))return Promise.reject(be(t,"operation-not-supported-in-this-environment"));let r=It(t);OI(t,e,Yr);let i=xm(r,n);return new LE(r,"signInViaPopup",e,i).executeNotNull()})}var LE=(()=>{class t extends to{constructor(n,r,i,s,o){super(n,r,s,o),this.provider=i,this.authWindow=null,this.pollId=null,t.currentPopupAction&&t.currentPopupAction.cancel(),t.currentPopupAction=this}executeNotNull(){return h(this,null,function*(){let n=yield this.execute();return w(n,this.auth,"internal-error"),n})}onExecution(){return h(this,null,function*(){nt(this.filter.length===1,"Popup operations only handle one event");let n=wl();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(be(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var n;return((n=this.authWindow)===null||n===void 0?void 0:n.associatedEvent)||null}cancel(){this.reject(be(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,t.currentPopupAction=null}pollUserCancellation(){let n=()=>{var r,i;if(!((i=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(be(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(n,FE.get())};n()}}t.currentPopupAction=null;return t})(),UE="pendingRedirect",$s=new Map,tl=class t extends to{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}execute(){return h(this,null,function*(){let e=$s.get(this.auth._key());if(!e){try{let r=(yield BE(this.resolver,this.auth))?yield it(t.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}$s.set(this.auth._key(),e)}return this.bypassAuthState||$s.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return h(this,null,function*(){if(e.type==="signInViaRedirect")return it(t.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let n=yield this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,it(t.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return h(this,null,function*(){})}cleanUp(){}};function BE(t,e){return h(this,null,function*(){let n=jE(e),r=$E(t);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(n))==="true";return yield r._remove(n),i})}function qE(t,e){$s.set(t._key(),e)}function $E(t){return et(t._redirectPersistence)}function jE(t){return qs(UE,t.config.apiKey,t.name)}function GE(t,e,n=!1){return h(this,null,function*(){if(ye(t.app))return Promise.reject(tt(t));let r=It(t),i=xm(r,e),o=yield new tl(r,i,n).execute();return o&&!n&&(delete o.user._redirectEventId,yield r._persistUserIfCurrent(o.user),yield r._setRedirectUser(null,e)),o})}var zE=10*60*1e3,nl=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!WE(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!Mm(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(be(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){let r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=zE&&this.cachedEventUids.clear(),this.cachedEventUids.has(nm(e))}saveEventToCache(e){this.cachedEventUids.add(nm(e)),this.lastProcessedEventTime=Date.now()}};function nm(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Mm({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function WE(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Mm(t);default:return!1}}function HE(n){return h(this,arguments,function*(t,e={}){return vt(t,"GET","/v1/projects",e)})}var KE=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,QE=/^https?/;function JE(t){return h(this,null,function*(){if(t.config.emulator)return;let{authorizedDomains:e}=yield HE(t);for(let n of e)try{if(YE(n))return}catch{}Ie(t,"unauthorized-domain")})}function YE(t){let e=$u(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){let o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!QE.test(n))return!1;if(KE.test(t))return r===t;let i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var XE=new Ht(3e4,6e4);function rm(){let t=Ue().___jsl;if(t?.H){for(let e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function ZE(t){return new Promise((e,n)=>{var r,i,s;function o(){rm(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{rm(),n(be(t,"network-request-failed"))},timeout:XE.get()})}if(!((i=(r=Ue().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=Ue().gapi)===null||s===void 0)&&s.load)o();else{let a=Am("iframefcb");return Ue()[a]=()=>{gapi.load?o():n(be(t,"network-request-failed"))},Tm(`${tE()}?onload=${a}`).catch(c=>n(c))}}).catch(e=>{throw js=null,e})}var js=null;function ew(t){return js=js||ZE(t),js}var tw=new Ht(5e3,15e3),nw="__/auth/iframe",rw="emulator/auth/iframe",iw={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},sw=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ow(t){let e=t.config;w(e.authDomain,t,"auth-domain-config-required");let n=e.emulator?al(e,rw):`https://${t.config.authDomain}/${nw}`,r={apiKey:e.apiKey,appName:t.name,v:ut},i=sw.get(t.config.apiHost);i&&(r.eid=i);let s=t._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${en(r).slice(1)}`}function aw(t){return h(this,null,function*(){let e=yield ew(t),n=Ue().gapi;return w(n,t,"internal-error"),e.open({where:document.body,url:ow(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:iw,dontclear:!0},r=>new Promise((i,s)=>h(this,null,function*(){yield r.restyle({setHideOnLeave:!1});let o=be(t,"network-request-failed"),a=Ue().setTimeout(()=>{s(o)},tw.get());function c(){Ue().clearTimeout(a),i(r)}r.ping(c).then(c,()=>{s(o)})})))})}var cw={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},uw=500,lw=600,hw="_blank",dw="http://localhost",no=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function fw(t,e,n,r=uw,i=lw){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),a="",c=Object.assign(Object.assign({},cw),{width:r.toString(),height:i.toString(),top:s,left:o}),u=W().toLowerCase();n&&(a=gm(u)?hw:n),mm(u)&&(e=e||dw,c.scrollbars="yes");let l=Object.entries(c).reduce((f,[m,T])=>`${f}${m}=${T},`,"");if(KI(u)&&a!=="_self")return pw(e||"",a),new no(null);let d=window.open(e||"",a,l);w(d,t,"popup-blocked");try{d.focus()}catch{}return new no(d)}function pw(t,e){let n=document.createElement("a");n.href=t,n.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}var mw="__/auth/handler",gw="emulator/auth/handler",_w=encodeURIComponent("fac");function im(t,e,n,r,i,s){return h(this,null,function*(){w(t.config.authDomain,t,"auth-domain-config-required"),w(t.config.apiKey,t,"invalid-api-key");let o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:ut,eventId:i};if(e instanceof Yr){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",yh(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[l,d]of Object.entries(s||{}))o[l]=d}if(e instanceof Ys){let l=e.getScopes().filter(d=>d!=="");l.length>0&&(o.scopes=l.join(","))}t.tenantId&&(o.tid=t.tenantId);let a=o;for(let l of Object.keys(a))a[l]===void 0&&delete a[l];let c=yield t._getAppCheckToken(),u=c?`#${_w}=${encodeURIComponent(c)}`:"";return`${yw(t)}?${en(a).slice(1)}${u}`})}function yw({config:t}){return t.emulator?al(t,gw):`https://${t.authDomain}/${mw}`}var qu="webStorageSupport",rl=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=El,this._completeRedirectFn=GE,this._overrideRedirectResult=qE}_openPopup(e,n,r,i){return h(this,null,function*(){var s;nt((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield im(e,n,r,$u(),i);return fw(e,o,wl())})}_openRedirect(e,n,r,i){return h(this,null,function*(){yield this._originValidation(e);let s=yield im(e,n,r,$u(),i);return AE(s),new Promise(()=>{})})}_initialize(e){let n=e._key();if(this.eventManagers[n]){let{manager:i,promise:s}=this.eventManagers[n];return i?Promise.resolve(i):(nt(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}initAndGetManager(e){return h(this,null,function*(){let n=yield aw(e),r=new nl(e);return n.register("authEvent",i=>(w(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r})}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(qu,{type:qu},i=>{var s;let o=(s=i?.[0])===null||s===void 0?void 0:s[qu];o!==void 0&&n(!!o),Ie(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=JE(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return Em()||hl()||ro()}},Fm=rl;var sm="@firebase/auth",om="1.7.2";var il=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return h(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){w(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function vw(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Iw(t){ct(new _e("auth",(e,{options:n})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;w(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let c={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:wm(t)},u=new Qu(r,i,s,c);return iE(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),ct(new _e("auth-internal",e=>{let n=It(e.getProvider("auth").getImmediate());return(r=>new il(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),H(sm,om,vw(t)),H(sm,om,"esm2017")}var Ew=5*60,ww=Do("authIdTokenMaxAge")||Ew,am=null,Tw=t=>e=>h(void 0,null,function*(){let n=e&&(yield e.getIdTokenResult()),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>ww)return;let i=n?.token;am!==i&&(am=i,yield fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function Al(t=rn()){let e=Zn(t,"auth");if(e.isInitialized())return e.getImmediate();let n=dl(t,{popupRedirectResolver:Fm,persistence:[Om,Pm,El]}),r=Do("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let o=Tw(s.toString());vl(n,o,()=>o(n.currentUser)),yl(n,a=>o(a))}}let i=bo("auth");return i&&fl(n,`http://${i}`),n}function Aw(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}ZI({loadJS(t){return new Promise((e,n)=>{let r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{let s=be("internal-error");s.customData=i,n(s)},r.type="text/javascript",r.charset="UTF-8",Aw().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Iw("Browser");var Lm="auth",Qt=class{constructor(e){return e}},ei=class{constructor(){return zr(Lm)}};var Sl=new me("angularfire2.auth-instances");function fT(t,e){let n=Fs(Lm,t,e);return n&&new Qt(n)}function pT(t){return(e,n)=>{let r=e.runOutsideAngular(()=>t(n));return new Qt(r)}}var mT={provide:ei,deps:[[new ge,Sl]]},gT={provide:Qt,useFactory:fT,deps:[[new ge,Sl],Xe]},_T=(()=>{class t{constructor(){H("angularfire",zt.full,"auth")}static \u0275fac=function(r){return new(r||t)};static \u0275mod=$e({type:t});static \u0275inj=qe({providers:[gT,mT]})}return t})();function W0(t,...e){return{ngModule:_T,providers:[{provide:Sl,useFactory:pT(t),multi:!0,deps:[st,Et,On,Wt,[new ge,Vn],...e]}]}}var Um=le(gl,!0);var H0=le(Al,!0);var Bm=le(_l,!0);var qm=le(Tl,!0);var $m=le(Il,!0);var oo=function(){return oo=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},oo.apply(this,arguments)};var ET={includeMetadataChanges:!1};function jm(t,e){return e===void 0&&(e=ET),new Bn(function(n){var r=Fu(t,e,{next:n.next.bind(n),error:n.error.bind(n),complete:n.complete.bind(n)});return{unsubscribe:r}})}function Gm(t,e){var n;e===void 0&&(e={});var r=t.data(e);return!t.exists()||typeof r!="object"||r===null||!e.idField?r:oo(oo({},r),(n={},n[e.idField]=t.id,n))}function zm(t){return jm(t,{includeMetadataChanges:!0}).pipe(qn(function(e){return e.docs}))}function Wm(t,e){return e===void 0&&(e={}),zm(t).pipe(qn(function(n){return n.map(function(r){return Gm(r,e)})}))}var ti=class{constructor(e){return e}},Hm="firestore",bl=class{constructor(){return zr(Hm)}};var Cl=new me("angularfire2.firestore-instances");function wT(t,e){let n=Fs(Hm,t,e);return n&&new ti(n)}function TT(t){return(e,n)=>{let r=e.runOutsideAngular(()=>t(n));return new ti(r)}}var AT={provide:bl,deps:[[new ge,Cl]]},ST={provide:ti,useFactory:wT,deps:[[new ge,Cl],Xe]},bT=(()=>{class t{constructor(){H("angularfire",zt.full,"fst")}static \u0275fac=function(r){return new(r||t)};static \u0275mod=$e({type:t});static \u0275inj=qe({providers:[ST,AT]})}return t})();function Ab(t,...e){return{ngModule:bT,providers:[{provide:Cl,useFactory:TT(t),multi:!0,deps:[st,Et,On,Wt,[new ge,ei],[new ge,Vn],...e]}]}}var Sb=le(Wm,!0);var bb=le(zp,!0);var Cb=le(Np,!0);var Db=le(Vp,!0);var Rb=le(jp,!0);var Pb=le($p,!0);var Ob=(()=>{let e=class e{constructor(r){this.auth=r}register(r,i){return Um(this.auth,r,i)}login(r,i){return Bm(this.auth,r,i)}loginWithGoogle(){return qm(this.auth,new pl)}logout(){return $m(this.auth)}isAuthenticated(){return new Promise((r,i)=>{this.auth.onAuthStateChanged(s=>r(!!s))})}getUser(){return this.auth.currentUser?.email}};e.\u0275fac=function(i){return new(i||e)(Yt(Qt))},e.\u0275prov=$n({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();export{Kl as a,zT as b,WT as c,vg as d,wg as e,KT as f,QT as g,Np as h,zp as i,t0 as j,n0 as k,W0 as l,H0 as m,ti as n,Ab as o,Sb as p,bb as q,Cb as r,Db as s,Rb as t,Pb as u,Ob as v};
